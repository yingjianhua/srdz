var config=angular.module("configModule",[]);
config.constant("SITE_CONFIG",{
	SITE_CODE:"m",
	SITE_VERSION:"3.3",
	API_URL:"/api/",
	SAPI_URL:"/sapi/",
	SHOW_HEADER:!0,
	UNIVERSAL_LINK_URL:"https://app.yhouse.com",
	SHOW_APP:!0,
	SHOW_LOGO:!0,
	SHOW_FOOTER:!0,
	EVENT_LIST_TYPE:0,
	LIST_AUTO_LOAD:!1
	});
var resource=angular.module("resourceModule",["configModule"]);
resource.factory("yHttp",
		["$rootScope",
		 "$http",
		 "$httpParamSerializer",
		 "SITE_CONFIG",
		 function(e,t,o,n){
			var a={};
			return{
				http:function(e,o,r,i,s,l){
					return o=n.API_URL+o,r?r.ts=(new Date).getTime():r={ts:(new Date).getTime()},
							"undefined"==typeof a[o]?(a[o]=!0,
									t({method:e,url:o,params:r,timeout:15e3}).success(function(e,t,n,r){e.hasOwnProperty("code")&&"0"===e.code?i&&i(e.data,t,n,r):s&&s(e),delete a[o]}).error(function(){l?l():s&&s({code:"1002",message:"网络异常，请稍后重试"}),delete a[o]})):void 0},get:function(e,t,o,n,a){return this.http("GET",e,t,o,n,a)},post:function(e,t,o,n,a){return this.http("POST",e,t,o,n,a)},url:function(e,t){return t?t.ts=(new Date).getTime():t={ts:(new Date).getTime()},e+"?"+o(t)}}}]),resource.factory("commonService",["$http","$interval","$rootScope","SITE_CONFIG",function(e,t,o,n){var a=n.API_URL,r=n.SAPI_URL;return{getCity:function(){return e({method:"GET",url:a+"m/city/getCityByIP"})},initWxConfig:function(o,n,r,i,s){("undefined"==typeof n||""===n)&&(n="YHOUSE悦会"),("undefined"==typeof r||""===r)&&(r="YHOUSE精选美食与玩乐，款待最重要的人。"),("undefined"==typeof i||""===i)&&(i="http://m.yhouse.com"),("undefined"==typeof s||""===s)&&(s="http://r.yhres.com/logo.jpg");var l=t(function(){"undefined"!=typeof wx&&(t.cancel(l),e({method:"GET",url:a+"m/securityTool/wxjsconfig",params:{url:o}}).success(function(e,t,o){e.hasOwnProperty("code")&&"0"===e.code&&(wx.config({debug:!1,appId:e.data.appID,timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,signature:e.data.signature,jsApiList:["onMenuShareAppMessage"]}),wx.ready(function(){wx.onMenuShareAppMessage({title:n,desc:r,link:i,imgUrl:s,success:function(){},cancel:function(){}})}))}))},200,0)},getHomeNav:function(){return e({method:"GET",url:a+"config/homeNav.m"})},getHomeTabs:function(){return[{id:0,title:"玩乐",catalogId:1,key:"event",event:"Event Tab Click",category:"Event"},{id:1,title:"美食",catalogId:2,key:"meal",event:"Meal Tab Click",category:"Meal"},{id:2,title:"生活学院",catalogId:3,key:"course",event:"Course Tab Click",category:"Course"},{id:3,title:"亲子",catalogId:7,key:"family",event:"Family Tab Click",category:"Family"}]},getHomeTabValue:function(e,t,o){var n={};switch(o){case 1:n={id:e,title:t,catalogId:o,key:"event",event:"Event Tab Click",category:"Event"};break;case 2:n={id:e,title:t,catalogId:o,key:"meal",event:"Meal Tab Click",category:"Meal"};break;case 3:n={id:e,title:t,catalogId:o,key:"course",event:"Course Tab Click",category:"Course"};break;case 7:n={id:e,title:t,catalogId:o,key:"family",event:"Family Tab Click",category:"Family"};break;default:n=""}return n},categoryList:function(){return e({method:"GET",url:a+"m/category/list/all"})},promoList:function(t,o){return e({method:"GET",url:a+"m/promocode/exchangedlist",params:{subscribeType:t,subscribeId:o}})},queryPromocode27:function(t){return e({method:"POST",url:a+"m/promocode/exclusive/collectinfo/"+t})},queryPromoUserId:function(t){return e({method:"POST",url:a+"m/promocode/exclusive/collectinfo/",params:{promoUserId:t}})},promo:function(t,o){return e({method:"GET",url:a+"m/promocode/exclusive/collect",params:{mobilePhone:t,promocode:o}})},promo22:function(t){return e({method:"POST",url:a+"m/promocode/exchange",params:{promocode:t}})},queryPromocode:function(){return e({method:"GET",url:a+"m/promocode/exclusive"})},queryVipcode27:function(){return e({method:"GET",url:a+"m/promocode/exclusive-v2.5?from=h5"})},modifyVipcode27:function(t){return e({method:"POST",url:a+"m/promocode/exclusive/modify",params:{promocode:t}})},queryInviteList:function(t,o){return e({method:"GET",url:a+"m/promocode/awardList-v2.7",params:{page:t,pageSize:o}})},isGetPromo:function(t){var o=a+"m/promocode/my/"+t;return e({method:"GET",url:o})},promoThirdParty:function(t,o){return e({method:"GET",url:a+"m/promocode/thirdParty/collect",params:{mobilePhone:t,promocode:o}})},invitation:function(t){return e({method:"GET",url:a+"m/invitation/guest",params:{code:t}})},invitationNew:function(t){return e({method:"GET",url:a+"m/invitation/guest-v2.3.1",params:{code:t}})},invitationHost:function(t,o,n,r){return e({method:"GET",url:a+"m/invitation/host-v2.6/"+t+"/"+o,params:{styleId:n,subscribeDate:r}})},invitationStyle:function(){return e({method:"GET",url:a+"config/invitationStyles"})},invitationChangeName:function(t,o){return e({method:"POST",url:a+"m/invitation/name/changed",params:{code:t,name:o}})},invitationChange:function(t,o,n,r){return e({method:"POST",url:a+"m/invitation/invitationInfo/changed",params:{code:t,name:o,subscribeDate:n,styleId:r}})},catalog:function(t,o){if("event"===t)t=1;else if("meal"===t)t=2;else if("course"===t)t=3;else{if("family"!==t)return;t=7}return e({method:"GET",url:a+"m/promotion/list_v2.5/"+t+"?",params:{cityId:o,siteInfo:"m"}})},fullSearch:function(t,o,n){return e({method:"GET",url:a+"m/fullSearch-v3.3",params:{cityId:t,key:o,type:n}})},searchHotKey:function(t){return e({method:"GET",url:a+"m/search/hostKeys",params:{cityId:t}})},filterList:function(t){return e({method:"GET",url:a+"m/filter/list-v31/"+t})},checkApi:function(){return e({method:"GET",url:a+"check-api"})},checkSapi:function(){return e({method:"GET",url:r+"check-api"})},filterResult:function(t,o,n,r,i,s,l,c,d,p,u,m,h,g,f,y,v,b){return e({method:"GET",url:a+"m/search-v3.1",params:{bizType:t,catalog:o,cityId:n,filter:r,page:i,pageSize:10,pid:s,key:l,ag:c,bc:d,ct:p,cx:u,dt:m,mc:h,pc:g,ps:f,sort:y,pos:v,coordType:b}})},channelPromocodeHandler:function(t){return e({method:"GET",url:a+"m/promocode/channelPromocodeHandler",params:{query:t}})}}}]),resource.factory("eventService",["$http","$rootScope","SITE_CONFIG",function(e,t,o){var n=o.API_URL;return{event:function(t){return e({method:"GET",url:n+"m/event/item-v2.3/"+t+"?from=h5"})},eventList:function(t,o,a,r,i){var s=n+"m/event/list";return 0!==o&&(s+="?categoryId="+o),e({method:"GET",url:s,params:{cityId:t?t:0,page:a,pageSize:10,pid:r,eventType:i}})},submitOrder:function(o,a,r,i,s,l,c,d){return e({method:"POST",url:n+"m/event/order",params:{appUserId:o,eventInfoId:a,eventFieldId:r,subscribeNum:i,mobilePhone:s,userName:l,smsCode:c,subscribeId:d,siteCode:t.siteCode}})}}}]),resource.factory("infoService",["$http","SITE_CONFIG",function(e,t){var o=t.API_URL;return{experience:function(t){return e({method:"GET",url:o+"m/player/item-v2.3/"+t+"?from=h5"})},guide:function(t){return e({method:"GET",url:o+"m/guide/item-v2.3/"+t+"?from=h5"})},news:function(t){return e({method:"GET",url:o+"m/life/item-v2.3/"+t+"?from=h5"})},getSpecialTopics:function(){return e({method:"GET",url:o+"config/specialTopics.m"})},topic:function(t,n,a){return e({method:"GET",url:o+"m/topic/item-v2.6/"+t+"?from=h5",params:{pos:n,coordType:a}})},host:function(t,n,a){return e({method:"GET",url:o+"m/host/item-v2.8/"+t+"?from=h5",params:{coordType:n,pos:a}})},promoGetTopic:function(t){return e({method:"GET",url:o+"m/topic/list",params:{cityId:t?t:null,from:"h5",page:1,pageSize:3}})},lincolnAd:function(t){return e({method:"POST",url:o+"zap/leads",params:t})}}}]),resource.factory("loginService",["$http","$rootScope","md5","SITE_CONFIG",function(e,t,o,n){var a=n.API_URL;return{login:function(n,r){var i=o.createHash(r||"");return e({method:"POST",url:a+"m/user/login",params:{username:n,password:i,siteCode:t.siteCode}})},wxOAuthEntry:function(e){return a+"m/wechat/login?redirect="+encodeURIComponent(e)},wxLogin:function(o){return e({method:"GET",url:a+"m/wechat/userLogin",params:{code:o,siteCode:t.siteCode}})},register:function(o,n){return e({method:"POST",url:a+"m/user/unified/smsCodeLogin",params:{mobilePhone:o,smsCode:n,siteCode:t.siteCode}})},findPassCode:function(t){return e({method:"POST",url:a+"m/smscode/user/getSmsCodeByResetPwd",params:{params:t}})},resetPassCode:function(t,n,r,i){var s=o.createHash(r||"");return e({method:"POST",url:a+"m/user/resetPassWord",params:{userId:t,params:n,pass:s,code:i}})},getUserInfo:function(){return e({method:"GET",url:a+"m/user/info"})},bindMobileByLogin:function(t){return e({method:"POST",url:a+"m/user/bindMobileByLogin",params:{showPicUrl:t.showPicUrl,unionId:t.unionId,nickName:t.nickName,appId:t.appId,token:t.token,type:t.type,deviceid:t.deviceid,mobilePhone:t.mobilePhone,smsCode:t.smsCode,externalUserCheckCode:t.externalUserCheckCode}})}}}]),resource.factory("mealService",["$http","$rootScope","SITE_CONFIG",function(e,t,o){var n=o.API_URL;return{meal:function(t){return e({method:"GET",url:n+"m/meal/item-v2.3/"+t+"?from=h5"})},reserve:function(t){return e({method:"GET",url:n+"m/meal/reserve/"+t+"/today?count=30"})},submitOrder:function(o,a,r,i,s,l,c,d){return a=a?a:"",r=r?r:"",e({method:"GET",url:n+"m/meal/order",params:{mealId:o,orderDate:a,orderTime:r,mealNum:i,userName:s,orderPhone:l,smsCode:c,message:d,siteCode:t.siteCode}})},mealList:function(t,o,a,r){var i=n+"m/meal/list?";return t&&0!=t&&(i+="&cityId="+t),o&&0!=o&&(i+="&categoryId="+o),e({method:"GET",url:i,params:{page:a,pageSize:10,pid:r}})}}}]),resource.factory("orderService",["$http","$rootScope","$location","SITE_CONFIG",function(e,t,o,n){var a=n.API_URL,r=o.protocol()+"://"+o.host();return{checkPromoCode:function(t,o,n){return e({method:"GET",url:a+"ipay/subscribe/promocodecheck/"+t,params:{productType:o,productId:n}})},submitOrderPayUP:function(o,n,r){return r=r?r:"",e({method:"GET",url:a+"ipay/unionpay/unifiedorder",params:{subscribeType:n,subscribeId:o,siteCode:t.siteCode,promoCode:r}})},submitOrderPayWX:function(o,n,i,s,l,c){return s=s?s:"",e({method:"GET",url:a+"ipay/wx/unifiedorder",params:{subscribeType:i,subscribeId:o,openId:n,siteUrl:r,siteCode:t.siteCode,promoCode:s,concatName:l,concatPhone:c}})},submitOrderPayAlipay:function(e,o,n,i){return i=i?i:"",a+"ipay/alipay/mobilewebpay?&subscribeType="+o+"&subscribeId="+e+"&showUri="+encodeURIComponent(n)+"&siteUrl="+encodeURIComponent(r+"/pay-result/")+"&siteCode="+t.siteCode+"&promoCode="+i},submitOrderPayCmbpay:function(e,o,n,i){return i=i?i:"",a+"ipay/cmb/wap?&subscribeType="+o+"&subscribeId="+e+"&showUri="+encodeURIComponent(n)+"&siteUrl="+encodeURIComponent(r+"/pay-result/")+"&siteCode="+t.siteCode+"&promoCode="+i},submitOrderPayUnionWebPay:function(e,o,n,i){return i=i?i:"",a+"ipay/unionpay/wap?&subscribeType="+o+"&subscribeId="+e+"&showUri="+encodeURIComponent(n)+"&siteUrl="+encodeURIComponent(r+"/pay-result/")+"&siteCode="+t.siteCode+"&promoCode="+i},orderPayBack:function(e){return a+"ipay/ret/payback/"+e+"?from=m&siteUrl="+encodeURIComponent(r)},payResult:function(t){return e({method:"GET",url:a+"ipay/subscribe/item/"+t})},getReserveCode:function(t){return e({method:"GET",url:a+"ipay/subscribe/reservecode/list/"+t})},payResultEvent:function(t){return e({method:"GET",url:a+"ipay/subscribe/event/"+t})},myOrderList:function(t,o,n){return e({method:"GET",url:a+"m/user/reserve_2.8/list",params:{status:t,page:o,pageSize:n}})},detail:function(o,n,r){return e({url:a+"m/user/reserve/detail",params:{userId:o,subscribeId:n,type:r,siteCode:t.siteCode}})},hostPayDetail:function(t,o){return e({url:a+"m/shopPay/reserve/detail",params:{subscribeId:t,type:o}})},setreservedate:function(t,o,n){return e({method:"POST",url:a+"m/meal/setreservedate/"+t,params:{orderDate:o,orderTime:n}})}}}]),resource.factory("partyService",["$http","$rootScope","SITE_CONFIG",function(e,t,o){var n=o.API_URL;return{getPartyInfo:function(t){return e({method:"GET",url:n+"m/party/"+t+"?from=h5"})},joinParty:function(t,o,a,r){return e({method:"POST",url:n+"m/party/join",params:{partyId:t,name:o,phoneNumber:a,smsCode:r}})},checkPayer:function(t,o){return e({method:"GET",url:n+"m/user/unified/smsCheckAndBindPhone",params:{mobilephone:t,smscode:o}})}}}]),resource.factory("snsService",["$http","SITE_CONFIG",function(e,t){var o=t.API_URL,n=t.SAPI_URL;return{article:function(t){return e({method:"GET",url:n+"m/sns/share/getShareArticleById?from=h5&limitNum=10",params:{id:t}})},shareTagById:function(t){return e({method:"GET",url:n+"m/sns/share/getShareTagById?from=h5&limitNum=6",params:{id:t}})},shareTagByName:function(t){return e({method:"GET",url:n+"m/sns/share/getShareTagByName",params:{tagName:t}})},shareTagNew:function(t,o,a,r,i){return e({method:"GET",url:n+"m/sns/share/getShareTagContentList",params:{tagId:t,sortType:o,page:a?a:1,pageSize:r?r:6,pid:i}})},webcastStat:function(t){return e({method:"GET",url:n+"m/sns/share/getShareWebcastStatById?from=h5",params:{id:t}})},webcastLive:function(t){return e({method:"GET",url:n+"m/sns/share/getShareWebcastById?from=h5",params:{id:t}})},attendShareWebcast:function(t){return e({method:"GET",url:n+"m/sns/share/attendShareWebcast?from=h5",params:{id:t}})},webcastVideo:function(t){return e({method:"GET",url:n+"m/sns/share/getShareVideoById?from=h5",params:{id:t}})},webcastPreview:function(t,o){return e({method:"GET",url:n+"m/sns/share/getShareWebcastByChatId?from=h5",params:{chatId:t,pushUserId:o}})},webcastGetToken:function(){return e({method:"GET",url:n+"m/sns/user/getImToken"})},webcastForenoticeList:function(){return e({method:"GET",url:n+"m/sns/share/getWebcastForenoticeListByH5?from=h5"})},getEasemobUser:function(){return e({method:"GET",url:n+"m/message/getEasemobUser"})},getSnsCampaignUserRank:function(t,o){return e({method:"GET",url:n+"m/sns/share/getSnsCampaignUserRank",params:{pageSize:t,page:o}})},getSnsCampaignRestaurantRank:function(t,o,a){return e({method:"GET",url:n+"m/sns/share/getSnsCampaignRestaurantRank",params:{pageSize:t,page:o,restaurantId:a}})},getUpToken:function(t){return e({method:"GET",url:o+"m/getUpToken",params:{userId:t}})},saveShareArticle:function(t,o,a,r){return e({method:"POST",url:n+"m/sns/share/saveShareArticle",params:{picUrls:t,longitude:o,latitude:a,description:r}})},forenoticeRemind:function(t,o){return e({method:"GET",url:n+"m/sns/share/forenoticeRemind",params:{forenoticeId:t,isRemind:o}})},likeShare:function(t,o){return e({method:"GET",url:n+"m/sns/share/likeShare",params:{isLike:t,shareId:o}})}}}]),resource.factory("specialService",["yHttp","SITE_CONFIG",function(e,t){return{deviceIdAndSign:function(t,o,n){e.get("m/user/deviceIdAndSign",null,t,o,n)},verifyCode:function(t,o,n,a){e.get("m/smscode/"+t[0],null,o,n,a)},recruit:function(t,o,n,a){e.get("m/player/enlist",{nickname:t[0],weixin:t[1],email:t[2],interest:t[3]},o,n,a)},ads:function(o,n,a,r){e.get("rocket/launch?siteId="+t.SITE_CODE,{type:o[0],cityId:o[1],catalogId:o[2],refresh:o[3]},n,a,r)},topicList:function(t,o,n,a){e.get("m/topic/list?from=h5",{hasPromocode:t[0],cityId:t[1],catalogId:t[2],page:t[3],pageSize:t[4]},o,n,a)}}}]),angular.module("utilModule",[]).factory("utilService",["$rootScope","$location",function(e,t){var o=window.navigator.userAgent.toLowerCase();return{checkInWX:function(){return/(MicroMessenger)/i.test(o)},checkInAlipay:function(){return/(Alipay)/i.test(o)},checkInIOS:function(){return/(iPhone|iPad|iPod|iOS)/i.test(o)},checkInAndroid:function(){return/(Android)/i.test(o)},checkInApp:function(){return/(YhouseAppVersion|YHMainApp)/i.test(o)},checkAppVersion:function(){for(var e=null,t=o.split(" "),n=0;n<t.length;n++)0===t[n].indexOf("yhouseappversion")&&(e=t[n].substring("yhouseappversion".length+1));return e},checkAppVersionGT:function(e){return this.checkAppVersion()>=e},getAppDeviceid:function(){for(var e="",t=o.split(" "),n=0;n<t.length;n++)0===t[n].indexOf("deviceid")&&(e=t[n].substring("deviceid".length+1));return e},openApp:function(t,o){var n="yhouse://";"undefined"!=typeof t&&(n+=t),"undefined"==typeof o&&(o=!0);var a="https://appsto.re/cn/eWMhV.i",r="http://d.yhouse.com/YHOUSE.apk";"seal|100057|m"===e.siteCode?(a="https://lnk0.com/ZJpwxp",r="http://d.yhouse.com/YHOUSE_100057.apk"):"seal|100028|m"===e.siteCode?(a="https://lnk0.com/kgogY1",r="http://d.yhouse.com/YHOUSE_100028.apk"):"seal|100051|m"===e.siteCode?(a="https://lnk0.com/Vd4oog",r="http://d.yhouse.com/YHOUSE_100051.apk"):"sms|2016marriott|m"===e.siteCode?a="https://lnk0.com/tAdMd4":"market|100060|m"===e.siteCode?(a="https://lnk0.com/gcMpEh",r="http://d.yhouse.com/YHOUSE_100060.apk"):"market|2016michelin|m"===e.siteCode&&(a="https://lnk0.com/sUhUh0");var i="http://a.app.qq.com/o/simple.jsp?pkgname=com.yhouse.code";if(this.checkInWX()){if(!o&&!confirm("只有下载客户端\n才能享受免费活动的福利哦"))return;window.location=i}else{var s=r;this.checkInIOS()&&(s=a);var l=(new Date).valueOf();setTimeout(function(){(new Date).valueOf()-l>100||(o||confirm("只有下载客户端\n才能享受免费活动的福利哦"))&&(window.location=s)},50);var c=document.createElement("iframe");c.src=n,c.style.display="none",document.body.appendChild(c),setTimeout(function(){document.body.removeChild(c)},1e3)}},openH5:function(e){var t="yhouse://",o="/";"undefined"!=typeof e&&(t+=e,o+=e);var n=(new Date).valueOf();setTimeout(function(){(new Date).valueOf()-n>100||(window.location=o)},50);var a=document.createElement("iframe");a.src=t,a.style.display="none",document.body.appendChild(a),setTimeout(function(){document.body.removeChild(a)},1e3)},getPageName:function(){return{topic:"专题详情",event:"活动详情",meal:"套餐详情",course:"生活学院详情",family:"亲子详情","event-order":"填写订单","meal-order":"填写订单","course-order":"填写订单","family-order":"填写订单","event-pay":"支付","meal-pay":"支付","course-pay":"支付","family-pay":"支付","my-order-list":"我的订单","order-event":"订单详情","order-host":"到店付详情","order-meal":"订单详情","pay-result":"购买成功",login:"登录",register:"手机登录","forget-pwd":"忘记密码",about:"关于我们","about-app":"关于我们",agreement:"服务条款及隐私政策","agreement-app":"服务条款及隐私政策",qa:"YHOUSE悦会APP常见问题","qa-app":"YHOUSE悦会APP常见问题",invitation:"邀请函","special-topic":"","special-topic-app":"","meal-party":"组局详情","meal-party-order":"订单详情",article:"图文详情"}},getHomeTabs:function(){return[{id:0,title:"活动",key:"event"},{id:1,title:"套餐",key:"meal"},{id:2,title:"生活学院",key:"course"},{id:3,title:"亲子",key:"family"}]},getEventKey:function(e){var t=["event","course","family"];return e&&angular.isNumber(e)&&t[e]?t[e]:"event"},getMealTabName:function(){return[{id:0,title:"亮点",content:"","class":"highlight"},{id:1,title:"菜单",content:"","class":"menu"},{id:2,title:"须知",content:"","class":"guideline"}]},getOrderListTabName:function(){return[{id:0,title:"全部",content:[],showGetMore:!1,currentPage:1,caption:"暂无购买信息"},{id:1,title:"购买成功",content:[],showGetMore:!1,currentPage:1,caption:"暂无成功订单"},{id:2,title:"未支付",content:[],showGetMore:!1,currentPage:1,caption:"暂无未支付订单"},{id:3,title:"无效订单",content:[],showGetMore:!1,currentPage:1,caption:"暂无无效订单"}]},getShareTagTabName:function(){return[{id:0,title:"最热",content:""},{id:1,title:"最新",content:""}]},clearId:function(e){return parseInt(e)},isEmptyNumber:function(e){return"undefined"==typeof e||null===e||0===e||"0"===e||""===e||isNaN(e)},isEmptyString:function(e){return"undefined"==typeof e||null===e||""===e},isOnlyNumAlpha:function(e){return/^(\d|[a-zA-Z])+$/.test(e)?"":"请输入数字、字母"},capitalizeString:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},unionPayPara:function(){return{unionPayScript:"http://wallet.95516.com/s/wl/web/sdk/js/UPSdk.js",unionPayDebug:!1,unionPayAppId:"123456",unionPayAppName:"Wallet"}},payLimit:function(){return{wxLimit:8e3,alipayLimit:2e4,cardLimit:1e4,unionPayLimit:1e4,unionWebPayLimit:2e3,cmbPayLimit:5e3}},checkMobile:function(e){return e&&/^1[3|4|5|7|8]\d{9}$/.test(e)?"":"请输入正确的11位手机号码"},handleRecommendManual:function(e,t,o){var n="";"guide"===e?n=t.data.text:("news"===e||"experience"===e)&&(n=t.data.content);var a=t.recommendManual,r=/<img\s*src=['"][^'"]*['"]\s*dataid=['"][^'"]*['"]\s*datatype=['"][^'"]*['"]\s*name=['"]recommendImg['"]\s*style=['"][^'"]*['"]\s*[\/]?>/g,i=/dataid=['"][^'"]*['"]/,s=/datatype=['"][^'"]*['"]/,l=n.match(r);if(l&&l.length>0)for(var c=0;c<l.length;c++){for(var d=l[c],p=i.exec(d).toString().replace(/'/g,"").replace(/\"/g,"").replace("dataid=",""),u=s.exec(d).toString().replace(/'/g,"").replace(/\"/g,"").replace("datatype=",""),m="",h="",g="",f="",y="",v=0;v<a.length;v++)if(1===a[v].contentType?(y=a[v].data.district,f=a[v].data.neededCredits,g=a[v].data.hostName):2===a[v].contentType?(y=a[v].data.businessesDistrict,f=a[v].data.priceStr,g=a[v].data.hostName):(y="",f="",g=""),a[v].data.id&&a[v].data.id==p&&a[v].contentType&&a[v].contentType==u){m=a[v].data.title,h=a[v].data.picUrl;break}var b="";(this.checkAppVersionGT("2.3")||this.checkInIOS()||o!==!0)&&(b='<y-recommend-manual id="'+p+'" type="'+u+'" title="'+m+'" category="'+e+'" source="'+t.data.id+'" pic-url="'+h+'" host-name="'+g+'" price-str="'+f+'" district-name="'+y+'" pos="'+c+'"></y-recommend-manual>'),n=n.replace(d,b)}return n},handleImage:function(t,o){if(!t)return"";var n="-q75m";(e.inAPP||o===!1)&&(n="-q75");var a=/\ssrc=['"][^'"]*['"]/gi,r=t.match(a);if(r&&r.length>0)for(var i=0;i<r.length;i++)t=t.replace(r[i],' class="lazy_img" y-lazy-src="'+r[i].replace(/'/g,"").replace(/\"/g,"").replace("src=","")+n+'"');return t}}}]);var mainApp=angular.module("mainApp",["ngRoute","ngTouch","ngAnimate","ngMd5","ngSanitize","ngCookies","pascalprecht.translate","angulartics.piwik","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","com.2fdevs.videogular.plugins.overlayplay","com.2fdevs.videogular.plugins.poster","com.2fdevs.videogular.plugins.analytics","com.2fdevs.videogular.plugins.buffering","angular-carousel","configModule","resourceModule","utilModule"]);mainApp.config(["$routeProvider","$locationProvider","$compileProvider","$analyticsProvider","$translateProvider",function(e,t,o,n,a){t.html5Mode(!0),o.aHrefSanitizationWhitelist(/^\s*(https?|mailto|tel|javascript|yhouse):/),n.virtualPageviews(!1),e.when("/",{name:"home",templateUrl:"partials/home.html",controller:"homeController"}).when("/redirect-app/:encodedRedirect",{name:"redirect-app",templateUrl:"partials/blank.html",controller:"redirectController"}).when("/city/:cityId",{name:"home",templateUrl:"partials/home.html",controller:"homeController"}).when("/event-list",{name:"event-list",templateUrl:"partials/home.html",controller:"homeController"}).when("/event-list/city/:cityId",{name:"event-list",templateUrl:"partials/home.html",controller:"homeController"}).when("/event-list-category/:categoryId",{name:"event-list",templateUrl:"partials/home.html",controller:"homeController"}).when("/meal-list",{name:"meal-list",templateUrl:"partials/home.html",controller:"homeController"}).when("/meal-list/city/:cityId",{name:"meal-list",templateUrl:"partials/home.html",controller:"homeController"}).when("/meal-list-category/:categoryId",{name:"meal-list",templateUrl:"partials/home.html",controller:"homeController"}).when("/course-list",{name:"course-list",templateUrl:"partials/home.html",controller:"homeController"}).when("/course-list/city/:cityId",{name:"course-list",templateUrl:"partials/home.html",controller:"homeController"}).when("/family-list",{name:"family-list",templateUrl:"partials/home.html",controller:"homeController"}).when("/family-list/city/:cityId",{name:"family-list",templateUrl:"partials/home.html",controller:"homeController"}).when("/course/:eventId",{name:"course",templateUrl:"partials/event.html",controller:"eventController"}).when("/course-app/:eventId",{name:"course-app",templateUrl:"partials/event-app.html",controller:"eventController"}).when("/course-order/:eventId",{name:"course-order",templateUrl:"partials/event-order.html",controller:"eventOrderController",requireLogin:!1,requireLoginInWX:!0}).when("/course-pay",{name:"course-pay",templateUrl:"partials/event-pay.html",controller:"eventPayController",requireLogin:!0,requireOrderInfo:!0}).when("/family/:eventId",{name:"family",templateUrl:"partials/event.html",controller:"eventController"}).when("/family-app/:eventId",{name:"family-app",templateUrl:"partials/event-app.html",controller:"eventController"}).when("/family-order/:eventId",{name:"course-order",templateUrl:"partials/event-order.html",controller:"eventOrderController",requireLogin:!1,requireLoginInWX:!0}).when("/family-pay",{name:"course-pay",templateUrl:"partials/event-pay.html",controller:"eventPayController",requireLogin:!0,requireOrderInfo:!0}).when("/event/:eventId",{name:"event",templateUrl:"partials/event.html",controller:"eventController"}).when("/event-app/:eventId",{name:"event-app",templateUrl:"partials/event-app.html",controller:"eventController"}).when("/event-order/:eventId",{name:"event-order",templateUrl:"partials/event-order.html",controller:"eventOrderController",requireLogin:!1,requireLoginInWX:!0}).when("/event-pay",{name:"event-pay",templateUrl:"partials/event-pay.html",controller:"eventPayController",requireLogin:!0,requireOrderInfo:!0}).when("/topic/:topicId",{name:"topic",templateUrl:function(e){return/136[1234]/.test(e.topicId)?"partials/topic-lincoln.html":1394==e.topicId?"partials/topic-lexus.html":"partials/topic.html"}}).when("/topic-app/:topicId",{name:"topic-app",templateUrl:function(e){return/136[1234]/.test(e.topicId)?"partials/topic-lincoln.html":1394==e.topicId?"partials/topic-lexus.html":"partials/topic.html"}}).when("/meal/:mealId",{name:"meal",templateUrl:"partials/meal.html",controller:"mealController"}).when("/meal-app/:mealId",{name:"meal-app",templateUrl:"partials/meal-app.html",controller:"mealController"}).when("/meal-order/:mealId",{name:"meal-order",templateUrl:"partials/meal-order.html",controller:"mealOrderController",requireLogin:!1,requireLoginInWX:!0}).when("/meal-pay",{name:"meal-pay",templateUrl:"partials/meal-pay.html",controller:"mealPayController",requireLogin:!0,requireOrderInfo:!0}).when("/sku-pop/:skuType/:content/:skuId",{name:"sku-pop",templateUrl:"partials/sku-pop.html",controller:"skuPopController"}).when("/sku-pop-app/:skuType/:content/:skuId",{name:"sku-pop",templateUrl:"partials/sku-pop.html",controller:"skuPopController"}).when("/host/:hostId",{name:"host",templateUrl:"partials/host.html",controller:"hostController"}).when("/host-app/:hostId",{name:"host-app",templateUrl:"partials/host-app.html",controller:"hostController"}).when("/host-pay-result/:outTradeNo",{name:"host-pay-result",templateUrl:"partials/host-pay-result.html",controller:"hostPayResultController"}).when("/host-pay-result-app/:outTradeNo",{name:"host-pay-result-app",templateUrl:"partials/host-pay-result.html",controller:"hostPayResultController"}).when("/host-order-rule",{name:"host-order-rule",templateUrl:"partials/host-order-rule.html",controller:"hostOrderRuleController"}).when("/host-order-rule-app",{name:"host-order-rule-app",templateUrl:"partials/host-order-rule.html",controller:"hostOrderRuleController"}).when("/news/:newsId",{name:"news",templateUrl:"partials/news.html",controller:"newsController"}).when("/news-app/:newsId",{name:"news-app",templateUrl:"partials/news.html",controller:"newsController"}).when("/experience/:experienceId",{name:"experience",templateUrl:"partials/experience.html",controller:"experienceController"}).when("/experience-app/:experienceId",{name:"experience-app",templateUrl:"partials/experience.html",controller:"experienceController"}).when("/guide/:guideId",{name:"guide",templateUrl:"partials/guide.html",controller:"guideController"}).when("/guide-app/:guideId",{name:"guide-app",templateUrl:"partials/guide.html",controller:"guideController"}).when("/my-order-list",{name:"my-order-list",templateUrl:"partials/my-order-list.html",controller:"myOrderListController",requireLogin:!0}).when("/order-event/:orderId",{name:"order-event",templateUrl:"partials/order-event.html",controller:"orderEventController",requireLogin:!0}).when("/order-course/:orderId",{name:"order-course",templateUrl:"partials/order-event.html",controller:"orderEventController",requireLogin:!0}).when("/order-family/:orderId",{name:"order-family",templateUrl:"partials/order-event.html",controller:"orderEventController",requireLogin:!0}).when("/order-meal/:orderId",{name:"order-meal",templateUrl:"partials/order-meal.html",controller:"orderMealController",requireLogin:!0}).when("/order-host/:orderId",{name:"order-host",templateUrl:"partials/order-host.html",controller:"orderHostController",requireLogin:!0}).when("/meal-party/:partyId",{name:"meal-party",templateUrl:"partials/meal-party.html",controller:"mealPartyController",requireLogin:!0}).when("/meal-party-app/:partyId",{name:"meal-party",templateUrl:"partials/meal-party.html",controller:"mealPartyController",requireLogin:!0}).when("/meal-party-order/:partyId",{name:"meal-party-order",templateUrl:"partials/meal-party-order.html",controller:"mealPartyOrderController",requireLogin:!0}).when("/pay-result/:outTradeNo",{name:"pay-result",templateUrl:"partials/pay-result.html",controller:"payResultController"}).when("/pay-result-app/:outTradeNo",{name:"pay-result-app",templateUrl:"partials/pay-result-app.html",controller:"payResultController"}).when("/pay-result-event/:eventSubscribeId",{name:"pay-result-event",templateUrl:"partials/pay-result.html",controller:"payResultEventController"}).when("/pay-result-event-app/:eventSubscribeId",{name:"pay-result-event-app",templateUrl:"partials/pay-result-app.html",controller:"payResultEventController"}).when("/pay-dae-app",{name:"pay-dae-app",templateUrl:"partials/pay-dae-app.html"}).when("/login-wx/:code",{name:"login-wx",templateUrl:"partials/login-wx.html",controller:"loginWxController"}).when("/login",{name:"login",templateUrl:"partials/login.html",controller:"loginController"}).when("/logout",{name:"logout",templateUrl:"partials/login.html",controller:"logoutController"}).when("/register",{name:"register",templateUrl:"partials/register.html",controller:"registerController"}).when("/forget-pwd",{name:"forget-pwd",templateUrl:"partials/forget-pwd.html",controller:"forgetPwdController"}).when("/reset-pwd",{name:"reset-pwd",templateUrl:"partials/reset-pwd.html",controller:"forgetPwdController"}).when("/promo/:promoCode",{name:"promo",templateUrl:"partials/promo.html",controller:"promoController"}).when("/promo-partner/:promoCode",{name:"promo-partner",templateUrl:"partials/promo-partner.html",controller:"promoPartnerController"}).when("/promo-new",{name:"promo-new",templateUrl:"partials/promo-new.html",controller:"promoNewController"}).when("/invitation/:invitationId/:inviterName",{name:"invitation",templateUrl:"partials/invitation.html",controller:"invitationController"}).when("/invitation/:invitationCode",{name:"invitation",templateUrl:"partials/invitation.html",controller:"invitationController"}).when("/invitation-app/:detailType/:orderId/:styleId",{name:"invitation-app",templateUrl:"partials/invitation-app.html",controller:"invitationAppController"}).when("/vip-code-app/:noWX",{name:"vip-code-app",templateUrl:"partials/vip-code-app.html",controller:"vipCodeController"}).when("/vip-code-app",{name:"vip-code-app",templateUrl:"partials/vip-code-app.html",controller:"vipCodeController"}).when("/vip-prize-app",{name:"vip-prize-app",templateUrl:"partials/vip-prize-app.html",controller:"vipPrizeController"}).when("/load-vip-code-app",{name:"load-vip-code-app",templateUrl:"partials/load-vip-code.html",controller:"loadVipCodeController"}).when("/recruit",{name:"recruit",templateUrl:"partials/recruit.html",controller:"recruitController"}).when("/article/:articleId",{name:"article",templateUrl:"partials/article.html",controller:"articleController"}).when("/share-tag",{name:"share-tag",templateUrl:"partials/share-tag.html",controller:"shareTagController"}).when("/webcast-stat/:webcastId",{name:"webcast-stat",templateUrl:"partials/webcast-stat.html",controller:"webcastStatController"}).when("/webcast-live/:webcastId",{name:"webcast-live",templateUrl:"partials/webcast-live.html",controller:"webcastLiveController",requireLogin:!0,requireLoginInWX:!0}).when("/cs-im",{name:"cs-im",templateUrl:"partials/custom-service.html",controller:"customServiceController"}).when("/cs-im-app",{name:"cs-im-app",templateUrl:"partials/custom-service-app.html",controller:"customServiceController"}).when("/webcast-video/:videoId",{name:"webcast-video",templateUrl:"partials/webcast-video.html",
controller:"webcastVideoController"}).when("/webcast-preview",{name:"webcast-preview",templateUrl:"partials/webcast-preview.html",controller:"webcastPreviewController"}).when("/webcast-forenotice-list",{name:"webcast-forenotice-list",templateUrl:"partials/webcast-forenotice-list.html",controller:"webcastForenoticeListController"}).when("/webcast-forenotice-list-app",{name:"webcast-forenotice-list",templateUrl:"partials/webcast-forenotice-list.html",controller:"webcastForenoticeListController"}).when("/search",{name:"search",templateUrl:"partials/search.html",controller:"searchController"}).when("/coupon-rules-app",{name:"coupon-rules-app",templateUrl:"partials/coupon-rules-app.html"}).when("/agreement",{name:"agreement",templateUrl:"partials/agreement.html"}).when("/agreement-app",{name:"agreement-app",templateUrl:"partials/agreement.html"}).when("/about",{name:"about",templateUrl:"partials/about.html"}).when("/about-app",{name:"about-app",templateUrl:"partials/about.html"}).when("/qa",{name:"qa",templateUrl:"partials/qa.html",controller:"qaController"}).when("/qa-app",{name:"qa-app",templateUrl:"partials/qa.html",controller:"qaController"}).when("/empty-app",{name:"empty-app",templateUrl:"partials/empty-app.html",controller:"emptyController"}).when("/contest-host-list-app",{name:"contest-host-list-app",templateUrl:"partials/contest-host.html",controller:"contestHostController"}).when("/contest-host/:hostId",{name:"contest-host",templateUrl:"partials/contest-host.html",controller:"contestHostController",requireLogin:!1,requireLoginInWX:!1}).when("/contest-host-prize",{name:"contest-host-prize",templateUrl:"partials/contest-host-prize.html"}).when("/contest-host-rules",{name:"contest-host-rules",templateUrl:"partials/contest-host-rules.html"}).when("/contest-host-ranking",{name:"contest-host-ranking",templateUrl:"partials/contest-host-ranking.html",controller:"contestRankingController"}).when("/contest-host-mobile-bind",{name:"contest-host-mobile-bind",templateUrl:"partials/contest-host-mobile-bind.html",controller:"contestHostMobileBindController",requireLogin:!0,requireLoginInWX:!0}).when("/share-tag-upload",{name:"share-tag-upload",templateUrl:"partials/share-tag-upload.html",controller:"shareTagUploadController"}).when("/404",{name:"404",templateUrl:"partials/404.html"}).otherwise({redirectTo:"/"}),a.translations("zh",{REASONS_FOR_RECOMMENDATION:"推荐理由",MORE_DETAILS:"查看详情",MENU:"菜单",FULL_MENU:"完整图文菜单",FULL_EVENT:"完整活动详情",FULL_COURSE:"完整课程详情",DINING_FACILITIES:"餐厅设施",NOTICE:"注意事项",MORE:"更多",TIPS:"温馨提示",CUSTOMER_IM_SERVICE:"在线客服",CUSTOMER_TEL_SERVICE:"电话客服",YOU_MAY_LIKE:"猜你喜欢",FOR_FREE:"免费"}),a.translations("en",{REASONS_FOR_RECOMMENDATION:"Highlights",MORE_DETAILS:"More",MENU:"Menu",FULL_MENU:"Full Menu",FULL_EVENT:"Full Details",FULL_COURSE:"Full Details",DINING_FACILITIES:"Dining Facilities",NOTICE:"Notice",MORE:"More",TIPS:"Tips",CUSTOMER_IM_SERVICE:"Online Service",CUSTOMER_TEL_SERVICE:"Call Us",YOU_MAY_LIKE:"You May Like",FOR_FREE:"For Free"}),a.preferredLanguage("zh"),a.useSanitizeValueStrategy("escape")}]),mainApp.run(["$location","$rootScope","$window","$timeout","$cookies","$http","$interval","commonService","loginService","utilService","specialService","SITE_CONFIG","$translate",function(e,t,o,n,a,r,i,s,l,c,d,p,u){if("undefined"!=typeof a.get("locale")&&"en"===a.get("locale")&&u.use(a.get("locale")),t.$on("$routeChangeSuccess",function(e,t,o){"undefined"!=typeof _paq&&"meal"!==t.name&&"meal-app"!==t.name&&"event"!==t.name&&"event-app"!==t.name&&"topic"!==t.name&&"topic-app"!==t.name&&"news"!==t.name&&"news-app"!==t.name&&"guide"!==t.name&&"guide-app"!==t.name&&"experience"!==t.name&&"experience-app"!==t.name&&"empty-app"!==t.name&&"host"!==t.name&&"share-tag"!==t.name&&"article"!==t.name&&"webcast-stat"!==t.name&&"webcast-video"!==t.name&&"webcast-live"!==t.name&&"webcast-forenotice-list"!==t.name&&"webcast-preview"!==t.name&&_paq.push(["trackPageView"])}),t.$on("$routeChangeStart",function(n,r,i){if(t.univseralLinksParams="?open="+encodeURIComponent(e.url().substr(e.url().indexOf("/")+1))+"&siteCode="+t.siteCode,"webcast-forenotice-list"===r.name&&(t.univseralLinksParams="?open="+encodeURIComponent("webcast-forenotice-list?title="+encodeURIComponent("直播预告")+"&url="+encodeURIComponent(document.location.protocol+"//"+document.location.host+"/webcast-forenotice-list-app")+"&linkTitle="+encodeURIComponent("坐享身临其境的现场体验")+"&linkContent="+encodeURIComponent("还不快上车？开启YHOUSE直播提醒，精彩不容错过！")+"&linkPic="+encodeURIComponent("http://f.yhres.com/config/forenotice/2016/07/01/1467369206025221.jpg-ssq75")+"&hideShortcut=0&isBack=1")+"&siteCode="+t.siteCode),t.univseralLinksURL=p.UNIVERSAL_LINK_URL,t.pageName=r.name,r.name&&r.name.indexOf("-app")>0||c.checkInApp())return t.inAPP=!0,t.appOpenClosed=!0,t.page={showFilter:!1,showFilterWindow:!1,showHeader:!1,showFooter:!1,showApp:!1,showBg:!1,showPaddingBottom:!1,allowCoupon:!1,banner:"打开APP",showBundle:!0},("topic-app"===r.name||"special-topic-app"===r.name||"vip-code-app"===r.name||"vip-prize-app"===r.name||"load-vip-code-app"===r.name||"invitation-app"===r.name||"host-pay-result-app"===r.name)&&(t.page.showBg=!0),"pay-result-app"===r.name&&(t.page.showPaddingBottom=!0),void("meal-party"===r.name&&(t.page.showPaddingBottom=!0));if(null==o.sessionStorage.getItem("currentUser")&&"undefined"!=typeof a.get("UA"))try{var d=new XMLHttpRequest;if(d.open("get","/api/m/user/info",!1),d.send(null),t.currentUser=JSON.parse(d.responseText).data,o.sessionStorage.setItem("currentUser",JSON.stringify(t.currentUser)),"login-wx"===r.name||"login"===r.name||"register"===r.name)return void e.path(t.loginNextPath)}catch(u){}if("undefined"==typeof t.currentUser&&o.sessionStorage.getItem("currentUser")&&(t.currentUser=JSON.parse(o.sessionStorage.getItem("currentUser")),t.currentUser&&("undefined"!=typeof _paq&&_paq.push(["setUserId",t.currentUser.id]),"undefined"!=typeof _paq&&t.currentUser.mobilephone&&_paq.push(["setCustomVariable",1,"mobile",t.currentUser.mobilephone,"visit"]),"undefined"!=typeof _vds&&_vds.push(["setCS1","user_id",t.currentUser.id]))),"undefined"==typeof a.get("UA")&&(o.sessionStorage.removeItem("currentUser"),delete t.currentUser),"login-wx"!==r.name&&"login"!==r.name&&"register"!==r.name&&"logout"!==r.name&&"reset-pwd"!==r.name&&"forget-pwd"!==r.name&&"promo"!==r.name&&"404"!==r.name&&"cs-im"!==r.name)try{o.sessionStorage.setItem("path",e.path())}catch(u){}if(t.loginNextPath=o.sessionStorage.getItem("path")?o.sessionStorage.getItem("path"):"/","undefined"==typeof t.eventOrderInfo&&o.sessionStorage.getItem("eventOrderInfo")&&(t.eventOrderInfo=JSON.parse(o.sessionStorage.getItem("eventOrderInfo"))),"undefined"==typeof t.mealOrderInfo&&o.sessionStorage.getItem("mealOrderInfo")&&(t.mealOrderInfo=JSON.parse(o.sessionStorage.getItem("mealOrderInfo"))),t.currentUser&&"undefined"==typeof t.userOrderInfo&&o.sessionStorage.getItem("userOrderInfo")&&(t.userOrderInfo=JSON.parse(o.sessionStorage.getItem("userOrderInfo"))),"undefined"==typeof t.currentUser)if(t.inWX){if(r.requireLoginInWX||r.requireLogin||"login"===r.name||"register"===r.name)return void(window.location=l.wxOAuthEntry(t.loginNextPath))}else if(r.requireLogin)return void e.path("/register");if(r.requireOrderInfo&&"undefined"==typeof t.eventOrderInfo&&"undefined"==typeof t.mealOrderInfo)return void e.path(t.loginNextPath);if(t.currentUser&&("login-wx"===r.name||"login"===r.name||"register"===r.name||"reset-pwd"===r.name||"forget-pwd"===r.name))return void e.path(t.loginNextPath);if(t.page={scrollPos:0,okSaveScroll:!1,showFilterWindow:!1,showDialog:!1,showBackBtn:!0,allowCoupon:!1,skuYhouseBanner:!1,banner:"打开APP",shareUi:null},t.page.showFooter=p.SHOW_FOOTER&&!t.inAPP,t.page.showHeader=p.SHOW_HEADER&&!t.inAPP,t.page.showApp2=t.page.showApp=p.SHOW_APP&&"undefined"==typeof t.appOpenClosed&&!t.inAPP?!0:!1,e.search().show_app?"0"===e.search().show_app&&(t.page.showApp2=t.page.showApp=!1,o.sessionStorage.setItem("show_app","0")):"0"===o.sessionStorage.getItem("show_app")&&(t.page.showApp2=t.page.showApp=!1),t.page.showBundle=!0,e.search().show_bundle?"0"===e.search().show_bundle&&(t.page.showBundle=!1,o.sessionStorage.setItem("show_bundle","0")):"0"===o.sessionStorage.getItem("show_bundle")&&(t.page.showBundle=!1),t.page.showLogoOut=t.page.showLogo=p.SHOW_LOGO,("event-pay"===r.name||"event-order"===r.name||"meal-pay"===r.name||"meal-order"===r.name||"pay-result"===r.name||"pay-result-event"===r.name||"order-event"===r.name||"order-meal"===r.name||"register"===r.name||"recruit"===r.name||"host-pay-result"===r.name)&&(t.page.showFooter=!1),("meal"===r.name||"event"===r.name||"host"===r.name)&&(t.page.skuYhouseBanner=!1),("pay-result"===r.name||"pay-result-event"===r.name)&&(t.page.showBackBtn=!1),("promo"===r.name||"invitation"===r.name||"promo-partner"===r.name||"promo-new"===r.name||"contest-host-mobile-bind"===r.name)&&(t.page.showFooter=!1,t.page.showHeader=!1),("article"===r.name||"share-tag"===r.name||"webcast-stat"===r.name||"webcast-live"==r.name||"webcast-video"==r.name||"webcast-preview"==r.name||"webcast-forenotice-list"==r.name||"cs-im"==r.name||"cs-im-app"==r.name||"contest-host"==r.name||"contest-host-list-app"==r.name||"contest-host-prize"==r.name||"contest-host-ranking"==r.name||"share-tag-upload"==r.name||"contest-host-rules"==r.name)&&(t.page.showFooter=!1,t.page.showHeader=!1),"search"===r.name&&(t.page.showHeader=!1,t.page.showFooter=!1),("sku-pop"===r.name||"host-order-rule"===r.name)&&(t.page.showFooter=!1,t.page.showBg=!0),("login"===r.name||"forget-pwd"===r.name||"register"===r.name||"reset-pwd"===r.name||"topic"===r.name||"special-topic"===r.name||"invitation"===r.name||"host-pay-result"===r.name||"share-tag-upload"===r.name||"contest-host-mobile-bind"===r.name)&&(t.page.showBg=!0),("event"===r.name||"event-order"===r.name||"event-pay"===r.name||"meal"===r.name||"meal-order"===r.name||"meal-pay"===r.name||"order-event"===r.name||"order-meal"===r.name||"pay-result"===r.name||"user-wx"===r.name||"meal-party"===r.name||"contest-host"===r.name)&&(t.page.showPaddingBottom=!0,"event"!==r.name&&"meal"!==r.name||!e.search()||"1"!==e.search().hide_buy||(t.page.showPaddingBottom=!1)),"home"===r.name||"event-list"===r.name||"meal-list"===r.name||"course-list"===r.name||"family-list"===r.name?(t.page.showHomeMenu=!0,t.page.showFilterCity=!0,t.page.showFilterCategory="course-list"!==r.name,t.page.showFilterCategory="family-list"!==r.name):(t.page.showHomeMenu=!1,t.page.showFilterCity=!1,t.page.showFilterCategory=!1,"special-topic"!==r.name&&"topic"!==r.name&&"news"!==r.name&&"guide"!==r.name&&"experience"!==r.name&&"article"!==r.name&&"share-tag"!==r.name&&"webcast-stat"!==r.name&&"webcast-live"!==r.name&&"webcast-video"!==r.name&&"webcast-preview"!==r.name&&(t.page.showApp=!1)),"share-tag"==r.name&&(t.page.banner="参与话题"),t.headTitle=c.getPageName()[r.name]?c.getPageName()[r.name]:"",t.backBtn=function(){"404"===r.name&&window.history.length>2?window.history.go(-2):window.history.length>2&&void 0!=i?window.history.back():"meal"===r.name?e.path("/meal-list"):"event"===r.name?e.path("/event-list"):"family"===r.name?e.path("/family-list"):"sku-pop"===r.name?"event"==r.params.skuType&&r.params.skuId?e.path("/event/"+r.params.skuId):"meal"==r.params.skuType&&r.params.skuId?e.path("/meal/"+r.params.skuId):e.path("/"):e.path("/")},t.homeBtn=function(){e.path("/").search({catalog:null})},t.inWX&&"home"===r.name&&s.initWxConfig(e.absUrl()),e.search()&&e.search().share_ui){t.page.shareUi=e.search().share_ui;try{o.sessionStorage.setItem("shareUi",t.page.shareUi)}catch(u){}}o.sessionStorage.getItem("shareUi")&&(t.page.shareUi=o.sessionStorage.getItem("shareUi"))}),e.search().pk_campaign){var m=e.search().pk_campaign+"|";e.search().pk_kwd&&(m+=e.search().pk_kwd),m+="|"+p.SITE_CODE;try{o.sessionStorage.setItem("siteCode",m)}catch(h){}}t.siteCode=o.sessionStorage.getItem("siteCode")?o.sessionStorage.getItem("siteCode"):p.SITE_CODE,("cheetah|onstar|m"==t.siteCode||"seal|onstar|m"==t.siteCode)&&(r.defaults.headers.common.channelType="onstar"),"seal|onstar|m"==t.siteCode&&e.search().data&&e.search().timestamp&&e.search().signature&&s.channelPromocodeHandler(location.search.split("?")[1]).success(function(e,n,a){if(e.hasOwnProperty("code")&&"0"===e.code){t.currentUser=e.data;try{o.sessionStorage.setItem("currentUser",JSON.stringify(e.data))}catch(r){}}}),t.inWX=c.checkInWX()?!0:!1,t.inAlipay=c.checkInAlipay()?!0:!1,t.inUnionPay="seal|unionpay"===t.siteCode,t.appGt=function(e){return t.inAPP&&c.checkAppVersionGT(e)},t.mOrAppGt=function(e){return!t.inAPP||t.inAPP&&c.checkAppVersionGT(e)},r.defaults.headers.common.YhouseSiteVersion=p.SITE_VERSION,t.closeBtn=function(){t.appOpenClosed=!0,t.page.showApp=!1,t.page.skuYhouseBanner=!1},t.openApp=function(e){("undefined"==typeof t.appOpenEnabled||t.appOpenEnabled===!0)&&(t.appOpenEnabled=!1,"undefined"!=typeof _paq&&_paq.push(["trackEvent","App","App Download"]),c.openApp(),n(function(){t.appOpenEnabled=!0},1e3))},t.openContentUrl=function(n,a){var r=[void 0,"event","meal","guide","experience","news","topic","host"];"undefined"!=typeof r[n]&&(t.inAPP?o.location="yhouse://"+r[n]+"/"+a:e.path("/"+r[n]+"/"+a))},t.videoStyle={width:"100%",height:"414px"},t.showDialog=function(e){t.page.dialogText=e,t.page.showDialog=!0,n(function(){t.page.showDialog=!1,t.page.dialogText=""},2e3)},t.openAppSnsDialog=function(){t.snsDialog.showConfirm=!0},t.snsDialog={showConfirm:!1,theme:"",desc:"下载YHOUSE和TA互动吧！",leftBtn:"取消",rightBtn:"下载",cancel:function(){t.snsDialog.showConfirm=!t.snsDialog.showConfirm},confirm:function(){t.snsDialog.showConfirm=!1,t.openApp()}};try{o.sessionStorage.setItem("tipDialog","true")}catch(h){}if(t.tipDialog={showConfirm:!1,theme:"",desc:"",btn:"确定",cancel:function(){t.tipDialog.showConfirm=!0},confirm:function(){t.tipDialog.showConfirm=!1,o.sessionStorage.removeItem("tipDialog")}},t.$on("pageTitleChanged",function(){"undefined"!=typeof _paq&&_paq.push(["trackPageView",t.page.pageTitle])}),t.inWX){var g=document.createElement("script");g.src="//res.wx.qq.com/open/js/jweixin-1.0.0.js",g.async=!1;var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(g,f)}var y=c.getAppDeviceid();if(y)r.defaults.headers.common.deviceId=y,"undefined"!=typeof _paq&&_paq.push(["setCustomVariable",2,"deviceid",y,"visit"]);else if(null===o.localStorage.getItem("deviceId")||"undefined"==typeof o.localStorage.getItem("deviceId"))d.deviceIdAndSign(function(e){try{o.localStorage.setItem("deviceId",JSON.stringify(e))}catch(t){}r.defaults.headers.common.deviceId=e.deviceId,r.defaults.headers.common.deviceidSign=e.deviceidSign,"undefined"!=typeof _paq&&_paq.push(["setCustomVariable",2,"deviceid",e.deviceId,"visit"])});else{var v=JSON.parse(o.localStorage.getItem("deviceId"));r.defaults.headers.common.deviceId=v.deviceId,r.defaults.headers.common.deviceidSign=v.deviceidSign,"undefined"!=typeof _paq&&_paq.push(["setCustomVariable",2,"deviceid",v.deviceId,"visit"])}"undefined"!=typeof _paq&&"undefined"!=typeof a.get("UI")&&_paq.push(["setUserId",a.get("UI")]),"undefined"!=typeof _paq&&_paq.push(["setCustomVariable",3,"userAgent",window.navigator.userAgent,"visit"]),"undefined"!=typeof _paq&&c.checkInApp()&&_paq.push(["setCustomVariable",4,"YhouseAppVersion",c.checkAppVersion(),"visit"]),"undefined"!=typeof _vds&&"undefined"!=typeof a.get("UI")&&_vds.push(["setCS1","user_id",a.get("UI")]),o.sessionStorage.getItem("channelType")&&(r.defaults.headers.common.channelType=o.sessionStorage.getItem("channelType")),(null===o.localStorage.getItem("rocket")||"undefined"==typeof o.localStorage.getItem("rocket")||JSON.parse(o.localStorage.getItem("rocket")).timestamp+6e5<(new Date).getTime())&&d.ads([],function(e){e.timestamp=(new Date).getTime();try{o.localStorage.setItem("rocket",JSON.stringify(e))}catch(t){}}),t.reloadPv=function(e){var t=o.localStorage.getItem("cityId");"undefined"==typeof e&&(e=o.localStorage.getItem("catalogId"));var n=o.localStorage.getItem("rocket")?JSON.parse(o.localStorage.getItem("rocket")).pvList:[];n.forEach(function(o){!o.catalogId||0!==o.cityId.length&&-1===o.cityId.indexOf(t)||0!==o.catalogId.length&&-1===o.catalogId.indexOf(e)||((new Image).src=o.pvUrl,"undefined"!=typeof _paq&&_paq.push(["trackEvent","adPv",o.id]))})},t.reloadAdPv=function(e){var t=o.localStorage.getItem("rocket")?JSON.parse(o.localStorage.getItem("rocket")).pvList:[];t.forEach(function(t){t.id==e&&((new Image).src=t.pvUrl,"undefined"!=typeof _paq&&_paq.push(["trackEvent","adPv",t.id]))})},t.adClick=function(e,t,n,a){var r=o.localStorage.getItem("cityId"),i=o.localStorage.getItem("catalogId");"undefined"!=typeof _paq&&_paq.push(["trackEvent",AD_TYPE+"  Click",r+"@"+i+"@"+n+"@"+a,e])}}]),mainApp.controller("articleController",["$scope","$rootScope","$routeParams","$location","snsService","utilService","commonService",function(e,t,o,n,a,r,i){e.articleInfo=null,e.picUrls=[],e.currentActive=0,e.bigPic=!1,e.openBigPic=function(t,o){e.picUrls=t,e.currentActive=o,e.bigPic=!0},e.closeBigPic=function(){e.bigPic=!1},e.articleId=r.clearId(o.articleId),a.article(e.articleId).success(function(o,a,r){"0"===o.code&&o.data?(e.articleInfo=o.data,e.articleInfo.description=e.articleInfo.description.replace(/\n/g,"<br>"),t.page.pageTitle=e.articleInfo.shareContent,t.inWX&&i.initWxConfig(n.absUrl(),o.data.shareContent,o.data.userName+"在YHOUSE的图文很让我喜欢，快来看看吧！",n.absUrl(),o.data.shareImgUrl),t.$emit("pageTitleChanged")):n.path("/404")}).error(function(){n.path("/404")})}]),mainApp.controller("contestHostController",["$scope","$rootScope","$window","$location","$routeParams","snsService","$sce","commonService","$q","utilService",function(e,t,o,n,a,r,i,s,l,c){e.tagId=22,e.hostId=c.clearId(a.hostId)||"",e.tabs=c.getShareTagTabName(),t.page.pageTitle="#吃货研究所#颜值餐厅晒照大赛",t.$emit("pageTitleChanged"),e.isShareTagHeaderStikcy=!1,r.getSnsCampaignUserRank().success(function(t,o,n){"0"===t.code&&t.data&&(e.top10RankLists=t.data.rankList.slice(0,9))}),e.shareTagUploadUrl="/share-tag-upload?id="+e.tagId+"&key="+encodeURIComponent("#吃货研究所#")+"&hostId="+e.hostId+"&fromUrl="+encodeURIComponent("/contest-host/"+e.hostId)+"&toUrl="+encodeURIComponent("/contest-host-mobile-bind?fromUrl="+encodeURIComponent("/contest-host/"+e.hostId)),t.inWX&&s.initWxConfig(n.absUrl(),t.page.pageTitle,"吃货研究所",n.absUrl(),e.iconUrl),e.currentTabId=0,e.tabContents=new Array(2);for(var d=0;d<e.tabContents.length;d++)e.tabContents[d]={isEnd:!1,isBusy:!1,page:1,pid:null};e.picUrls=[],e.currentActive=0,e.bigPic=!1,e.openBigPic=function(t,o){e.picUrls=t,e.currentActive=o,e.bigPic=!0},e.closeBigPic=function(){e.bigPic=!1},e.switchTab=function(t){e.currentTabId=t},e.loadPage=function(){if(!e.tabContents[e.currentTabId].isEnd&&!e.tabContents[e.currentTabId].isBusy){e.tabContents[e.currentTabId].isBusy=!0;var t=e.tagId?e.tagId:e.hostId;r.shareTagNew(t,e.currentTabId,e.tabContents[e.currentTabId].page,10,e.tabContents[e.currentTabId].pid).success(function(t,o,n){if("0"===t.code&&t.data){1===t.data.isEnd&&(e.tabContents[e.currentTabId].isEnd=!0);var a=t.data.doc;e.tabContents[e.currentTabId].list?e.tabContents[e.currentTabId].list=e.tabContents[e.currentTabId].list.concat(a):e.tabContents[e.currentTabId].list=a,e.tabContents[e.currentTabId].page++,e.tabContents[e.currentTabId].isBusy=!1,e.tabContents[e.currentTabId].pid=t.data.pid}})}},e.loadPage();var p=function(){o.pageYOffset+o.innerHeight>document.body.scrollHeight-10&&e.loadPage()};e.$on("$routeChangeSuccess",function(){angular.element(o).on("scroll touchmove",p)}),e.reloadPage=function(){e.currentTabId;e.tabContents[e.currentTabId].isEnd=!1,e.tabContents[e.currentTabId].page=1,e.tabContents[e.currentTabId].list=[],e.loadPage()},e.likeShare=function(t){e.tabContents[e.currentTabId].list[t].data.isLike=0==e.tabContents[e.currentTabId].list[t].data.isLike?1:0,1==e.tabContents[e.currentTabId].list[t].data.isLike?e.tabContents[e.currentTabId].list[t].data.likeUserNum+=1:e.tabContents[e.currentTabId].list[t].data.likeUserNum-=1,r.likeShare(e.tabContents[e.currentTabId].list[t].data.isLike,e.tabContents[e.currentTabId].list[t].data.id).success(function(e,t,o){"0"===e.code&&e.data})}}]),mainApp.controller("contestHostMobileBindController",["$scope","$rootScope","$location","$window","$routeParams","loginService","specialService",function(e,t,o,n,a,r,i){e.showBindPhone=!1,e.fromUrl=o.search().fromUrl||"",t.currentUser&&t.currentUser.bindPhone?(console.log("返回首页"),e.showBindPhone=!0):e.showBindPhone=!0,e.dialog={showConfirm:!1,theme:"",desc:"绑定成功",leftBtn:"下载APP",rightBtn:"返回首页",cancel:function(){t.openApp()},confirm:function(){o.path("/"+e.fromUrl)}},e.sendData={mobile:"",verifyCode:""},e.enableSubmit=!0,e.deviceId=n.localStorage.getItem("deviceId"),e.deviceId||i.deviceIdAndSign(function(t){e.deviceId=JSON.stringify(t)}),e.bindPhone=function(){e.enableSubmit=!1,e.bindPhonePara={showPicUrl:t.currentUser.showPicUrl||"",unionId:t.currentUser.openId,nickName:t.currentUser.name||"",appId:t.currentUser.openId,token:"EKZ2AQZjAwWinSx",type:t.currentUser.type||"5",deviceid:JSON.parse(e.deviceId).deviceId||"",mobilePhone:e.sendData.mobile,smsCode:e.sendData.verifyCode,externalUserCheckCode:"EKZ2AQZjAwWinSx"},r.bindMobileByLogin(e.bindPhonePara).success(function(o,a,r){e.enableSubmit=!0,"0"===o.code?(n.sessionStorage.setItem("currentUser",JSON.stringify(o.data)),e.dialog.showConfirm=!0):t.showDialog(o.message)}).error(function(o,n,a){e.enableSubmit=!0,t.showDialog(o.message)})}}]),mainApp.controller("contestRankingController",["$scope","$rootScope","$location","$routeParams","snsService","$sce","commonService","$window","$q","utilService",function(e,t,o,n,a,r,i,s,l,c){function d(t,o,n){a.getSnsCampaignUserRank(o,t,n).success(function(t,o,n){"0"===t.code&&t.data&&(e.userRank=t.data,e.rankLists=t.data.rankList,e.myRankVO=t.data.myRankVO)})}function p(t,o,n){a.getSnsCampaignRestaurantRank(o,t,n).success(function(t,o,n){"0"===t.code&&t.data&&(e.hostRank=t.data,e.restaurantRankLists=t.data.rankList,e.currentRestaurantRank=t.data.myRankVO)})}e.currentTabId=1,t.page.pageTitle="#吃货研究所#颜值餐厅晒照大赛",t.$emit("pageTitleChanged"),e.hostId=o.search().hostId,e.userRank=null,e.hostRank=null,e.pageSize=10,e.page=1,e.userRankpageSize=10,e.userRankpage=1,e.switchTab=function(t){e.currentTabId=t,1===e.currentTabId?e.userRank||d(e.userRankpageSiz,e.userRankpage):e.hostRank||p(e.page,e.pageSize,e.hostId)},d()}]),mainApp.controller("customServiceController",["$scope","$rootScope","$location","$routeParams","snsService","$sce","commonService","$window","$cookies","loginService","utilService","$location","$timeout","$cookies",function(e,t,o,n,a,r,i,s,l,c,d,o,p,l){return t.inAPP||1!=l.get("returnFromIM")?(window.easemobim=window.easemobim||{},deviceid="",extMsg={},("meal"==n.type||"event"==n.type)&&(extMsg={msgtype:{order:{img_url:n.imgurl,title:n.itemtitle,desc:n.address,order_title:"",price:n.price,item_url:document.location.protocol+"//"+document.location.host+"/"+n.type+"/"+n.id}}}),void a.getEasemobUser().success(function(e,t,o){console.log(e),"0"===e.code&&e.data&&(easemobData=e.data,easemobim.config={tenantId:easemobData.tenantId,to:easemobData.imServiceId,user:{username:easemobData.easemobUserName,password:easemobData.easemobPassWord,token:""},visitor:{trueName:null==easemobData.nickName?deviceid:easemobData.nickName,qq:"",phone:null==easemobData.mobilePhone?"":easemobData.mobilePhone,companyName:"",userNickname:null==easemobData.nickName?deviceid:easemobData.nickName,description:"",email:""},appKey:easemobData.appKey,domain:"//kefu.easemob.com",path:"//"+document.location.host+"/webim",staticPath:"",xmppServer:"im-api.easemob.com",restServer:"a1.easemob.com",extMsg:extMsg,autoConnect:!0,buttonText:"联系客服",hide:!1,resources:!1,dragenable:!0,hideKeyboard:!0,dialogWidth:"400px",dialogHeight:"500px",minimum:!0,satisfaction:!0,soundReminder:!0,dialogPosition:{x:"10px",y:"10px"},onmessage:function(e){console.log(e)},onsessionclosed:function(){}},easemobim.bind({tenantId:easemobData.tenantId}))})):(o.path(t.loginNextPath),void l.put("returnFromIM",0))}]),mainApp.directive("yNumberInput",function(){return{restrict:"E",scope:{number:"=",minNumber:"=",maxNumber:"="},template:'<a class="minus_btn" ng-click="minus()" ng-class="{number_disabled:(number == minNumber)}">-</a><input type="number" readonly  class="nums" ng-model="number" ><a class="plus_btn" ng-click="plus()" ng-class="{number_disabled:(number == maxNumber )}">+</a>',controller:["$scope",function(e){e.minus=function(){e.number--},e.plus=function(){e.number++},e.checkNum=function(){0==e.maxNumber?e.number=0:e.number>e.maxNumber?e.number=e.maxNumber:e.number<e.minNumber&&(e.number=e.minNumber)},e.$watchGroup(["number","maxNumber"],function(){e.checkNum()})}]}}).directive("ySexOption",function(){return{restrict:"E",scope:{sex:"="},template:'<span>                <input type="radio" class="radios" name="sex"  value="0" ng-model="sex" id="sex_male" />                <label for="sex_male" name="sex_male" class="radio_btn" ng-class="{checked:(0 == sex)}"></label> 先生                </span>                <span>                <input type="radio" class="radios" name="sex" value="1" ng-model="sex" id="sex_female" />                <label for="sex_female" name="sex_female" class="radio_btn" ng-class="{checked:(1 == sex)}"></label> 女士                </span>'}}).directive("yGetCode",function(){return{restrict:"E",scope:{mobile:"=",getType:"@"},template:'<input type="button" ng-value="title" ng-click="getCode()"             ng-class="{true:\'get_active\'}[mobile.length==11 && enableGetCode]"            ng-disabled="mobile.length!=11 || !enableGetCode"  class="get_code_num" />',controller:["$rootScope","$scope","$timeout","$interval","utilService","loginService","specialService",function(e,t,o,n,a,r,i){t.enableGetCode=!0,t.title="获取验证码",t.getCodeOK=function(){t.title="发送成功";var e=60,o=n(function(){e--,0===e?(n.cancel(o),t.enableGetCode=!0,t.title="重新发送"):t.title=e},1e3,0)},"reset-pwd"===t.getType&&(t.enableGetCode=!1,t.getCodeOK()),t.getCodeFail=function(n){e.showDialog(n.message),o(function(){t.enableGetCode=!0},0)},t.getCode=function(){if(t.enableGetCode){t.enableGetCode=!1;var n=a.checkMobile(t.mobile);return""!==n?(e.showDialog(n),void o(function(){t.enableGetCode=!0},0)):void("reset-pwd"===t.getType?r.findPassCode(t.mobile).success(function(e){1==e.status?t.getCodeOK(e):t.getCodeFail(e)}):"event-order"===t.getType||"meal-order"===t.getType||"party"===t.getType||"register"===t.getType?i.verifyCode([t.mobile],function(e){t.getCodeOK(e)},function(e){t.getCodeFail(e)}):i.verifyCode([t.mobile],function(e){t.getCodeOK(e)},function(e){t.getCodeFail(e)}))}}}]}}).directive("yLazySrc",["$window","$document",function(e,t){var o=angular.element(e),n=t[0],a=!1,r=function(){var e=0,t={};return{push:function(o){t[e++]=o,setTimeout(function(){l(o)})},del:function(e){t[e]&&delete t[e]},size:function(){return Object.keys(t).length},get:function(){return t}}}(),i=function(){var t,o="number"==typeof e.pageYOffset?e.pageYOffset:(((t=n.documentElement)||(t=body.parentNode))&&"number"==typeof t.ScrollTop?t:body).ScrollTop;return{offsetY:o}},s=function(t){var o,a=t[0].getBoundingClientRect(),r=i(),s=r.offsetY,l=a.height,c=a.top+s,d=Math.max(n.documentElement.clientHeight,e.innerHeight||0);return(s>=c&&c+l>=s||c>=s&&s+d>=c)&&(o=!0),o},l=function(e,t,n){return t>=0&&n?s(n.elem)?n.load(t):!1:void(0===r.size()?(o.off("scroll resize touchmove",l),a=!1):angular.forEach(r.get(),function(e,t){s(e.elem)&&e.load(t)}))},c=function(){0==a&&(a=!0,o.on("scroll resize touchmove",l))};return{restrict:"A",scope:{},link:function(e,t,o){r.push({elem:t,load:function(n){return t.css("background-image","none"),t.on("load",function(){t.css("opacity",1)}),t.attr("src",o.yLazySrc),n>=0&&r.del(n),e.$destroy(),!0}}),c()}}}]).directive("yBindHtml",["$compile",function(e){return{restrict:"A",link:function(t,o,n){t.$watch(function(){return t.$eval(n.yBindHtml)},function(a){o.html(a&&a.toString());var r=t;n.bindHtmlScope&&(r=t.$eval(n.bindHtmlScope)),e(o.contents())(r)})}}}]).directive("yRecommendManual",function(){return{restrict:"E",scope:{id:"@",type:"@",title:"@",category:"@",source:"@",picUrl:"@",hostName:"@",priceStr:"@",districtName:"@",pos:"@"},template:'<section><div ng-if="type==3 || type==4 || type==5" class="recommend_manual"><a ng-click="openRecommendManual()" ng-bind="title"></a></div>            <div ng-if="pos==0" class="first_title"><em></em><span>点击下方查看详情</span><em></em></div>                        <div ng-if="type==1 || type==2" class="recommend_topic" alt="{{type}}">                            <a ng-click="openRecommendManual()">                                <div class="img_wrap">                                    <img class="lazy_img" y-lazy-src="{{picUrl}}">                                </div>                                <div class="blackcover"></div>                                <div class="pos">                                    <p class="hostname" ng-bind="hostName"></p>                                    <p class="mealname" ng-bind="title"></p>                                    <p class="price" ng-bind="priceStr" ng-class="{\'bottom\': (districtName!=\'\')}"></p>                                    <p class="address" ng-bind="districtName"></p>                                </div>                            </a>                        </div></section>',replace:!0,controller:["$rootScope","$scope",function(e,t){t.openRecommendManual=function(){var o="";"guide"===t.category?"1"===t.type?o="Guide Recommend Click Event":"2"===t.type&&(o="Guide Recommend Click Meal"):"news"===t.category?"1"===t.type?o="News Recommend Click Event":"2"===t.type&&(o="News Recommend Click Meal"):"experience"===t.category&&("1"===t.type?o="Experience Recommend Click Event":"2"===t.type&&(o="Experience Recommend Click Meal")),"undefined"!=typeof _paq&&_paq.push(["trackEvent",o,t.source+" "+e.page.pageTitle,t.id]),e.openContentUrl(t.type,t.id)}}]}}).directive("yUseCoupon",function(){return{restrict:"E",scope:!1,template:'<li style="display: table; width: 100%;">                            <div class="list_left">使用优惠券</div>                            <div class="list_right right_arrow" ng-if="couponList.usable.length > 0 && couponList.discount === \'\'" ng-bind="couponList.usable.length+ \'张可用优惠券\'" ng-click="showCoupon()"></div>                            <div class="list_right right_arrow" ng-if="couponList.usable.length === 0"  ng-click="showCoupon()">没有可用贵宾券</div>                            <div class="list_right right_arrow" ng-if="couponList.usable.length > 0  && couponList.discount !== \'\'" ng-bind="\'优惠金额：\'+couponList.discount" ng-click="showCoupon()"></div>                        </li>',replace:!0}}).directive("yChooseTime",function(){return{restrict:"E",scope:!1,template:'<section ng-if="reserve.showPickTime">                            <div class="mask" ng-click="reserve.closeMask()"></div>                            <div class="meal_picker">                                <ul class="headline">                                    <li ng-click="reserve.pickDatetime()">取消</li>                                    <li class="title">日期和时间</li>                                    <li ng-click="reserve.dateTimeConfirm()">确定</li>                                </ul>                                <ul class="pick_holder date_time_holder">                                    <li>                                        <p class="pick_col" ng-class="{bottom_pop_active:(d.date == reserve.date)}" ng-repeat="d in reserve.dates" ng-bind="d.date" ng-click="reserve.chooseDate(d)"></p>                                    </li>                                    <li>                                        <p class="pick_col" ng-class="{bottom_pop_active:(t == reserve.time)}" ng-repeat="t in reserve.timeArray" ng-bind="t" ng-click="reserve.chooseTime(t)"></p>                                    </li>                                </ul>                            </div>                        </section>',
replace:!0}}).directive("yConfirmDialog",function(){return{restrict:"E",scope:!1,template:'<section ng-if="dialog.showConfirm">                            <div class="mask" ng-click="dialog.cancel()"></div>                            <div class="open_dialog">                                <h2 class="dialog_theme" ng-bind="dialog.theme"></h2>                                <p class="dialog_desc" ng-bind="dialog.desc"></p>                                <div class="dialog_btn">                                    <button ng-click="dialog.cancel()" ng-bind="dialog.leftBtn"></button>                                    <button ng-click="dialog.confirm()" ng-bind="dialog.rightBtn"></button>                                </div>                            </div>                        </section>',replace:!0}}).directive("ySnsDialog",function(){return{restrict:"E",scope:!1,template:'<section ng-if="snsDialog.showConfirm">                            <div class="mask" ng-click="snsDialog.cancel()"></div>                            <div class="open_dialog">                                <h2 class="dialog_theme" ng-bind="snsDialog.theme"></h2>                                <p class="dialog_desc" ng-bind="snsDialog.desc"></p>                                <div class="dialog_btn">                                    <button ng-click="snsDialog.cancel()" ng-bind="snsDialog.leftBtn"></button>                                    <button ng-click="snsDialog.confirm()" ng-bind="snsDialog.rightBtn"></button>                                </div>                            </div>                        </section>',replace:!0}}).directive("yTipDialog",function(){return{restrict:"E",scope:!1,template:'<section ng-if="tipDialog.showConfirm">                            <div class="mask" ng-click="tipDialog.cancel()"></div>                            <div class="open_dialog">                                <h2 class="dialog_theme" ng-bind="tipDialog.theme"></h2>                                <p class="dialog_desc" ng-bind="tipDialog.desc"></p>                                <div class="dialog_btn" ng-click="tipDialog.confirm()" ng-bind="tipDialog.btn"></div>                            </div>                        </section>',replace:!0}}).directive("checkapi",["$window","$http","commonService",function(e,t,o){return{restrict:"A",scope:{apiType:"="},link:function(e,t,n){1==e.apiType?o.checkApi().success(function(e,o,n){t.html(e.API)}):o.checkSapi().success(function(e,o,n){t.html(e.API)})}}}]).directive("yhouseBanner",function(){return{restrict:"E",scope:!1,template:'<div class="sku_yhouse_banner" ng-if="page.showApp2" ng-class="{\'third_bg\': page.shareUi}">                            <a ng-if="!page.shareUi" ng-href="{{univseralLinksURL}}/{{univseralLinksParams}}" target="_self" class="open_url">打开APP</a>                            <a ng-if="page.shareUi" ng-href="/promo/SHAREUI" class="open_url">领取</a>                        </div>',replace:!0}}).directive("errSrc",function(){return{link:function(e,t,o){t.bind("error",function(){o.src!=o.errSrc&&o.$set("src",o.errSrc)})}}}).directive("minHeight",function(){return{link:function(e,t,o){t[0].style.minHeight=document.documentElement.clientHeight+"px"}}}).directive("webcastliveTimer",["$timeout","$compile",function(e,t){return{restrict:"A",replace:!1,scope:{interval:"=interval",startTimeAttr:"=startTime",countdownattr:"=countdown"},controller:["$scope","$element",function(e,o){function n(){e.timeoutId&&clearTimeout(e.timeoutId)}0===o.html().trim().length&&o.append(t("<span>{{millis}}</span>")(e)),e.startTime=null,e.timeoutId=null,e.countdown=e.countdownattr&&parseInt(e.countdownattr,10)>0?parseInt(e.countdownattr,10):void 0,e.isRunning=!1,e.$parent.$on("timer-start",function(){e.start()}),e.$parent.$on("timer-resume",function(){e.resume()}),e.$parent.$on("timer-stop",function(){e.stop()}),e.start=o[0].start=function(){e.startTime=e.$parent.attendInfo.createTime?new Date(e.$parent.attendInfo.createTime):new Date,n(),a()},e.resume=o[0].resume=function(){n(),e.startTime=new Date-(e.stoppedTime-e.startTime),a()},e.stop=o[0].stop=function(){e.stoppedTime=new Date,n(),e.timeoutId=null},o.bind("$destroy",function(){n()});var a=function(){e.countdown>0?e.countdown--:e.countdown<=0&&e.stop(),e.millis=new Date-e.startTime,e.countdown>0&&(e.millis=1e3*e.countdown),e.$parent.seconds=Math.floor(e.millis/1e3%60),e.$parent.seconds<10&&(e.$parent.seconds="0"+e.$parent.seconds),e.$parent.minutes=Math.floor(e.millis/6e4%60),e.$parent.minutes<10&&(e.$parent.minutes="0"+e.$parent.minutes),e.$parent.hours=Math.floor(e.millis/36e5%24),e.$parent.hours<10&&(e.$parent.hours="0"+e.$parent.hours),e.days=Math.floor(e.millis/36e5/24),e.timeoutId=setTimeout(function(){a(),e.$apply()},e.interval),e.$emit("timer-tick",{timeoutId:e.timeoutId,millis:e.millis})}}]}}]),angular.module("ui.bootstrap",["ui.bootstrap.module.carousel","ui.bootstrap.carousel"]),angular.module("ui.bootstrap.module.carousel",["ui.bootstrap.carousel","uib/template/carousel/carousel.html","uib/template/carousel/slide.html"]),angular.module("ui.bootstrap.carousel",[]).controller("UibCarouselController",["$scope","$element","$interval","$timeout","$animate",function(e,t,o,n,a){function r(){for(;b.length;)b.shift()}function i(e){for(var t=0;t<f.length;t++)f[t].slide.active=t===e}function s(o,n,l){if(!I){if(angular.extend(o,{direction:l}),angular.extend(f[v].slide||{},{direction:l}),a.enabled(t)&&!e.$currentTransition&&f[n].element&&g.slides.length>1){f[n].element.data(y,o.direction);var c=g.getCurrentIndex();angular.isNumber(c)&&f[c].element&&f[c].element.data(y,o.direction),e.$currentTransition=!0,a.on("addClass",f[n].element,function(t,o){if("close"===o&&(e.$currentTransition=null,a.off("addClass",t),b.length)){var n=b.pop().slide,i=n.index,l=i>g.getCurrentIndex()?"next":"prev";r(),s(n,i,l)}})}e.active=o.index,v=o.index,i(n),p()}}function l(e){for(var t=0;t<f.length;t++)if(f[t].slide===e)return t}function c(){m&&(o.cancel(m),m=null)}function d(t){t.length||(e.$currentTransition=null,r())}function p(){c();var t=+e.interval;!isNaN(t)&&t>0&&(m=o(u,t))}function u(){var t=+e.interval;h&&!isNaN(t)&&t>0&&f.length?e.next():e.pause()}var m,h,g=this,f=g.slides=e.slides=[],y="uib-slideDirection",v=e.active,b=[];e.stopActions=function(e){e.stopPropagation&&e.stopPropagation()};var I=!1;g.addSlide=function(t,o){f.push({slide:t,element:o}),f.sort(function(e,t){return+e.slide.index>+t.slide.index}),(t.index===e.active||1===f.length&&!angular.isNumber(e.active))&&(e.$currentTransition&&(e.$currentTransition=null),v=t.index,e.active=t.index,i(v),g.select(f[l(t)]),1===f.length&&e.play())},g.getCurrentIndex=function(){for(var e=0;e<f.length;e++)if(f[e].slide.index===v)return e},g.next=e.next=function(){var e=(g.getCurrentIndex()+1)%f.length;return g.select(f[e],"next")},g.prev=e.prev=function(){var e=g.getCurrentIndex()-1<0?f.length-1:g.getCurrentIndex()-1;return g.select(f[e],"prev")},g.removeSlide=function(t){var o=l(t),n=b.indexOf(f[o]);-1!==n&&b.splice(n,1),f.splice(o,1),f.length>0&&v===o?o>=f.length?(v=f.length-1,e.active=v,i(v),g.select(f[f.length-1])):(v=o,e.active=v,i(v),g.select(f[o])):v>o&&(v--,e.active=v),0===f.length&&(v=null,e.active=null,r())},g.select=e.select=function(t,o){var n=l(t.slide);void 0===o&&(o=n>g.getCurrentIndex()?"next":"prev"),e.$currentTransition=!1,t.slide.index===v||e.$currentTransition?t&&t.slide.index!==v&&e.$currentTransition&&b.push(f[n]):s(t.slide,n,o)},e.indexOfSlide=function(e){return+e.slide.index},e.isActive=function(t){return e.active===t.slide.index},e.pause=function(){e.noPause||(h=!1,c())},e.play=function(){h||(h=!0,p())},e.$on("$destroy",function(){I=!0,c()}),e.$watch("noTransition",function(e){a.enabled(t,!e)}),e.$watch("interval",p),e.$watchCollection("slides",d),e.$watch("active",function(e){if(angular.isNumber(e)&&v!==e){for(var t=0;t<f.length;t++)if(f[t].slide.index===e){e=t;break}var o=f[e];o&&(i(e),g.select(f[e]),v=e)}})}]).directive("uibCarousel",function(){return{transclude:!0,replace:!0,controller:"UibCarouselController",controllerAs:"carousel",templateUrl:function(e,t){return t.templateUrl||"uib/template/carousel/carousel.html"},scope:{active:"=",interval:"=",noTransition:"=",noPause:"=",noWrap:"&"}}}).directive("uibSlide",function(){return{require:"^uibCarousel",transclude:!0,replace:!0,templateUrl:function(e,t){return t.templateUrl||"uib/template/carousel/slide.html"},scope:{actual:"=?",index:"=?"},link:function(e,t,o,n){n.addSlide(e,t),e.$on("$destroy",function(){n.removeSlide(e)})}}}).animation(".item",["$animateCss",function(e){function t(e,t,o){e.removeClass(t),o&&o()}var o="uib-slideDirection";return{beforeAddClass:function(n,a,r){if("active"===a){var i=!1,s=n.data(o),l="next"===s?"left":"right",c=t.bind(this,n,l+" "+s,r);return n.addClass(s),e(n,{addClass:l}).start().done(c),function(){i=!0}}r()},beforeRemoveClass:function(n,a,r){if("active"===a){var i=!1,s=n.data(o),l="next"===s?"left":"right",c=t.bind(this,n,l,r);return e(n,{addClass:l}).start().done(c),function(){i=!0}}r()}}}]),angular.module("uib/template/carousel/carousel.html",[]).run(["$templateCache",function(e){e.put("uib/template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev();stopActions($event)" ng-swipe-left="next();stopActions($event);">\n    <div class="carousel-inner" ng-transclude></div>\n    <ol class="carousel-indicators" ng-show="slides.length > 1">\n        <li ng-repeat="slide in slides | orderBy:indexOfSlide track by $index" ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>\n    </ol>\n</div>\n')}]),angular.module("uib/template/carousel/slide.html",[]).run(["$templateCache",function(e){e.put("uib/template/carousel/slide.html",'<div ng-class="{\'active\': active}" class="item" ng-transclude></div>\n')}]),!angular.$$csp()&&angular.element(document).find("head").prepend('<style type="text/css">.ng-animate.item:not(.left):not(.right){-webkit-transition:0s ease-in-out left;transition:0s ease-in-out left}</style>'),mainApp.controller("emptyController",["$scope","$rootScope","$window","$timeout",function(e,t,o,n){var a=document.createElement("script"),r=document.getElementsByTagName("script")[0];a.type="text/javascript",a.text='var element = angular.element(document.getElementById("mainApp"));var controller = element.controller();var scope = element.scope();function appInstall(){if (typeof _paq !== "undefined") {_paq.push(["trackPageView", "APP Install"]);}};function appLoad(){if (typeof _paq !== "undefined") {_paq.push(["trackPageView", "APP Load"]);}};function appReload(){window.location.reload(true);};function setCityId(cityId){window.localStorage.setItem("cityId", cityId)};function setCatalogId(catalogId){window.localStorage.setItem("catalogId", catalogId);scope.$root.reloadPv(catalogId);};function setDiscoverSubCatalogId(subCatalogId){window.localStorage.setItem("subDiscoverCatalogId", subCatalogId)};function setLiveSubCatalogId(subCatalogId){window.localStorage.setItem("subLiveCatalogId", subCatalogId)};function setAdPV(adId){scope.$root.reloadAdPv(adId)};function setAdClick(adId, adType, xPosition, yPosition){scope.$root.adClick(adId, adType, xPosition, yPosition)};',r.parentNode.insertBefore(a,r)}]),mainApp.controller("eventController",["$scope","$rootScope","$location","$window","$cookies","$timeout","$routeParams","$sce","eventService","utilService","commonService",function(e,t,o,n,a,r,i,s,l,c,d){e.data=null,e.event=null,e.descriptionTitle=null,e.cmEvent=!1,e.hideBuy=!0,o.search()&&"1"===o.search().hide_buy&&(e.hideBuy=!1);var p=c.clearId(i.eventId);l.event(p).success(function(r,i,s){if("0"===r.code){if(t.appGt("3.2")){var l=JSON.parse(JSON.stringify(r.data));delete l.content,delete l.description,delete l.highlight,delete l.highs,delete l.productAdvice,delete l.refundDesc,l.shareUrl+="undefined"!=typeof a.get("UI")?"&share_ui="+a.get("UI"):"",n.location="yhouse://broker?scheme="+encodeURIComponent("event/"+p)+"&use=data&data="+encodeURIComponent(JSON.stringify(l))}e.data=r,e.event=r.data,e.data.type="event",img_url=null==e.data.data.mPicUrl?e.data.data.picUrl:e.data.data.mPicUrl,t.inAPP?e.imUrl="yhouse://web?title="+encodeURIComponent("在线客服")+"&url="+encodeURIComponent(document.location.protocol+"//"+document.location.host+"/cs-im-app?imgurl="+encodeURIComponent(img_url)+"&type=event&id="+e.data.data.id+"&itemtitle="+encodeURIComponent(e.data.data.title)+"&address="+encodeURIComponent(e.data.data.address)+"&price="+encodeURIComponent(e.data.data.price))+"&isBack=1&hideShortcut=1":e.imUrl="/cs-im?from=&imgurl="+encodeURIComponent(img_url)+"&img_url="+encodeURIComponent(img_url)+"&type=event&id="+e.data.data.id+"&itemtitle="+encodeURIComponent(e.data.data.title)+"&address="+encodeURIComponent(e.data.data.address)+"&price="+encodeURIComponent(e.data.data.price)+"&hideShortcut=1",c.isEmptyNumber(e.event.cmId)||(e.cmEvent=!0,n.localStorage.setItem("cmEventId",e.event.id),e.data.data.content=c.handleImage(e.data.data.content)),0===e.event.eventType||2===e.event.eventType?(e.data.descriptionTitle="活动详情",e.data.descriptionBtn="完整活动详情"):1===e.event.eventType&&(e.data.descriptionTitle="课程介绍",e.data.descriptionBtn="完整课程介绍");try{n.localStorage.setItem("eventInfo",JSON.stringify(r))}catch(u){}if(e.event.headPics&&e.event.headPics.length>0){for(var m=[],h=0;h<e.event.headPics.length;h++)m[h]={imgSrc:e.event.headPics[h]};e.event.headPics=m}t.page.pageTitle=r.data.title,t.$emit("pageTitleChanged"),r.data.content=c.handleImage(r.data.content),t.inWX&&(null!=t.currentUser&&"undefined"!=typeof t.currentUser&&t.currentUser.promocode?d.initWxConfig(o.absUrl(),r.data.title,"YHOUSE精选美食与玩乐。使用我的邀请码"+t.currentUser.promoAlias+"，获得50元首单优惠！",o.absUrl(),r.data.sPicUrl):d.initWxConfig(o.absUrl(),r.data.title,"YHOUSE精选美食与玩乐，款待最重要的人。",o.absUrl(),r.data.sPicUrl)),1===e.event.isFree&&1===e.event.reserveType&&(t.page.showPaddingBottom=!1)}else t.inAPP?e.data=r:o.path("/404")}).error(function(){o.path("/404")}),e.openFacility=function(a){if("undefined"!=typeof _paq&&_paq.push(["trackEvent",c.getEventKey(e.event.eventType),"More "+a,p]),t.inAPP){var r=o.protocol()+"://"+o.host();"highlight"===a?n.location="yhouse://sku-pop?title="+encodeURIComponent("推荐理由")+"&icon="+encodeURIComponent("http://r.yhres.com/sku/special@3x.png")+"&url="+encodeURIComponent(r+"/sku-pop-app/event/highlight/"+p):"content"===a?n.location="yhouse://sku-pop?title="+encodeURIComponent(e.data.descriptionTitle)+"&icon="+encodeURIComponent("http://r.yhres.com/sku/menu@3x.png")+"&url="+encodeURIComponent(r+"/sku-pop-app/event/content/"+p):"facility"===a&&(n.location="yhouse://sku-pop?title="+encodeURIComponent("注意事项")+"&icon="+encodeURIComponent("http://r.yhres.com/sku/facilities@3x.png")+"&url="+encodeURIComponent(r+"/sku-pop-app/event/facility/"+p))}else o.path("/sku-pop/event/"+a+"/"+p)},e.bookFree=function(e,t){"undefined"!=typeof _paq&&_paq.push(["trackEvent",c.getEventKey(t),c.getEventKey(t)+" free order",e]),c.openApp("/"+c.getEventKey(t)+"/"+e,!1)},e.orderEvent=function(e,t){"undefined"!=typeof _paq&&_paq.push(["trackEvent",c.getEventKey(t),c.getEventKey(t)+" order",e]),o.path("/"+c.getEventKey(t)+"-order/"+e)}}]),mainApp.controller("eventOrderController",["$scope","$rootScope","$location","$routeParams","$window","$timeout","eventService","utilService",function(e,t,o,n,a,r,i,s){e.eventOrder=null,i.event(n.eventId).success(function(l,c,d){if(l.data.id)if(1==l.data.flag&&2==l.data.isFree){if(t.page.pageTitle=l.data.title,e.eventOrder=l.data,e.eventOrder.orderNum=1,e.eventOrder.userName="",e.eventOrder.phoneNum="",e.eventOrder.editPhone=!0,e.eventOrder.userId=0,e.eventOrder.bindPhone="",t.userOrderInfo?(e.eventOrder.userName=t.userOrderInfo.userName,e.eventOrder.bindPhone=t.userOrderInfo.phoneNum,e.eventOrder.editPhone=!1):t.currentUser&&(e.eventOrder.userName=t.currentUser.name,e.eventOrder.userId=t.currentUser.id,null!==t.currentUser.bindPhone&&"undefined"!=typeof t.currentUser.bindPhone&&""!==t.currentUser.bindPhone&&(e.eventOrder.bindPhone=t.currentUser.bindPhone,e.eventOrder.editPhone=!1)),e.editPhone=function(){e.eventOrder.editPhone=!0,e.$watch("eventOrder.phoneNum",function(){e.eventOrder.phoneNum==e.eventOrder.bindPhone&&(e.eventOrder.phoneNum="",e.eventOrder.editPhone=!1)})},e.canOrderNum=e.eventOrder.limitation,e.eventOrder.field&&e.eventOrder.field.length)for(var p=0;p<e.eventOrder.field.length;p++)if(e.eventOrder.field[p].maxJoinNum>e.eventOrder.field[p].totalJoinNum){e.eventOrder.fieldInfo=e.eventOrder.field[p].id;break}e.$watch("eventOrder.fieldInfo",function(t,o){for(var n=e.eventOrder.field,a=0,r=0;r<n.length;r++)if(n[r].id==t){a=n[r].maxJoinNum-n[r].totalJoinNum,e.eventOrder.neededCredits=n[r].neededCredits,e.totalPrice=e.eventOrder.neededCredits*e.eventOrder.orderNum;break}a>0&&(e.canOrderNum=a),0===a&&e.eventOrder.field&&e.eventOrder.field.length&&(e.canOrderNum=a)}),e.$watch("eventOrder.orderNum",function(t,o){isNaN(e.eventOrder.neededCredits)||(e.totalPrice=e.eventOrder.neededCredits*e.eventOrder.orderNum)}),e.enableSubmit=!0,e.submitOrder=function(){if(e.enableSubmit){if(e.enableSubmit=!1,e.eventOrder.field&&e.eventOrder.field.length&&"undefined"==typeof e.eventOrder.fieldInfo)return t.showDialog("请选择场次！"),r(function(){e.enableSubmit=!0},0),!1;if(""===e.eventOrder.orderNum||""===e.eventOrder.userName)return t.showDialog("请输入完整信息再提交！"),r(function(){e.enableSubmit=!0},0),!1;var l=e.eventOrder.bindPhone;if(e.eventOrder.editPhone){if(""===e.eventOrder.phoneNum)return t.showDialog("请输入手机号获取和输入验证码再提交！"),r(function(){e.enableSubmit=!0},0),!1;if(""===e.eventOrder.codeNum||"undefined"==typeof e.eventOrder.codeNum)return t.showDialog("请获取和输入验证码再提交！"),r(function(){e.enableSubmit=!0},0),!1;l=e.eventOrder.phoneNum}"undefined"!=typeof _paq&&_paq.push(["trackEvent",s.getEventKey(e.eventOrder.eventType),s.getEventKey(e.eventOrder.eventType)+" pay",n.eventId]),i.submitOrder(e.eventOrder.userId,n.eventId,e.eventOrder.fieldInfo,e.eventOrder.orderNum,l,e.eventOrder.userName,e.eventOrder.codeNum,"").success(function(r){if(!r.hasOwnProperty("code")||"0"!==r.code)return t.showDialog(r.message),e.enableSubmit=!0,!1;t.eventOrderInfo=r.data;try{a.sessionStorage.setItem("eventOrderInfo",JSON.stringify(r.data))}catch(i){}if(null!==r.data.userInfo&&"undefined"!=typeof r.data.userInfo)try{a.sessionStorage.setItem("currentUser",JSON.stringify(r.data.userInfo))}catch(i){}t.userOrderInfo={userName:e.eventOrder.userName,phoneNum:l};try{a.sessionStorage.setItem("userOrderInfo",JSON.stringify(t.userOrderInfo))}catch(i){}1===e.eventOrder.isFree?o.path("/"+s.getEventKey(e.eventOrder.eventType)+"/"+n.eventId):o.path("/"+s.getEventKey(e.eventOrder.eventType)+"-pay"),e.enableSubmit=!0}).error(function(o){return o.hasOwnProperty("status")&&500===o.status?(t.showDialog(o.message),e.enableSubmit=!0,!1):void 0})}}}else o.path("/"+s.getEventKey(l.data.eventType)+"/"+l.data.id).replace();else o.path("/404")}).error(function(e){e.hasOwnProperty("status")&&500===e.status&&(t.showDialog(e.message),setTimeout(function(){o.path("/")},1e3))})}]),mainApp.controller("eventPayController",["$scope","$rootScope","$location","$routeParams","$window","orderService","utilService","commonService",function(e,t,o,n,a,r,i,s){if(t.inWX&&(a.sessionStorage.getItem("refreshInWXForPay")?a.sessionStorage.removeItem("refreshInWXForPay"):(a.sessionStorage.setItem("refreshInWXForPay","refreshed"),a.location.reload())),e.eventOrder=t.eventOrderInfo,e.eventOrder.wxLimit=i.payLimit().wxLimit,e.eventOrder.alipayLimit=i.payLimit().alipayLimit,e.eventOrder.cardLimit=i.payLimit().cardLimit,e.eventOrder.unionPayLimit=i.payLimit().unionPayLimit,e.eventOrder.unionWebPayLimit=i.payLimit().unionWebPayLimit,e.eventOrder.cmbPayLimit=i.payLimit().cmbPayLimit,e.eventOrder.isWx=!1,e.eventOrder.isAlipay=!1,e.eventOrder.isCard=!1,e.eventOrder.isUnionPay=!1,e.eventOrder.isUnionWebPay=!1,e.eventOrder.isCmbPay=!1,e.eventOrder.channelPromocode&&e.eventOrder.channelPromocode.discount&&e.eventOrder.totalPay-e.eventOrder.channelPromocode.discount>0?(e.eventOrder.displayTotalPay=e.eventOrder.totalPay-e.eventOrder.channelPromocode.discount,e.eventOrder.couponCode=e.eventOrder.channelPromocode.promocode):(e.eventOrder.couponCode="",e.eventOrder.displayTotalPay=e.eventOrder.totalPay),t.inAlipay)e.eventOrder.totalPay>e.eventOrder.alipayLimit?e.eventOrder.payType="dae":(e.eventOrder.payType="alipay",e.eventOrder.isAlipay=!0);else if(a.localStorage.getItem("cmEventId")&&a.localStorage.getItem("cmEventId")==e.eventOrder.eventInfoId)e.eventOrder.payType="alipay",e.eventOrder.isAlipay=!0;else if(t.inWX)e.eventOrder.totalPay>e.eventOrder.wxLimit?e.eventOrder.payType="dae":(e.eventOrder.payType="wx",e.eventOrder.isWx=!0);else if(t.inUnionPay){if("undefined"==typeof UPSdk){var l=document.createElement("script");l.src=i.unionPayPara().unionPayScript;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(l,c)}e.eventOrder.totalPay>e.eventOrder.unionPayLimit?e.eventOrder.payType="dae":(e.eventOrder.payType="unionpay",e.eventOrder.isUnionPay=!0)}else e.eventOrder.totalPay>e.eventOrder.alipayLimit?e.eventOrder.payType="dae":(e.eventOrder.payType="alipay",e.eventOrder.isAlipay=!0,e.eventOrder.isUnionWebPay=e.eventOrder.unionWebPayLimit>=e.eventOrder.totalPay);e.enableSubmit=!0,e.submitOrderPay=function(){if(!e.enableSubmit)return!1;if(e.enableSubmit=!1,"undefined"==typeof e.eventOrder.payType)return t.showDialog("请选择支付方式！"),e.enableSubmit=!0,!1;if("undefined"!=typeof _paq&&_paq.push(["trackEvent","Event","Event Pay Submit",e.eventOrder.id]),"wx"===e.eventOrder.payType)r.submitOrderPayWX(e.eventOrder.id,null,1,e.eventOrder.couponCode).success(function(o,n,i){function s(o){var n=o.outTradeNo;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:""+o.appId,timeStamp:""+o.timeStamp,nonceStr:""+o.nonceStr,"package":""+o["package"],signType:""+o.signType,paySign:""+o.paySign},function(o){return"get_brand_wcpay_request:ok"===o.err_msg?(a.location.href=r.orderPayBack(n),!0):(t.showDialog("支付失败！"),e.enableSubmit=!0,!1)})}return"0"!==o.code?void("2300"===o.code&&o.data.outTradeNo?a.location.href=r.orderPayBack(o.data.outTradeNo):(t.showDialog(o.message),e.enableSubmit=!0)):("undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",s,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",s),document.attachEvent("onWeixinJSBridgeReady",s)):s(o.data),void(e.enableSubmit=!0))})["catch"](function(){return t.showDialog("无法使用微信支付！"),e.enableSubmit=!0,!1});else if("alipay"===e.eventOrder.payType||"unionwebpay"===e.eventOrder.payType||"cmbpay"===e.eventOrder.payType){var o;"alipay"===e.eventOrder.payType&&(o=r.submitOrderPayAlipay(e.eventOrder.id,1,"/event-pay",e.eventOrder.couponCode)),"unionwebpay"===e.eventOrder.payType&&(o=r.submitOrderPayUnionWebPay(e.eventOrder.id,1,"/event-pay",e.eventOrder.couponCode)),"cmbpay"===e.eventOrder.payType&&(o=r.submitOrderPayCmbpay(e.eventOrder.id,1,"/event-pay",e.eventOrder.couponCode)),null!==o&&(a.location.href=o),e.enableSubmit=!0}else"card"===e.eventOrder.payType||"unionpay"===e.eventOrder.payType&&(UPSdk.config({debug:i.unionPayPara().unionPayDebug,appId:i.unionPayPara().unionPayAppId,appName:i.unionPayPara().unionPayAppName}),UPSdk.ready(function(){UPSdk.getUserInfo({success:function(o){r.submitOrderPayUP(e.eventOrder.id,1,e.eventOrder.couponCode).success(function(o,n,i){return"0"!==o.code?void("2300"===o.code&&o.data.outTradeNo?a.location.href=r.orderPayBack(o.data.outTradeNo):(t.showDialog(o.message),e.enableSubmit=!0)):void UPSdk.payOrder({params:{tn:o.data.tn},success:function(o){return"00"===o.code?(a.location.href=r.orderPayBack(o.data.outTradeNo),!0):(t.showDialog("支付失败！"),e.enableSubmit=!0,!1)},fail:function(o){return t.showDialog("支付失败！"),e.enableSubmit=!0,!1}})})["catch"](function(){return t.showDialog("无法使用银联钱包支付！"),e.enableSubmit=!0,!1})},fail:function(e){}})}))},e.couponList={showCoupon:!1,usable:[],unusable:[],exchangeCode:"",discount:""},e.queryCoupon=function(){s.promoList(1,t.eventOrderInfo.event.id).success(function(t,o,n){"0"===t.code&&(e.couponList.usable=t.data.alist,e.couponList.unusable=t.data.ulist,setTimeout(function(){document.getElementsByClassName("coupon")[0].style.height=window.innerHeight-95+"px"},500))})},t.page.allowCoupon&&e.queryCoupon(),e.exchange=function(){""===e.couponList.exchangeCode?t.showDialog("请输入兑换码"):s.promo22(e.couponList.exchangeCode).success(function(o,n,a){e.couponList.exchangeCode="","0"===o.code?e.queryCoupon():t.showDialog(o.message)})},e.showCoupon=function(){e.couponList.showCoupon=!0},e.hideCoupon=function(){e.couponList.showCoupon=!1},e.nonuseCoupon=function(){e.eventOrder.couponCode="",e.couponList.discount="",e.eventOrder.displayTotalPay=e.eventOrder.totalPay,e.couponList.showCoupon=!1},e.useCoupon=function(t,o){e.eventOrder.couponCode=t,e.eventOrder.displayTotalPay=e.eventOrder.totalPay>o?e.eventOrder.totalPay-o:0,e.couponList.discount=o,e.couponList.showCoupon=!1}}]),mainApp.controller("experienceController",["$window","$scope","$filter","$rootScope","$location","$cookies","$routeParams","utilService","infoService",function(e,t,o,n,a,r,i,s,l){t.experience=null;var c=s.clearId(i.experienceId);l.experience(c).success(function(o,i,l){if("0"===o.code&&o.data){if(n.appGt("3.2")){var d=encodeURIComponent(JSON.stringify({id:c,isInterested:o.data.isInterested?1:0,sPicUrl:o.data.picUrl,description:o.data.label,title:o.data.title,shareUrl:o.data.shareUrl+("undefined"!=typeof r.get("UI")?"&share_ui="+r.get("UI"):"")}));e.location="yhouse://broker?scheme="+encodeURIComponent("experience/"+c)+"&use=share&data="+d}n.page.pageTitle=o.data.title,n.$emit("pageTitleChanged"),o.data.content=s.handleRecommendManual("experience",o,n.inAPP),o.data.content=s.handleImage(o.data.content,!1),t.experience=o.data}else a.path("/404")}).error(function(){a.path("/404")})}]),mainApp.filter("yPhoneNumStarred",function(){return function(e){return e&&11===e.length?e.substring(0,3)+"****"+e.substring(7,11):void 0}}).filter("yPhoneNumCall",function(){return function(e){if(e){if(e.indexOf(",")>0){for(var t="",o=0;o<e.split(",").length;o++)t+="<a href='tel:"+e.split(",")[o]+"'>"+e.split(",")[o]+"</a>",o!=e.split(",").length-1&&(t+=",");return t}return"<a href='tel:"+e+"'>"+e+"</a>"}}}).filter("yMap",function(){return function(e){return e?e[2]&&e[3]?'<a href="http://apis.map.qq.com/uri/v1/marker?marker=coord:'+e[2]+","+e[3]+";title:"+e[1]+'&referer=YHOUSE">'+e[0]+"</a>":"<a>"+e[0]+"</a>":void 0}}).filter("yMapInvitation",function(){return function(e){if(e){if(e[2]&&e[3]){for(var t=0,o=e[0],n=0;n<o.length;n++)t+=o.charCodeAt(n)<0||o.charCodeAt(n)>255?2:1;return t>32?"<p>"+e[0]+'&nbsp;&nbsp;&nbsp;<a class="invitation_address_map" href="http://apis.map.qq.com/uri/v1/marker?marker=coord:'+e[2]+","+e[3]+";title:"+e[1]+'&referer=YHOUSE">看地图</a></p>':"<p>"+e[0]+'<br/><a class="invitation_address_map" href="http://apis.map.qq.com/uri/v1/marker?marker=coord:'+e[2]+","+e[3]+";title:"+e[1]+'&referer=YHOUSE">看地图</a></p>'}return"<a>"+e[0]+"</a>"}}}).filter("yTopicType",["$rootScope","utilService",function(e,t){return function(t){var o={url:"/",addType:"Event"},n=["","event/","meal/","guide/","experience/","news/","topic/","host/"],a=["","Event","Meal","Guide","Experience","News","Topic","Host"];return o.url=n[t.dataType]+t.linkId,o.addType=a[t.dataType],e.inAPP?7==t.dataType||"host"===t.dataType?e.appGt("2.8")?o.url="yhouse://"+o.url:o.url="/"+o.url:o.url="yhouse://"+o.url:o.url="/"+o.url,o}}]).filter("ySkuType",["$rootScope",function(e){return function(t){var o={url:"/",addType:"Event"},n=["","event/","meal/","guide/","experience/","news/"],a=["","Event","Meal","Guide","Experience","News"];return 1===t.contentType||2===t.contentType||3===t.contentType||4===t.contentType||5===t.contentType?(o.url=n[t.contentType]+t.data.id,o.addType=a[t.contentType]):(o.url="/"+o.url,o.addType="Event"),o.url=e.inAPP?"yhouse://"+o.url:"/"+o.url,o}}]).filter("yUserName",function(){return function(e){return e&&e.length>12?e.substring(0,9)+"...":e}}).filter("yPrice",function(){return function(e){if(e){if(e.indexOf("元")>0){for(var t="",o=0;o<e.length;o++)"元"===e[o]&&(t+=e.substring(0,o)+"<em>"+e.substring(o,e.length)+"</em>");return t}return e}return e}}).filter("yImgSuffix",["$rootScope",function(e){return function(t,o){if("undefined"!=typeof t&&null!=t&&""!=t){var n=["-q75","-q75h","-q75hm","-q75m","-sq75","-ssq75","-sq75h","-smq75"];return e.inAPP&&(n=["-q75","-q75h","-q75h","-q75","-sq75","-ssq75","-sq75h","-smq75"]),n[o]?t.match(/-s{0,2}m?q75h?m?$/)?t.replace(/-s{0,2}m?q75h?m?$/,n[o]):t+n[o]:t}}}]).filter("yLiveOrVideo",function(){return function(e){var t="/";return 2==e.shareType?t="/webcast-video/"+e.id:3==e.shareType&&(t="/webcast-live/"+e.id),t}}).filter("yAdsAutoRecommend",["$rootScope","$window",function(e,t){return function(o,n,a,r){var i,s;"meal"===a?i=n:s=n;var l=t.localStorage.getItem("cityId"),c=-1;e.inAPP&&(c=/(iPhone|iPad|iPod|iOS)/i.test(t.navigator.userAgent.toLowerCase())?-3:-2);var d="";i?d=2:s&&("0"==r?d=1:"1"==r?d=3:"2"==r&&(d=7));var p=t.localStorage.getItem("rocket")?JSON.parse(t.localStorage.getItem("rocket")).autoRecommend:[];return p.forEach(function(t){if(!(l&&t.cityId&&t.cityId.length>0&&-1===t.cityId.indexOf(l)||c&&t.siteId&&t.siteId.length>0&&-1===t.siteId.indexOf(c)||d&&t.catalogId&&t.catalogId.length>0&&-1===t.catalogId.indexOf(d))){e.inAPP?(t.clickUrl=t.schemeUrl,e.appGt("3.2")||(t.clickUrl=t.clickUrl.replace("yhouse://webkit?","yhouse://web?"))):t.clickUrl=t.linkUrl;var n={contentType:88,ad:t};o.splice(parseInt(t.position)-1,0,n)}}),o}}]).filter("yAdsSkuDetail",["$rootScope","$window",function(e,t){return function(e,o,n){if("undefined"==typeof o||"undefined"==typeof n)return e;n=n.toUpperCase();for(var a=t.localStorage.getItem("rocket")?JSON.parse(t.localStorage.getItem("rocket")).skuDetail:[],r=0;r<a.length;r++)if(a[r].linkName===n&&a[r].linkId===o)return a[r].pvUrl;return e}}]).filter("ySearchType",["$rootScope",function(e){return function(e){var t=["","/event/","/meal/","/host/","","","/course/","/family/"];return t[e]}}]).filter("highlightTag",["$rootScope",function(e){return function(e){if(e){spanClass="highlight-tag";var t=new RegExp("#([^#]+)#","g");return replaceWith="<span "+(spanClass?'class="'+spanClass+'"':"")+'">#$1#</span>',e.replace(t,replaceWith)}}}]).filter("nFormatter",["$rootScope",function(e){return function(e,t){var o,n=[{value:1e18,symbol:"E"},{value:1e15,symbol:"P"},{value:1e12,symbol:"T"},{value:1e9,symbol:"G"},{value:1e6,symbol:"M"},{value:1e3,symbol:"k"}];for(o=0;o<n.length;o++)return e>=n[o].value?(e/n[o].value).toFixed(t).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+n[o].symbol:e;return e.toString()}}]).filter("trustUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),mainApp.controller("forgetPwdController",["$scope","$rootScope","$location","$window","$routeParams","loginService","utilService",function(e,t,o,n,a,r,i){e.mobile="",e.pass="",e.verifycode="",e.enableSubmit=!0,e.sendCode=function(){e.enableSubmit=!1;var n=i.checkMobile(e.mobile);return""!==n?(t.showDialog(n),void(e.enableSubmit=!0)):void r.findPassCode(e.mobile).success(function(n){return n.hasOwnProperty("code")&&"0"!=n.code?(t.showDialog(n.message),void(e.enableSubmit=!0)):(t.userId=n.userId,t.phoneNums=e.mobile,o.path("/reset-pwd"),void(e.enableSubmit=!0))}).error(function(o){o.hasOwnProperty("status")&&500===o.status&&(t.showDialog(o.message),e.enableSubmit=!0)})},e.reSendCode=function(){e.enableSubmit=!1,r.findPassCode(t.phoneNums).success(function(o){t.showDialog(o.message),e.enableSubmit=!0})},e.resetCode=function(){e.enableSubmit=!1,r.resetPassCode(t.userId,t.phoneNums,e.pass,e.verifycode).success(function(n){t.showDialog(n.message),o.path("/login"),e.enableSubmit=!0}).error(function(o){o.hasOwnProperty("status")&&500===o.status&&(t.showDialog(o.message),e.enableSubmit=!0)})}}]),mainApp.controller("guideController",["$window","$scope","$filter","$rootScope","$location","$cookies","$routeParams","utilService","infoService",function(e,t,o,n,a,r,i,s,l){
t.guide=null;var c=s.clearId(i.guideId);l.guide(c).success(function(o,i,l){if("0"===o.code&&o.data){if(n.appGt("3.2")){var d=encodeURIComponent(JSON.stringify({id:c,isInterested:o.data.isInterested?1:0,sPicUrl:o.data.iconUrl,description:o.data.viceTitle,title:o.data.title,shareUrl:o.data.shareUrl+("undefined"!=typeof r.get("UI")?"&share_ui="+r.get("UI"):"")}));e.location="yhouse://broker?scheme="+encodeURIComponent("guide/"+c)+"&use=share&data="+d}n.page.pageTitle=o.data.title,n.$emit("pageTitleChanged"),o.data.text=s.handleRecommendManual("guide",o,n.inAPP),o.data.text=s.handleImage(o.data.text,!1),t.guide=o.data}else a.path("/404")}).error(function(){a.path("/404")})}]),mainApp.controller("homeController",["$window","$location","$routeParams","$rootScope","$scope","$timeout","$q","eventService","mealService","commonService","utilService","infoService","specialService","SITE_CONFIG",function(e,t,o,n,a,r,i,s,l,c,d,p,u,m){n.page.pageTitle="YHOUSE悦会 - 精选轻奢美食、玩乐活动、生活学院课程预订","undefined"!=typeof n.homeTabs&&"undefined"!=typeof n.home&&(n.page.showFilterCategory="course"!==n.homeTabs[n.home.currentTabId].key,n.page.showFilterCategory="family"!==n.homeTabs[n.home.currentTabId].key);var h=function(e){if("undefined"==typeof e||null===e||""===e||0==e||isNaN(e))return 0;e=parseInt(e);for(var t=0;t<n.cityList.length;t++)if(e===n.cityList[t].id)return n.cityList[t].id;return 0},g=function(e){if("undefined"==typeof e||null===e||""===e||"unknown"===e)return 0;for(var t=0;t<n.cityList.length;t++)if(e==n.cityList[t].name)return n.cityList[t].id;return 0},f=function(e){if("undefined"==typeof e||null===e||""===e||0==e||isNaN(e))return"城市";for(var t=0;t<n.cityList.length;t++)if(e===n.cityList[t].id)return n.cityList[t].name;return"城市"},y=function(){var a=i.defer(),r=i.defer();c.getHomeNav().success(function(e,t,o){a.resolve(e)}),o.cityId?r.resolve(o.cityId):e.localStorage.getItem("cityId")?r.resolve(e.localStorage.getItem("cityId")):c.getCity().success(function(e,t,o){e.data&&e.data.city?r.resolve(e.data.city):r.resolve()}).error(function(){r.resolve()}),i.all([a.promise,r.promise]).then(function(o){for(var a=o[0],r=[],i=0;i<a.cityShow.length;i++)r[i]=a.city[a.cityShow[i]];n.cityList=r;var s=o[1],l=0;l=isNaN(s)&&"string"==typeof s?g(s):h(s),n.initCityId=l,"seal|onstar|m"===n.siteCode&&null==e.sessionStorage.getItem("visitTopic")&&u.topicList([0,l,2,1,1],function(o){if(o.doc&&o.doc[0]&&o.doc[0].id){t.path("/topic/"+o.doc[0].id);try{e.sessionStorage.setItem("visitTopic","visited")}catch(n){}}});for(var d=[],p=0;p<a.data[0].catalogs.length;p++)a.city[l].item1===a.data[0].catalogs[p].catalogId&&(d[0]=c.getHomeTabValue(0,a.data[0].catalogs[p].catalogName,a.data[0].catalogs[p].catalogId)),a.city[l].item2===a.data[0].catalogs[p].catalogId&&(d[1]=c.getHomeTabValue(1,a.data[0].catalogs[p].catalogName,a.data[0].catalogs[p].catalogId)),a.city[l].item3===a.data[0].catalogs[p].catalogId&&(d[2]=c.getHomeTabValue(2,a.data[0].catalogs[p].catalogName,a.data[0].catalogs[p].catalogId)),a.city[l].item4===a.data[0].catalogs[p].catalogId&&(d[3]=c.getHomeTabValue(3,a.data[0].catalogs[p].catalogName,a.data[0].catalogs[p].catalogId));d&&d.length>=1&&(n.homeTabs=d),n.$emit("initHomeTabsSucc")})};void 0!==typeof n.homeTabs&&n.homeTabs||y(),n.$on("initHomeTabsSucc",function(){if(n.home.currentTabId)n.switchTab(n.home.currentTabId);else if("meal-list"===n.pageName||"event-list"===n.pageName||"course-list"===n.pageName||"family-list"===n.pageName){if(n.homeTabs)for(var e=0;e<n.homeTabs.length;e++)if(n.pageName===n.homeTabs[e].key+"-list"){n.switchTab(n.homeTabs[e].id);break}}else n.switchTab(0)});var v=function(){r(function(){n.page.okSaveScroll&&!n.page.showFilterWindow&&n.page.showLogo&&(e.pageYOffset<35?n.page.showLogoOut=!0:e.pageYOffset+e.innerHeight>document.body.scrollHeight-35||(n.page.lastScrollPos&&e.pageYOffset<n.page.lastScrollPos?n.page.showLogoOut=!0:e.pageYOffset>n.page.lastScrollPos&&(n.page.showLogoOut=!1))),n.page.lastScrollPos=e.pageYOffset},300),n.page.okSaveScroll&&(n.home.currentTabId?n.home.tabs[n.home.currentTabId].scrollPos=e.pageYOffset:n.home.tabs[0].scrollPos=e.pageYOffset),n.home.listAutoLoad&&e.pageYOffset+e.innerHeight>document.body.scrollHeight-20&&n.loadPage()};a.$on("$routeChangeStart",function(){n.page.okSaveScroll=!1}),a.$on("$routeChangeSuccess",function(){angular.element(e).on("scroll touchmove",v),r(function(){e.scrollTo(0,n.home.tabs[n.home.currentTabId]&&n.home.tabs[n.home.currentTabId].scrollPos?n.home.tabs[n.home.currentTabId].scrollPos:0),n.page.okSaveScroll=!0},800)}),a.$on("$destroy",function(){angular.element(e).off("scroll touchmove",v)}),n.showFilter=function(e){e===n.home.filter.filterType?n.page.showFilterWindow=!n.page.showFilterWindow:e?("undefined"!=typeof _paq&&("city"===e&&_paq.push(["trackEvent","City","City Filter Click"]),"category"===e&&_paq.push(["trackEvent","Category","Category Filter Click"])),n.home.filter.filterType=e,n.page.showFilterWindow=!0):n.page.showFilterWindow=!1;var t=document.getElementById("cityList").getElementsByClassName("active").length;1!=t&&(n.page.showFilterWindow=!0)},n.filterCity=function(t){if(t=d.clearId(t),n.home.filter.cityId!==t){try{e.localStorage.setItem("cityId",t)}catch(o){}n.home.filter.cityId=t,n.home.filter.city=f(t);for(var a=0;a<n.home.tabs.length;a++)delete n.home.tabs[a].list}c.getHomeNav().success(function(e,o,a){if(e.hasOwnProperty("code")&&"0"===e.code){for(var r=[],i=0;i<e.data[0].catalogs.length;i++)e.city[t].item1===e.data[0].catalogs[i].catalogId&&(r[0]=c.getHomeTabValue(0,e.data[0].catalogs[i].catalogName,e.data[0].catalogs[i].catalogId)),e.city[t].item2===e.data[0].catalogs[i].catalogId&&(r[1]=c.getHomeTabValue(1,e.data[0].catalogs[i].catalogName,e.data[0].catalogs[i].catalogId)),e.city[t].item3===e.data[0].catalogs[i].catalogId&&(r[2]=c.getHomeTabValue(2,e.data[0].catalogs[i].catalogName,e.data[0].catalogs[i].catalogId)),e.city[t].item4===e.data[0].catalogs[i].catalogId&&(r[3]=c.getHomeTabValue(3,e.data[0].catalogs[i].catalogName,e.data[0].catalogs[i].catalogId));if(r&&r.length>=1){var s=n.homeTabs[n.home.currentTabId].key;n.home.currentTabId=0;for(var l=0;l<r.length;l++)if(s===r[l].key){n.home.currentTabId=r[l].id;break}n.homeTabs=r,0===n.home.currentTabId&&(n.page.showFilterCategory=0===n.home.currentTabId&&("event"===n.homeTabs[0].key||"meal"===n.homeTabs[0].key),n.home.filter.listType=n.homeTabs[0].key)}}n.reloadPage(),n.getAd()});var r=d.capitalizeString(n.home.filter.listType);"undefined"!=typeof _paq&&_paq.push(["trackEvent",r,r+" City Selected",t])},n.filterCategory=function(e){"meal"===n.home.filter.listType?n.home.filter.mealCategoryId=e:n.home.filter.eventCategoryId=e,n.reloadPage();var t=d.capitalizeString(n.home.filter.listType);"undefined"!=typeof _paq&&_paq.push(["trackEvent",t,t+" Category Selected",e])},n.closeFilterWindow=function(){n.page.showFilterWindow=!1},n.loadPage=function(){var e=n.home.currentTabId;n.home.tabs[e].isEnd||n.home.tabs[e].isBusy||(n.home.tabs[e].isBusy=!0,"event"===n.homeTabs[e].key?s.eventList(n.home.filter.cityId,n.home.filter.eventCategoryId,n.home.tabs[e].page,n.home.tabs[e].pid,0).success(function(t,o,a){1===t.data.isEnd&&(n.home.tabs[e].isEnd=!0);var r=t.data.doc;n.home.tabs[e].list?n.home.tabs[e].list=n.home.tabs[e].list.concat(r):n.home.tabs[e].list=r,n.home.tabs[e].page++,n.home.tabs[e].isBusy=!1,n.home.tabs[e].pid=t.data.pid}):"meal"===n.homeTabs[e].key?l.mealList(n.home.filter.cityId,n.home.filter.mealCategoryId,n.home.tabs[e].page,n.home.tabs[e].pid).success(function(t,o,a){1===t.data.isEnd&&(n.home.tabs[e].isEnd=!0);var r=t.data.doc;n.home.tabs[e].list?n.home.tabs[e].list=n.home.tabs[e].list.concat(r):n.home.tabs[e].list=r,n.home.tabs[e].page++,n.home.tabs[e].isBusy=!1,n.home.tabs[e].pid=t.data.pid}):"course"===n.homeTabs[e].key?s.eventList(n.home.filter.cityId,0,n.home.tabs[e].page,n.home.tabs[e].pid,1).success(function(t,o,a){1===t.data.isEnd&&(n.home.tabs[e].isEnd=!0);var r=t.data.doc;n.home.tabs[e].list?n.home.tabs[e].list=n.home.tabs[e].list.concat(r):n.home.tabs[e].list=r,n.home.tabs[e].page++,n.home.tabs[e].isBusy=!1,n.home.tabs[e].pid=t.data.pid}):"family"===n.homeTabs[e].key&&s.eventList(n.home.filter.cityId,0,n.home.tabs[e].page,n.home.tabs[e].pid,2).success(function(t,o,a){1===t.data.isEnd&&(n.home.tabs[e].isEnd=!0);var r=t.data.doc;n.home.tabs[e].list?n.home.tabs[e].list=n.home.tabs[e].list.concat(r):n.home.tabs[e].list=r,n.home.tabs[e].page++,n.home.tabs[e].isBusy=!1,n.home.tabs[e].pid=t.data.pid}),n.reloadPv(n.home.tabs[e].catalogId))},n.reloadPage=function(){e.scrollTo(0,0);var t=n.home.currentTabId;n.home.tabs[t].isEnd=!1,n.home.tabs[t].page=1,n.home.tabs[t].fromPageSize=0,n.home.tabs[t].scrollPos=0,n.home.tabs[t].list=[],n.loadPage(),n.page.showFilterWindow=!1},n.getAd=function(){function e(e){u.ads(["100,101",n.home.filter.cityId,e],function(e){var o={bundle:[],reserveList:[]};e.bundle&&e.bundle.forEach(function(e){o.bundle[e.position]=e}),e.reserveList&&e.reserveList.forEach(function(e){o.reserveList[e.position]=e}),n.home.tabs[t].carouselSlides=o})}if(!d.isEmptyNumber(n.home.filter.cityId)){var t=n.home.currentTabId;n.home.tabs[t].carouselSlides=[],("event"===n.homeTabs[t].key||"meal"===n.homeTabs[t].key||"course"===n.homeTabs[t].key||"family"===n.homeTabs[t].key)&&e(n.homeTabs[t].key)}};var b=function(){n.home.filter.cityId?n.$emit("getCity",n.home.filter.cityId):o.cityId?n.$emit("getCity",o.cityId):n.initCityId?n.$emit("getCity",n.initCityId):e.localStorage.getItem("cityId")?n.$emit("getCity",h(e.localStorage.getItem("cityId"))):c.getCity().success(function(e){n.$emit("getCity",g(e.data.city))}).error(function(){n.$emit("getCity",0)})};if(n.$on("getCity",function(e,t){d.isEmptyNumber(t)?n.showFilter("city"):n.filterCity(t)}),n.switchTab=function(t){t!==n.home.currentTabId&&(t=t>=n.homeTabs.length?0:t,t=0>t?n.homeTabs.length-1:t,n.page.showFilterCategory="course"!==n.homeTabs[t].key&&"family"!==n.homeTabs[t].key,n.home.filter.listType=n.homeTabs[t].key,n.page.okSaveScroll=!1,n.home.currentTabId=t,"undefined"==typeof n.home.tabs[n.home.currentTabId].list&&b(),e.scrollTo(0,n.home.tabs[n.home.currentTabId].scrollPos?n.home.tabs[n.home.currentTabId].scrollPos:0),r(function(){n.page.okSaveScroll=!0},500))},!n.home){n.home={currentTabId:null,scrollPos:0,city:"",tabs:new Array(4)};for(var I=0;I<n.home.tabs.length;I++)n.home.tabs[I]={scrollPos:0,isBusy:!1,isEnd:!1,fromPageSize:0,page:1,invalidPage:0,subPage:0,carouselSlides:null,pid:null};n.home.filter={cityId:null,filterType:"city",listType:"event",eventCategoryId:0,mealCategoryId:0},n.home.eventListType=m.EVENT_LIST_TYPE,n.home.listAutoLoad=m.LIST_AUTO_LOAD,n.eventCategoryList=[{id:0,name:"全部活动"}],n.mealCategoryList=[{id:0,name:"全部美食"}],c.categoryList().success(function(e,t,o){e.data&&(n.eventCategoryList=n.eventCategoryList.concat(e.data.eventCategory),n.mealCategoryList=n.mealCategoryList.concat(e.data.mealCategory))})}o.categoryId&&(n.home.filter.eventCategoryId=d.clearId(o.categoryId)),n.goSearch=function(){0===n.home.currentTabId?t.search("type",2).path("/search"):1===n.home.currentTabId?t.search("type",1).path("/search"):2===n.home.currentTabId?t.search("type",6).path("/search"):3===n.home.currentTabId&&t.search("type",7).path("/search")},n.goFilter=function(){0===n.home.currentTabId?t.search({bizType:1,catalog:2}).path("/search"):1===n.home.currentTabId?t.search({bizType:1,catalog:1}).path("/search"):2===n.home.currentTabId?t.search({bizType:1,catalog:6}).path("/search"):3===n.home.currentTabId&&t.search({bizType:1,catalog:7}).path("/search")}}]),mainApp.controller("hostController",["$scope","$rootScope","$location","$window","$cookies","$routeParams","utilService","infoService",function(e,t,o,n,a,r,i,s){e.hostInfo=null,e.coordType=null,e.pos=null,e.mapUrl=null,e.skuUrl=null,t.inAPP?e.skuUrl="yhouse://":e.skuUrl="/",e.hostId=i.clearId(r.hostId);var l=o.search();void 0!=l.coordType&&void 0!=l.pos&&(e.coordType=l.coordType,e.pos=l.pos),s.host(e.hostId,e.coordType,e.pos).success(function(r,i,s){if("0"===r.code&&r.data){if(t.appGt("3.2")){var l=JSON.parse(JSON.stringify(r.data));delete l.highlight,delete l.highs,delete l.productLabels,delete l.tags,l.shareUrl+="undefined"!=typeof a.get("UI")?"&share_ui="+a.get("UI"):"",n.location="yhouse://broker?scheme="+encodeURIComponent("host/"+e.hostId)+"&use=data&data="+encodeURIComponent(JSON.stringify(l))}e.hostInfo=r.data,e.mapUrl="yhouse://map?coordType="+encodeURIComponent(e.hostInfo.coordType)+"&pos="+encodeURIComponent(e.hostInfo.hostPos)+"&title="+encodeURIComponent(e.hostInfo.hostName)+"&address="+encodeURIComponent(e.hostInfo.address);try{n.localStorage.setItem("hostInfo",JSON.stringify(r))}catch(c){}if(e.hostInfo.headPics&&e.hostInfo.headPics.length>0){for(var d=[],p=0;p<e.hostInfo.headPics.length;p++)d[p]={imgSrc:e.hostInfo.headPics[p]};e.hostInfo.headPics=d}t.headTitle=e.hostInfo.title,t.page.pageTitle=e.hostInfo.title,t.inWX&&commonService.initWxConfig(o.absUrl(),r.data.title,"YHOUSE精选美食与玩乐，款待最重要的人。",o.absUrl(),r.data.sharePicUrl),t.$emit("pageTitleChanged")}else o.path("/404")}).error(function(){o.path("/404")}),e.openFacility=function(a){if("undefined"!=typeof _paq&&_paq.push(["trackEvent","Host","More "+a,e.hostId]),t.inAPP){var r=o.protocol()+"://"+o.host();"facility"===a?n.location="yhouse://sku-pop?title="+encodeURIComponent("餐厅设施")+"&icon="+encodeURIComponent("http://r.yhres.com/sku/facilities@3x.png")+"&url="+encodeURIComponent(r+"/sku-pop-app/host/facility/"+e.hostId):"highlight"===a&&(n.location="yhouse://sku-pop?title="+encodeURIComponent("推荐理由")+"&icon="+encodeURIComponent("http://r.yhres.com/sku/special@3x.png")+"&url="+encodeURIComponent(r+"/sku-pop-app/host/highlight/"+e.hostId))}else o.path("/sku-pop/host/"+a+"/"+e.hostId)},e.openAddressTip=function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","Host","Map",e.hostId]),t.showDialog("当前版本过低，请更新至最新版后使用。")},e.publishArticle=function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","Host","Join Share Tag",e.hostId]),t.inAPP?n.location="yhouse://publish?tagKey="+encodeURIComponent(e.hostInfo.shareTagSimpleVO.title):n.location="/share-tag?id="+e.hostInfo.shareTagSimpleVO.id}}]),mainApp.controller("hostOrderRuleController",["$scope","$rootScope","$location",function(e,t,o){e.discountDesc="",e.agreementDuration="";var n=o.search();void 0!=n.discountDesc&&void 0!=n.agreementDuration&&(e.discountDesc=n.discountDesc,e.agreementDuration=n.agreementDuration),t.inAPP&&(document.body.style.backgroundColor="transparent")}]),mainApp.controller("hostPayResultController",["$scope","$rootScope","$location","$routeParams","orderService",function(e,t,o,n,a){e.hostPayInfo=null,a.payResult(n.outTradeNo).success(function(n,a,r){"0"===n.code?e.hostPayInfo=n.data:t.inAPP?e.data=n:(t.showDialog(n.message),o.path("/my-order-list"))})}]),mainApp.controller("invitationAppController",["$rootScope","$scope","$window","$location","$routeParams","commonService","utilService",function(e,t,o,n,a,r,i){if(t.invitation=null,t.imgSrc=null,t.tplStyle=!1,t.shareUrl=null,t.iconUrl=null,t.inviterName="",t.inviterDate="",t.invitationType=a.detailType,t.invitationTitle=null,t.subscribeDate=n.search().subscribeDate,t.allStyles=null,t.styleId=a.styleId,e.appGt("3.2")){var s=document.createElement("script"),l=document.getElementsByTagName("script")[0];s.type="text/javascript",s.text='function changeView(styleId){var element = angular.element(document.getElementById("mainApp"));var scope = element.scope();scope.$apply(scope.changeTpl(styleId));};',l.parentNode.insertBefore(s,l)}r.invitationStyle().success(function(e,o,n){e&&"0"==e.code&&(t.allStyles=e.data.styles,t.changeTpl(a.styleId))}),t.changeTpl=function(e){if(t.allStyles)for(var o=0;o<t.allStyles.length;o++)e==t.allStyles[o].id&&(t.imgSrc=t.allStyles[o].bgUrl,t.iconUrl=t.allStyles[o].iconUrl,t.tplStyle="black"===t.allStyles[o].h5Class,t.styleId=e)},r.invitationHost(a.detailType,a.orderId,a.styleId,t.subscribeDate).success(function(o,n,s){function l(){return i.isEmptyString(t.inviterName)?t.shareUrl={wx:"",qq:"",bc:"yhouse://invitation-share-save"}:e.appGt("3.2")?t.shareUrl={wx:"yhouse://invitation-share-weixin?url="+encodeURIComponent(t.invitation.shareUrl)+"&name="+encodeURIComponent(t.inviterName)+"&title="+encodeURIComponent(t.invitation.title)+"&icon="+encodeURIComponent(t.iconUrl),qq:"yhouse://invitation-share-qq?url="+encodeURIComponent(t.invitation.shareUrl)+"&name="+encodeURIComponent(t.inviterName)+"&title="+encodeURIComponent(t.invitationTitle)+"&address="+encodeURIComponent(t.invitation.address)+"&time="+encodeURIComponent(t.inviterDate)+"&icon="+encodeURIComponent(t.iconUrl),bc:"yhouse://invitation-share-save"}:t.shareUrl={wx:"yhouse://invitation-share-weixin?url="+encodeURIComponent(t.invitation.shareUrl)+"&name="+encodeURIComponent(t.inviterName)+"&title="+encodeURIComponent(t.invitation.title)+"&icon="+encodeURIComponent(t.iconUrl),qq:"yhouse://invitation-share-qq?url="+encodeURIComponent(t.invitation.shareUrl)+"&name="+encodeURIComponent(t.inviterName)+"&title="+encodeURIComponent(t.invitationTitle)+"&address="+encodeURIComponent(t.invitation.address)+"&time="+encodeURIComponent(t.invitation.dateTime)+"&icon="+encodeURIComponent(t.iconUrl),bc:"yhouse://invitation-share-save"},t.shareUrl}o&&"0"==o.code&&(t.invitation=o.data,2==a.detailType?t.invitationTitle=t.invitation.hostName+","+t.invitation.title+":"+t.invitation.hostName:t.invitationTitle=t.invitation.title,t.inviterName=t.invitation.userName,e.appGt("3.2")&&("待定"===t.invitation.dateTime?t.inviterDate="星期六 晚7点":t.inviterDate=t.invitation.dateTime),t.updateName=function(e){l();for(var o=0,n=0,a=0;o<e.length;o++)if(n+=e.charCodeAt(o)>=0&&e.charCodeAt(o)<=255?1:2,a++,n>=16){document.getElementById("inputName").maxLength=a,t.inviterName=t.inviterName.substring(0,a);break}},t.updateDate=function(e){l()},t.$watch("styleId",function(e,t){l()}),document.getElementsByClassName("icon_share_wx")[0].addEventListener("touchend",function(e){i.isEmptyString(t.inviterName)&&(e.preventDefault(),document.getElementById("inputName").focus()),t.changeName()}),document.getElementsByClassName("icon_share_bc")[0].addEventListener("touchend",function(){t.changeName()}),e.appGt("2.7")&&document.getElementsByClassName("icon_share_qq").length>0&&document.getElementsByClassName("icon_share_qq")[0].addEventListener("touchend",function(e){i.isEmptyString(t.inviterName)&&(e.preventDefault(),document.getElementById("inputName").focus()),t.changeName()},!0),t.changeName=function(){e.appGt("3.2")?(""==t.inviterDate&&(t.inviterDate="待定"),r.invitationChange(t.invitation.code,t.inviterName,t.inviterDate,t.styleId).success(function(e,t,o){})):r.invitationChangeName(t.invitation.code,t.inviterName).success(function(e,t,o){})})})}]),mainApp.controller("invitationController",["$rootScope","$scope","$location","$routeParams","commonService","utilService",function(e,t,o,n,a,r){t.invitationCode=null,t.inviterName=null,t.invitationId=null,t.imgSrc=null,t.tplStyle=!1,e.page.pageTitle="邀请函",n.invitationCode?(t.invitationCode=decodeURIComponent(n.invitationCode),a.invitationNew(t.invitationCode).success(function(n,i,s){"0"!==n.code?e.showDialog(n.message):(t.invitation=n.data,t.inviterName=t.invitation.nickName,r.isEmptyNumber(t.invitation.styleId)&&(t.invitation.styleId=1),e.page.pageTitle="来自"+t.inviterName+"的邀请函",a.invitationStyle().success(function(n,r,i){if(n&&"0"==n.code){for(var s=n.data.styles,l=0;l<s.length;l++)if(t.invitation.styleId==s[l].id){t.imgSrc=s[l].bgUrl,t.iconUrl=s[l].iconUrl,t.tplStyle="black"==s[l].h5Class;break}e.inWX&&a.initWxConfig(o.absUrl(),e.page.pageTitle,"YHOUSE精选美食与玩乐，款待最重要的人。",o.absUrl(),t.iconUrl)}}))})):n.invitationId&&(t.inviterName=decodeURIComponent(n.inviterName),e.page.pageTitle="来自"+t.inviterName+"的邀请函",a.invitation(t.invitationId).success(function(o,n,a){"0"!==o.code?e.showDialog(o.message):t.invitation=o.data})),t.openUrl=function(e){if("undefined"!=typeof t.invitation){var o="/";return 1===e?o+="event/":2===e&&(o+="meal/"),o+=t.invitation.id+"?hide_buy=1"}}}]),mainApp.controller("loadVipCodeController",["$rootScope","$scope","$cookies","$location","commonService","utilService",function(e,t,o,n,a,r){t.vipCode="邀请有礼",t.sharecount="50",t.showInvitationTheme=r.checkInApp()?!0:!1,e.appGt("2.5")?window.location="yhouse://my-vip-code":e.appGt("2.4")?r.checkInIOS()?window.location="yhouse://my-qr-code":window.location="yhouse://my-vip-code":"undefined"!=typeof o.get("UA")&&a.queryPromocode().success(function(e,o,n){e&&"0"===e.code&&(t.vipCode=e.data.promocode,t.sharecount=e.data.sharecount?e.data.sharecount:30)})}]),mainApp.controller("loginWxController",["$scope","$rootScope","$location","$window","$routeParams","$cookies","loginService",function(e,t,o,n,a,r,i){var s="/";o.search().redirect&&(s=o.search().redirect),e.error="正在为您进行微信登录...",i.wxLogin(a.code).success(function(t,a,r){if(null===t||"0"!==t.code)return void(e.error="微信登录失败，请稍后重试。");if("0"===t.code){e.error="微信登录成功...";try{n.sessionStorage.setItem("currentUser",JSON.stringify(t.data))}catch(i){}o.path(s)}})}]).controller("loginController",["$scope","$rootScope","$location","$window","$routeParams","loginService",function(e,t,o,n,a,r){e.username="",e.password="",e.enableSubmit=!0,e.login=function(){e.enableSubmit=!1,r.login(e.username,e.password).success(function(a){if(a.id){try{n.sessionStorage.setItem("currentUser",JSON.stringify(a))}catch(r){}o.path(t.loginNextPath)}else e.enableSubmit=!0}).error(function(o){o.hasOwnProperty("status")&&500===o.status&&(t.showDialog(o.message),e.enableSubmit=!0)})}}]).controller("logoutController",["$scope","$rootScope","$location","$window","$cookies",function(e,t,o,n,a){"undefined"!=typeof a.get("UA")&&a.remove("UA",{domain:".yhouse.com"}),"undefined"!=typeof t.currentUser&&(n.sessionStorage.removeItem("currentUser"),delete t.currentUser),"undefined"!=typeof t.eventOrderInfo&&(n.sessionStorage.removeItem("eventOrderInfo"),delete t.eventOrderInfo),"undefined"!=typeof t.mealOrderInfo&&(n.sessionStorage.removeItem("mealOrderInfo"),delete t.mealOrderInfo),"undefined"!=typeof t.userOrderInfo&&(n.sessionStorage.removeItem("userOrderInfo"),delete t.userOrderInfo),window.easemobim=window.easemobim||{},easemobim.clear(),o.path("/")}]),mainApp.controller("mealController",["$scope","$rootScope","$location","$window","$cookies","$timeout","$interval","$routeParams","utilService","mealService","commonService","$sce",function(e,t,o,n,a,r,i,s,l,c,d,p){e.data=null,e.meal=null,e.hideBuy=!0,o.search()&&"1"===o.search().hide_buy&&(e.hideBuy=!1);var u=l.clearId(s.mealId);c.meal(u).success(function(r,i,s){if("0"===r.code){if(t.appGt("3.2")){var l=JSON.parse(JSON.stringify(r.data));delete l.guideline,delete l.highlight,delete l.menu,delete l.productLabels,delete l.productAdvice,delete l.highs,delete l.refundDesc,delete l.tags,l.shareUrl+="undefined"!=typeof a.get("UI")?"&share_ui="+a.get("UI"):"",n.location="yhouse://broker?scheme="+encodeURIComponent("meal/"+u)+"&use=data&data="+encodeURIComponent(JSON.stringify(l))}e.data=r,e.data.data.menu=r.data.menu,e.meal=r.data,img_url=null==e.data.data.mPicUrl?e.data.data.picUrl:e.data.data.mPicUrl,t.inAPP?e.imUrl="yhouse://web?title="+encodeURIComponent("在线客服")+"&url="+encodeURIComponent(document.location.protocol+"//"+document.location.host+"/cs-im-app?imgurl="+encodeURIComponent(img_url)+"&type=meal&id="+e.data.data.id+"&itemtitle="+encodeURIComponent(e.data.data.title)+"&address="+encodeURIComponent(e.data.data.address)+"&price="+encodeURIComponent(e.data.data.priceStr))+"&isBack=1&hideShortcut=1":e.imUrl="/cs-im?from=&imgurl="+encodeURIComponent(img_url)+"&img_url="+encodeURIComponent(img_url)+"&type=meal&id="+e.data.data.id+"&itemtitle="+encodeURIComponent(e.data.data.title)+"&address="+encodeURIComponent(e.data.data.address)+"&price="+encodeURIComponent(e.data.data.price)+"&hideShortcut=1",e.data.type="meal",t.inAPP?e.hostUrl="yhouse://host/"+e.meal.hostId:e.hostUrl="/host/"+e.meal.hostId;try{n.localStorage.setItem("mealInfo",JSON.stringify(r))}catch(c){}if(e.meal.headPics&&e.meal.headPics.length>0){for(var p=[],m=0;m<e.meal.headPics.length;m++)p[m]={imgSrc:e.meal.headPics[m]};e.meal.headPics=p}t.page.pageTitle=e.meal.title,t.$emit("pageTitleChanged"),e.mealTags=r.data.tags.join(" &middot; "),t.inWX&&(null!=t.currentUser&&"undefined"!=typeof t.currentUser&&t.currentUser.promocode?d.initWxConfig(o.absUrl(),r.data.title,"YHOUSE精选美食与玩乐。使用我的邀请码"+t.currentUser.promoAlias+"，获得50元首单优惠！",o.absUrl(),r.data.sPicUrl):d.initWxConfig(o.absUrl(),r.data.title,"YHOUSE精选美食与玩乐，款待最重要的人。",o.absUrl(),r.data.sPicUrl))}else t.inAPP?e.data=r:o.path("/404")}).error(function(){o.path("/404")}),e.openFacility=function(e){if("undefined"!=typeof _paq&&_paq.push(["trackEvent","Meal","More "+e,u]),t.inAPP){var a=o.protocol()+"://"+o.host();"highlight"===e?n.location="yhouse://sku-pop?title="+encodeURIComponent("推荐理由")+"&icon="+encodeURIComponent("http://r.yhres.com/sku/special@3x.png")+"&url="+encodeURIComponent(a+"/sku-pop-app/meal/highlight/"+u):"menu"===e?n.location="yhouse://sku-pop?title="+encodeURIComponent("菜单")+"&icon="+encodeURIComponent("http://r.yhres.com/sku/menu@3x.png")+"&url="+encodeURIComponent(a+"/sku-pop-app/meal/menu/"+u):"facility"===e&&(n.location="yhouse://sku-pop?title="+encodeURIComponent("餐厅设施")+"&icon="+encodeURIComponent("http://r.yhres.com/sku/facilities@3x.png")+"&url="+encodeURIComponent(a+"/sku-pop-app/meal/facility/"+u))}else o.path("/sku-pop/meal/"+e+"/"+u)},e.orderMeal=function(e){"undefined"!=typeof _paq&&_paq.push(["trackEvent","Meal","Meal Order",e]),o.path("/meal-order/"+e)},e.publishArticle=function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","Meal","Join Share Tag",u]),t.inAPP?n.location="yhouse://publish?tagKey="+encodeURIComponent(e.meal.shareTagSimpleVO.title):n.location="/share-tag?id="+e.meal.shareTagSimpleVO.id}}]),mainApp.controller("mealOrderController",["$parse","$scope","$rootScope","$location","$routeParams","$window","$timeout","mealService",function(e,t,o,n,a,r,i,s){t.mealOrder=null,t.mealId=a.mealId,s.meal(a.mealId).success(function(e,l,c){if(e.data.id)if(1==e.data.flag){o.page.pageTitle=e.data.title,t.mealOrder=e.data;var d=t.mealOrder.personsMin,p=t.mealOrder.personsMax;t.mealNumber=""+d,t.mealNumber+=d==p?"":"-"+p,t.mealNumber+="人 套餐",t.mealOrder.date="",t.mealOrder.calendar="",t.mealOrder.time="",t.mealOrder.orderTime="暂不选择",1===t.mealOrder.needReserveTime&&(t.mealOrder.orderTime="选择时间"),t.reserve={leaveMessage:!1,message:null,showPickTime:!1,dates:[],timeArray:[],date:"",calendar:"",currentStock:"",time:"",pickDatetime:function(){t.reserve.showPickTime=!t.reserve.showPickTime},closeMask:function(){t.reserve.showPickTime=!1},chooseDate:function(e){t.reserve.date=e.date,t.reserve.timeArray=e.time,t.reserve.calendar=e.calendar,t.reserve.currentStock=e.currentStock,t.reserve.chooseTime(t.reserve.timeArray[0])},chooseTime:function(e){t.reserve.time=e},dateTimeConfirm:function(){t.reserve.showPickTime=!1,t.mealOrder.date=t.reserve.date,t.mealOrder.calendar=t.reserve.calendar,t.mealOrder.time=t.reserve.time,t.mealOrder.orderTime=t.reserve.date+" "+t.reserve.time,t.canOrderNum=t.reserve.currentStock,t.reserve.leaveMessage=!0}},s.reserve(a.mealId).success(function(e,o,n){e&&"0"===e.code&&(t.reserve.dates=e.data.doc,t.reserve.dates&&t.reserve.dates.length>0&&t.reserve.chooseDate(t.reserve.dates[0]))}).error(function(){t.reserve.dates=[]}),t.canOrderNum=1,null!==e.data.maxNum&&"undefined"!=typeof e.data.maxNum&&""!==e.data.maxNum&&(t.canOrderNum=e.data.maxNum),t.mealOrder.orderNum=1,t.$watch("mealOrder.orderNum",function(e,o){t.totalPrice=t.mealOrder.price*t.mealOrder.orderNum}),t.mealOrder.userName="",t.mealOrder.phoneNum="",t.mealOrder.bindPhone="",t.mealOrder.editPhone=!0,o.userOrderInfo?(t.mealOrder.userName=o.userOrderInfo.userName,t.mealOrder.bindPhone=o.userOrderInfo.phoneNum,t.mealOrder.editPhone=!1):o.currentUser&&(t.mealOrder.userName=o.currentUser.name,null!==o.currentUser.bindPhone&&"undefined"!=typeof o.currentUser.bindPhone&&""!==o.currentUser.bindPhone&&(t.mealOrder.bindPhone=o.currentUser.bindPhone,t.mealOrder.editPhone=!1)),t.editPhone=function(){t.mealOrder.editPhone=!0,t.$watch("mealOrder.phoneNum",function(){t.mealOrder.phoneNum==t.mealOrder.bindPhone&&(t.mealOrder.phoneNum="",t.mealOrder.editPhone=!1)})},t.updateMsg=function(e){if(e)for(var o=0,n=0,a=0;o<e.length;o++)if(n+=e.charCodeAt(o)>=0&&e.charCodeAt(o)<=255?1:2,a++,n>=40){document.getElementById("inputMsg").maxLength=a,t.reserve.message=t.reserve.message.substring(0,a);break}},t.enableSubmit=!0,t.submitOrder=function(){if(t.enableSubmit){if(t.enableSubmit=!1,1===t.mealOrder.needReserveTime&&(""===t.mealOrder.calendar||""===t.mealOrder.time))return o.showDialog("请选择就餐时间"),i(function(){t.enableSubmit=!0},0),!1;if(""===t.mealOrder.userName)return o.showDialog("请输入称呼"),i(function(){t.enableSubmit=!0},0),!1;var e=t.mealOrder.bindPhone;if(t.mealOrder.editPhone){if(""===t.mealOrder.phoneNum)return o.showDialog("请输入手机号获取和输入验证码再提交"),i(function(){t.enableSubmit=!0},0),!1;if(""===t.mealOrder.codeNum||"undefined"==typeof t.mealOrder.codeNum)return o.showDialog("请获取和输入验证码再提交"),i(function(){t.enableSubmit=!0},0),!1;e=t.mealOrder.phoneNum}"undefined"!=typeof _paq&&_paq.push(["trackEvent","Meal","Meal Pay",a.mealId]),s.submitOrder(a.mealId,t.mealOrder.calendar,t.mealOrder.time,t.mealOrder.orderNum,t.mealOrder.userName,e,t.mealOrder.codeNum,t.reserve.message).success(function(a){if("0"!==a.code)return o.showDialog(a.message),i(function(){t.enableSubmit=!0},0),!1;o.mealOrderInfo=a;try{r.sessionStorage.setItem("mealOrderInfo",JSON.stringify(a))}catch(s){}o.userOrderInfo={userName:t.mealOrder.userName,phoneNum:e};try{r.sessionStorage.setItem("userOrderInfo",JSON.stringify(o.userOrderInfo))}catch(s){}if(null!==a.data.clientUser&&"undefined"!=typeof a.data.clientUser)try{r.sessionStorage.setItem("currentUser",JSON.stringify(a.data.clientUser))}catch(s){}n.path("/meal-pay"),t.enableSubmit=!0})}}}else n.path("/meal/"+e.data.id).replace();else n.path("/404")})}]),mainApp.controller("mealPartyController",["$window","$rootScope","$scope","$routeParams","$location","partyService","commonService","loginService",function(e,t,o,n,a,r,i,s){o.page={showMask:!1,showDiscount:!1,discount:0,showShare:!1,showJoin:!1,enableSubmit:!0,showWxShare:!1,showOldPhone:!0},o.party={},o.curUser={},o.hideAll=function(){o.page.showMask=!1,o.page.showDiscount=!1,o.page.showJoin=!1,o.page.showWxShare=!1,o.page.showShare&&(o.page.showShare=!1,a.search({start:!1}),o.partyInfo())},o.showDiscount=function(){o.page.discount>0&&(o.page.showMask=!0,o.page.showDiscount=!0)},o.closeDiscount=function(){o.page.showMask=!1,o.page.showDiscount=!1},o.mealInfo=function(){t.inWX?a.path("/meal/"+o.party.subscribe.id):e.location="yhouse://meal/"+o.party.subscribe.id},o.openShare=function(){t.inWX?(e.scrollTo(0,0),o.page.showMask=!0,o.page.showWxShare=!0):(o.page.showMask=!0,o.page.showShare=!0)},o.closeShare=function(){o.page.showMask=!1,o.page.showShare=!1,a.search({start:!1}),o.partyInfo()},o.shareWx=function(){e.location="yhouse://meal-party-share-weixin?url="+encodeURIComponent(o.party.shareUrl)+"&num="+(o.party.participantsTotal-o.party.participants.length)+"&title="+o.party.subscribe.title+"&icon="+encodeURIComponent(o.party.subscribe.picUrl)},o.sharePyq=function(){e.location="yhouse://meal-party-share-pengyouquan?url="+encodeURIComponent(o.party.shareUrl)+"&icon="+encodeURIComponent(o.party.subscribe.picUrl)},o.mePay=function(){a.path("/meal-party-order/"+n.partyId)},o.partyPay=function(){if(t.inWX){"undefined"!=typeof _paq&&(o.party.isFull?_paq.push(["trackEvent","Party Pay",n.partyId]):_paq.push(["trackEvent","Party Prepay",n.partyId])),t.mealOrderInfo={data:o.party.subscribe,partyDiscount:o.party.discountTotal};try{e.sessionStorage.setItem("mealOrderInfo",JSON.stringify(t.mealOrderInfo))}catch(r){}a.path("/meal-pay")}else e.location="yhouse://pay/2/"+o.party.subscribe.subscribeId},o.invite=function(){t.inAPP?e.location="yhouse://go-invitation/2/"+o.party.subscribe.subscribeId:e.location="yhouse://list/meal";
},o.seeCard=function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","Party View Invitation",n.partyId]),e.location=o.party.invitationShareUrl},o.goHomepage=function(){t.inWX?a.path("/"):e.location="yhouse://list/meal"},o.openJoin=function(){o.page.showMask=!0,o.page.showJoin=!0,o.page.enableSubmit=!0;var n=function(e){null!==e&&"undefined"!=typeof e&&(o.curUser.name=e.name,null!==e.mobilephone&&"undefined"!=typeof e.mobilephone?(o.curUser.mobile=e.mobilephone+"",o.page.showOldPhone=!0):o.page.showOldPhone=!1)};if(!o.curUser.name){var a=JSON.parse(e.sessionStorage.getItem("currentUser"));n(a),t.inAPP&&s.getUserInfo().success(function(t,o,a){if(t.hasOwnProperty("code")&&"0"===t.code){n(t.data);try{e.sessionStorage.setItem("currentUser",JSON.stringify(t.data))}catch(r){}}})}},o.cancelJoin=function(){o.page.showMask=!1,o.page.showJoin=!1},o.applyJoin=function(){for(var e=0;e<document.getElementsByTagName("input").length;e++)document.getElementsByTagName("input")[e].blur();"undefined"!=typeof _paq&&_paq.push(["trackEvent","Party Join",n.partyId]),o.page.enableSubmit=!1,r.joinParty(n.partyId,o.curUser.name,o.curUser.mobile,o.curUser.smsCode).success(function(e,n,a){if(e.hasOwnProperty("code")&&"0"===e.code){o.party=e.data,o.headerAndFooter=l(o.party.isExpired,o.party.isFull,4===o.party.subscribe.status?1:0,o.party.isHost,o.party.isParticipant);for(var r=0;r<o.party.participants.length;r++)1===o.party.participants[r].isMe&&(o.page.discount=o.party.participants[r].discount);o.cancelJoin(),o.showDiscount()}else o.cancelJoin(),o.partyInfo(),t.showDialog(e.message)}).error(function(e,t,n){o.cancelJoin()})},o.editPhone=function(){o.page.showOldPhone=!1;var e=o.curUser.mobile;o.curUser.mobile="",o.$watch("curUser.mobile",function(){o.curUser.mobile==e&&(o.page.showOldPhone=!0)})},o.partyInfo=function(){r.getPartyInfo(n.partyId).success(function(e,n,r){e.hasOwnProperty("code")&&"0"===e.code&&(o.party=e.data,o.page.discount=o.party.discountStarter,t.page.pageTitle="饭局开组啦！"+o.party.subscribe.title,o.headerAndFooter=l(o.party.isExpired,o.party.isFull,4===o.party.subscribe.status?1:0,o.party.isHost,o.party.isParticipant),(53===o.party.subscribe.status||54===o.party.subscribe.status)&&(o.headerAndFooter=["expired","expired"]),a.search().start&&o.showDiscount(),t.inWX&&i.wxShareAppMessage(t.page.pageTitle,"YHOUSE精选美食与玩乐，款待最重要的人。",a.absUrl(),e.data.subscribe.product.sPicUrl))})},o.partyInfo();var l=function(e,t,o,n,a){if(!arguments.callee.table){arguments.callee.footDlg={iPay:"iPay",fullPay:"fullPay",expired:"expired",inviteAndSendCard:"inviteAndSendCard",sendCard:"sendCard",toParticipate:"toParticipate",participated:"participated",full:"full",toParticipateMe:"toParticipateMe",participatedMe:"participatedMe",fullMe:"fullMe",seeCard:"seeCard"},arguments.callee.headDlg={stepTwo:"stepTwo",stepThree:"stepThree",expired:"expired",paid:"paid"};var r=arguments.callee.footDlg,i=arguments.callee.headDlg;arguments.callee.table=[[1,-1,-1,-1,-1,[r.expired,i.expired]],[0,0,0,1,-1,[r.iPay,i.stepTwo]],[0,0,1,1,-1,[r.inviteAndSendCard,i.paid]],[0,1,0,1,-1,[r.fullPay,i.stepThree]],[0,1,1,1,-1,[r.sendCard,i.paid]],[0,0,0,0,0,[r.toParticipateMe,i.stepTwo]],[0,0,0,0,1,[r.participatedMe,i.stepTwo]],[0,0,1,0,0,[r.toParticipate,i.paid]],[0,0,1,0,1,[r.seeCard,i.paid]],[0,1,0,0,0,[r.fullMe,i.stepTwo]],[0,1,0,0,1,[r.participatedMe,i.stepTwo]],[0,1,1,0,0,[r.full,i.paid]],[0,1,1,0,1,[r.seeCard,i.paid]]]}var s=[e,t,o,n,a],l=[];e:for(var c=0;c<arguments.callee.table.length;c++)for(var d=0;5>d;d++)if(!(-1==arguments.callee.table[c][d]&&4>d)){if(-1!=arguments.callee.table[c][d]&&s[d]!==arguments.callee.table[c][d])break;if(4==d){l=arguments.callee.table[c][5];break e}}return l}}]),mainApp.controller("mealPartyOrderController",["$window","$rootScope","$scope","$routeParams","$location","$timeout","partyService","loginService",function(e,t,o,n,a,r,i,s){o.page={showOldPhone:!0},o.party={},o.curUser={},i.getPartyInfo(n.partyId).success(function(e,r,i){e.hasOwnProperty("code")&&"0"===e.code&&(o.party=e.data,t.page.pageTitle="饭局开组啦！"+o.party.subscribe.title,(1==o.party.isExpired||4==o.party.subscribe.status)&&a.path("/meal-party/"+n.partyId).replace())}),r(function(){e.scrollTo(0,document.body.scrollHeight)},500);var l=function(e){null!==e&&"undefined"!=typeof e&&(o.curUser.name=e.name,null!==e.mobilephone&&"undefined"!=typeof e.mobilephone?(o.curUser.mobile=e.mobilephone+"",o.page.showOldPhone=!0):o.page.showOldPhone=!1)},c=JSON.parse(e.sessionStorage.getItem("currentUser"));l(c),t.inAPP&&s.getUserInfo().success(function(t,o,n){if(t.hasOwnProperty("code")&&"0"===t.code){l(t.data);try{e.sessionStorage.setItem("currentUser",JSON.stringify(t.data))}catch(a){}}}),o.partyPay=function(){return o.curUser.name?o.curUser.mobile?o.curUser.smsCode?void i.checkPayer(o.curUser.mobile,o.curUser.smsCode).success(function(r,i,s){if(r.hasOwnProperty("code")&&"0"===r.code)if(t.inWX){"undefined"!=typeof _paq&&(o.party.isFull?_paq.push(["trackEvent","Party Pay",n.partyId]):_paq.push(["trackEvent","Party Prepay",n.partyId])),t.mealOrderInfo={data:o.party.subscribe,partyDiscount:o.party.discountTotal,currentUserName:o.curUser.name,mobile:o.curUser.mobile};try{e.sessionStorage.setItem("mealOrderInfo",JSON.stringify(t.mealOrderInfo))}catch(l){}a.path("/meal-pay")}else e.location="yhouse://pay/2/"+o.party.subscribe.subscribeId;else t.showDialog(r.message)}).error(function(e,o,n){t.showDialog(e.message)}):void t.showDialog("请输入您收到的验证码"):void t.showDialog("请输入您的手机号"):void t.showDialog("请输入您的真实姓名")}}]),mainApp.controller("mealPayController",["$scope","$rootScope","$location","$routeParams","$window","orderService","utilService","commonService",function(e,t,o,n,a,r,i,s){if(t.inWX&&(a.sessionStorage.getItem("refreshInWXForPay")?a.sessionStorage.removeItem("refreshInWXForPay"):(a.sessionStorage.setItem("refreshInWXForPay","refreshed"),a.location.reload())),e.mealOrder=t.mealOrderInfo,e.mealOrder.wxLimit=i.payLimit().wxLimit,e.mealOrder.alipayLimit=i.payLimit().alipayLimit,e.mealOrder.cardLimit=i.payLimit().cardLimit,e.mealOrder.unionPayLimit=i.payLimit().unionPayLimit,e.mealOrder.unionWebPayLimit=i.payLimit().unionWebPayLimit,e.mealOrder.cmbPayLimit=i.payLimit().cmbPayLimit,e.mealOrder.isWx=!1,e.mealOrder.isAlipay=!1,e.mealOrder.isCard=!1,e.mealOrder.isUnionPay=!1,e.mealOrder.isUnionWebPay=!1,e.mealOrder.isCmbPay=!1,e.mealOrder.data.channelPromocode&&e.mealOrder.data.channelPromocode.discount&&e.mealOrder.data.totalPay-e.mealOrder.data.channelPromocode.discount>0?(e.mealOrder.displayTotalPay=e.mealOrder.data.totalPay-e.mealOrder.data.channelPromocode.discount,e.mealOrder.couponCode=e.mealOrder.data.channelPromocode.promocode):(e.mealOrder.couponCode="",e.mealOrder.displayTotalPay=e.mealOrder.data.totalPay),t.inWX)e.mealOrder.data.totalPay>e.mealOrder.wxLimit?e.mealOrder.payType="dae":(e.mealOrder.payType="wx",e.mealOrder.isWx=!0);else if(t.inAlipay)e.mealOrder.totalPay>e.mealOrder.alipayLimit?e.mealOrder.payType="dae":(e.mealOrder.payType="alipay",e.mealOrder.isAlipay=!0);else if(t.inUnionPay){if("undefined"==typeof UPSdk){var l=document.createElement("script");l.src=i.unionPayPara().unionPayScript;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(l,c)}e.mealOrder.data.totalPay>e.mealOrder.unionPayLimit?e.mealOrder.payType="dae":(e.mealOrder.payType="unionpay",e.mealOrder.isUnionPay=!0)}else e.mealOrder.data.totalPay>e.mealOrder.alipayLimit?e.mealOrder.payType="dae":(e.mealOrder.payType="alipay",e.mealOrder.isAlipay=!0,e.mealOrder.isUnionWebPay=e.mealOrder.unionWebPayLimit>=e.mealOrder.data.totalPay);e.enableSubmit=!0,e.submitOrderPay=function(){if(!e.enableSubmit)return!1;if(e.enableSubmit=!1,"undefined"==typeof e.mealOrder.payType)return t.showDialog("请选择支付方式！"),e.enableSubmit=!0,!1;if("undefined"!=typeof _paq&&_paq.push(["trackEvent","Meal","Meal Pay Submit",e.mealOrder.data.id]),"wx"===e.mealOrder.payType)r.submitOrderPayWX(e.mealOrder.data.subscribeId,null,2,e.mealOrder.couponCode,e.mealOrder.currentUserName,e.mealOrder.mobile).success(function(o,n,i){function s(o){var n=o.outTradeNo;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:""+o.appId,timeStamp:""+o.timeStamp,nonceStr:""+o.nonceStr,"package":""+o["package"],signType:""+o.signType,paySign:""+o.paySign},function(o){return"get_brand_wcpay_request:ok"===o.err_msg?(a.location.href=r.orderPayBack(n),!0):(t.showDialog("支付失败！"),e.enableSubmit=!0,!1)})}return"0"!==o.code?void("2300"===o.code&&o.data.outTradeNo?a.location.href=r.orderPayBack(o.data.outTradeNo):(t.showDialog(o.message),e.enableSubmit=!0)):("undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",s,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",s),document.attachEvent("onWeixinJSBridgeReady",s)):s(o.data),void(e.enableSubmit=!0))})["catch"](function(){return t.showDialog("无法使用微信支付！"),e.enableSubmit=!0,!1});else if("alipay"===e.mealOrder.payType||"unionwebpay"===e.mealOrder.payType||"cmbpay"===e.mealOrder.payType){var o;"alipay"===e.mealOrder.payType&&(o=r.submitOrderPayAlipay(e.mealOrder.data.subscribeId,2,"/meal-pay",e.mealOrder.couponCode)),"unionwebpay"===e.mealOrder.payType&&(o=r.submitOrderPayUnionWebPay(e.mealOrder.data.subscribeId,2,"/meal-pay",e.mealOrder.couponCode)),"cmbpay"===e.mealOrder.payType&&(o=r.submitOrderPayCmbpay(e.mealOrder.data.subscribeId,2,"/meal-pay",e.mealOrder.couponCode)),null!==o&&(a.location.href=o),e.enableSubmit=!0}else"card"===e.mealOrder.payType||"unionpay"===e.mealOrder.payType&&(UPSdk.config({debug:i.unionPayPara().unionPayDebug,appId:i.unionPayPara().unionPayAppId,appName:i.unionPayPara().unionPayAppName}),UPSdk.ready(function(){UPSdk.getUserInfo({success:function(o){r.submitOrderPayUP(e.mealOrder.data.subscribeId,2,e.mealOrder.couponCode).success(function(o,n,i){return"0"!==o.code?void("2300"===o.code&&o.data.outTradeNo?a.location.href=r.orderPayBack(o.data.outTradeNo):(t.showDialog(o.message),e.enableSubmit=!0)):void UPSdk.payOrder({params:{tn:o.data.tn},success:function(n){return"00"===n.code?(a.location.href=r.orderPayBack(o.data.outTradeNo),!0):(t.showDialog("支付失败！"),e.enableSubmit=!0,!1)},fail:function(o){return t.showDialog("支付失败！"),e.enableSubmit=!0,!1}})})["catch"](function(){return t.showDialog("无法使用银联钱包支付！"),e.enableSubmit=!0,!1})},fail:function(e){}})}))},e.couponList={showCoupon:!1,usable:[],unusable:[],exchangeCode:"",discount:""},e.queryCoupon=function(){s.promoList(2,t.mealOrderInfo.data.id).success(function(t,o,n){"0"===t.code&&(e.couponList.usable=t.data.alist,e.couponList.unusable=t.data.ulist,setTimeout(function(){document.getElementsByClassName("coupon")[0].style.height=window.innerHeight-95+"px"},500))})},t.page.allowCoupon&&e.queryCoupon(),e.exchange=function(){""===e.couponList.exchangeCode?t.showDialog("请输入兑换码"):s.promo22(e.couponList.exchangeCode).success(function(o,n,a){e.couponList.exchangeCode="","0"===o.code?e.queryCoupon():t.showDialog(o.message)})},e.showCoupon=function(){e.couponList.showCoupon=!0},e.hideCoupon=function(){e.couponList.showCoupon=!1},e.nonuseCoupon=function(){e.mealOrder.couponCode="",e.couponList.discount="",e.mealOrder.displayTotalPay=e.mealOrder.data.totalPay,e.couponList.showCoupon=!1},e.useCoupon=function(t,o){e.mealOrder.couponCode=t,e.mealOrder.displayTotalPay=e.mealOrder.displayTotalPay>o?e.mealOrder.displayTotalPay-o:0,e.couponList.discount=o,e.couponList.showCoupon=!1}}]),mainApp.controller("myOrderListController",["$scope","$rootScope","$location","$window","$timeout","$routeParams","utilService","orderService",function(e,t,o,n,a,r,i,s){t.page.pageTitle="我的订单",e.currentTabId=0,e.tabs=i.getOrderListTabName(),e.urlMap=["",["/order-event/"],["/order-meal/","/order-meal/","/order-host/"]],e.paging={pageSize:20,loading:!0};var l=function(){a(function(){var e=document.getElementById("tabs_content");e&&(e.style.height=e.getElementsByClassName("my_order_list_tab_active")[0].offsetHeight+"px")},300)};e.switchTab=function(t){e.currentTabId!==t&&(-1==t&&(t=e.tabs.length-1),t==e.tabs.length&&(t=0),0===t&&e.currentTabId===e.tabs.length-1?e.swapTab("left",0):t===e.tabs.length-1&&0===e.currentTabId?e.swapTab("right",e.tabs.length-1):t>e.currentTabId?e.swapTab("left",t):e.swapTab("right",t))};var c=10,d=10,p=e.currentTabId;e.swapTab=function(t,o){p=o;var n,a,r=document.getElementById("tabs_content"),i=0,s=function(){i++,n="left"===t?p-(c-i)/c:p+(c-i)/c,r.children[0].style.left=100*-n+"%",i>=c&&clearInterval(a)};a=setInterval(s,d),e.currentTabId=p,e.queryOrderList(),r.style.height=r.children[0].children[e.currentTabId].offsetHeight+"px"};var u=function(){e.paging.loading=!0,s.myOrderList(e.tabs[e.currentTabId].id,e.tabs[e.currentTabId].currentPage,e.paging.pageSize).success(function(t,o,n){t.hasOwnProperty("code")&&"0"===t.code&&(e.tabs[e.currentTabId].content=e.tabs[e.currentTabId].content.concat(t.data.doc),e.tabs[e.currentTabId].showGetMore=0===t.data.isEnd),e.paging.loading=!1,l()})};e.queryOrderList=function(){0===e.tabs[e.currentTabId].content.length&&u()},e.queryOrderList(),e.getMore=function(){e.tabs[e.currentTabId].currentPage+=1,u()}}]),mainApp.controller("newsController",["$window","$scope","$filter","$rootScope","$location","$cookies","$routeParams","utilService","infoService","$sce",function(e,t,o,n,a,r,i,s,l,c){t.news=null;var d=s.clearId(i.newsId);l.news(d).success(function(o,i,l){if("0"===o.code&&o.data){if(n.appGt("3.2")){var c=encodeURIComponent(JSON.stringify({id:d,isInterested:o.data.isInterested?1:0,sPicUrl:o.data.picUrl,description:o.data.description,title:o.data.title,shareUrl:o.data.shareUrl+("undefined"!=typeof r.get("UI")?"&share_ui="+r.get("UI"):"")}));e.location="yhouse://broker?scheme="+encodeURIComponent("news/"+d)+"&use=share&data="+c}n.page.pageTitle=o.data.title,n.$emit("pageTitleChanged"),o.data.content=s.handleRecommendManual("news",o,n.inAPP),o.data.content=s.handleImage(o.data.content,!1),t.news=o.data}else a.path("/404")}).error(function(){a.path("/404")})}]),mainApp.controller("orderEventController",["$scope","$rootScope","$location","$window","$routeParams","utilService","orderService",function(e,t,o,n,a,r,i){var s=r.clearId(a.orderId);i.detail(t.currentUser.id,s,1).success(function(a,r,i){if("0"!==a.code)return void o.path("/my-order-list");if(t.page.pageTitle=a.data.title,e.orderDetail=a.data,e.orderDetail.channelPromocode&&e.orderDetail.channelPromocode.discount&&e.orderDetail.totalPay-e.orderDetail.channelPromocode.discount>0?e.orderDetail.displayTotalPay=e.orderDetail.totalPay-e.orderDetail.channelPromocode.discount:e.orderDetail.displayTotalPay=e.orderDetail.totalPay,e.orderDetail.eventTitle=e.orderDetail.title,e.orderDetail.beginTime=e.orderDetail.dateTime,e.orderDetail.subscribeNum=e.orderDetail.count,e.orderDetail.neededCredits=e.orderDetail.price,e.orderDetail.id=e.orderDetail.subscribeId,30===a.data.status){t.eventOrderInfo=e.orderDetail;try{n.sessionStorage.setItem("eventOrderInfo",JSON.stringify(e.orderDetail))}catch(s){}}}),e.goOnPay=function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent",r.getEventKey(e.orderDetail.product.eventType),r.getEventKey(e.orderDetail.product.eventType)+" pay",e.orderDetail.id]),o.path("/"+r.getEventKey(e.orderDetail.product.eventType)+"-pay")}}]),mainApp.controller("orderHostController",["$scope","$rootScope","$location","$routeParams","utilService","orderService",function(e,t,o,n,a,r){var i=a.clearId(n.orderId);r.hostPayDetail(i,2).success(function(n,a,r){return n.hasOwnProperty("code")&&"0"!==n.code?void o.path("/my-order-list"):(t.page.pageTitle=n.data.title,void(e.orderDetail=n.data))})}]),mainApp.controller("orderMealController",["$scope","$rootScope","$location","$window","$routeParams","utilService","orderService","mealService",function(e,t,o,n,a,r,i,s){e.orderDetail=null,e.reserve={showPickTime:!1,dates:[],timeArray:[],date:"",calendar:"",currentStock:"",time:"",pickDatetime:function(){e.reserve.showPickTime=!e.reserve.showPickTime},closeMask:function(){e.reserve.showPickTime=!1},chooseDate:function(t){e.reserve.date=t.date,e.reserve.timeArray=t.time,e.reserve.calendar=t.calendar,e.reserve.currentStock=t.currentStock,e.reserve.chooseTime(e.reserve.timeArray[0])},chooseTime:function(t){e.reserve.time=t},dateTimeConfirm:function(){e.reserve.showPickTime=!1,e.dialog.showConfirm=!0,e.orderDetail.date=e.reserve.date,e.orderDetail.calendar=e.reserve.calendar,e.orderDetail.time=e.reserve.time,e.canOrderNum=e.reserve.currentStock}},e.dialog={showConfirm:!1,theme:"确认就餐时间",desc:"就餐时间确定后不可更改,是否保存您当前选择的时间",leftBtn:"取消",rightBtn:"确定",cancel:function(){e.orderDetail.showtime=!1,e.dialog.showConfirm=!e.dialog.showConfirm},confirm:function(){i.setreservedate(e.orderDetail.subscribeId,e.orderDetail.calendar,e.orderDetail.time).success(function(o,n,a){o&&"0"===o.code?(e.orderDetail.confirmDate=o.data.dateTime,e.dialog.showConfirm=!1,e.orderDetail.showtime=!0):t.showDialog(o.message)})}};var l=r.clearId(a.orderId);i.detail(t.currentUser.id,l,2).success(function(a,r,i){if("0"!==a.code)return void o.path("/my-order-list");if(t.page.pageTitle=a.data.title,e.orderDetail=a.data,e.orderDetail.channelPromocode&&e.orderDetail.channelPromocode.discount&&e.orderDetail.totalPay-e.orderDetail.channelPromocode.discount>0?e.orderDetail.displayTotalPay=e.orderDetail.totalPay-e.orderDetail.channelPromocode.discount:e.orderDetail.displayTotalPay=e.orderDetail.totalPay,e.orderDetail.date="",e.orderDetail.calendar="",e.orderDetail.time="",e.orderDetail.showtime=!1,e.orderDetail.confirmDate="",1===e.orderDetail.canChangeTime&&s.reserve(e.orderDetail.id).success(function(t,o,n){t&&"0"===t.code&&(e.reserve.dates=t.data.doc,e.reserve.dates&&e.reserve.dates.length>0&&e.reserve.chooseDate(e.reserve.dates[0]))}).error(function(){e.reserve.dates=[]}),30==a.data.status){t.mealOrderInfo=a;try{n.sessionStorage.setItem("mealOrderInfo",JSON.stringify(a))}catch(l){}}var c=e.orderDetail.product.personsMin,d=e.orderDetail.product.personsMax;e.mealNumber=""+c,e.mealNumber+=c==d?"":"-"+d,e.mealNumber+="人套餐"}),e.goOnPay=function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","Meal","Meal Pay",e.orderDetail.id]),o.path("/meal-pay")}}]),mainApp.controller("pageController",function(){}),mainApp.controller("payResultController",["$scope","$rootScope","$location","$routeParams","$timeout","$interval","$window","utilService","orderService","mealService",function(e,t,o,n,a,r,i,s,l,c){function d(){e.enableSubmit=!1,a(function(){e.enableSubmit=!0},500)}e.cmEvent=!1,e.initPayResult=function(){l.payResult(n.outTradeNo).success(function(a,c,d){if("0"===a.code){if(e.orderResult=a.data,null===e.orderResult.dateTime||""===e.orderResult.dateTime||"seal.365.m"===t.siteCode&&(i.location="coco://365rili.com/schedule?action=create2&srcName="+encodeURIComponent("YHOUSE")+"&srcUrl="+encodeURIComponent(o.absUrl())+"&title="+encodeURIComponent(e.orderResult.goodName)+"&desc=&loc=&url="+encodeURIComponent("http://seal.m.yhouse.com/?pk_campaign=seal&pk_kwd=365")+"&time="+e.orderResult.dateTime.replace(/./g,"-")+"&allday=false&alarm=[0,10]"),!e.orderResult.reserveCode||null===e.orderResult.reserveCode||0===e.orderResult.reserveCode.length)var p=0,u=r(function(){l.getReserveCode(n.outTradeNo).success(function(t,o,n){p++,"0"===t.code&&t.data&&t.data.length>0&&(e.orderResult.reserveCode=t.data,r.cancel(u)),10===p&&0===e.orderResult.reserveCode.length&&(e.orderResult.reserveCode=["我们已将预订号发送至您预留的手机，请注意查收短信。"])})},3e3,10);1==e.orderResult.productType&&(i.localStorage.getItem("cmEventId")&&i.localStorage.getItem("cmEventId")==e.orderResult.goodId||!s.isEmptyNumber(e.orderResult.cmId))&&(e.cmEvent=!0,t.page.showApp=!0,t.univseralLinksParams="")}else t.inAPP?e.data=a:(t.showDialog(a.message),o.path("/my-order-list"))})},e.initPayResult(),e.enableSubmit=!0,e.showMyOrder=function(){d(),s.checkInIOS()?window.location="yhouse://go-booking-list":window.iniForward.showMyOrder()},e.showMyOrderMeal=function(){d(),window.location="yhouse://order/2/"+e.orderResult.subscribeId},e.showEventList=function(){d(),s.checkInIOS()?window.location="yhouse://go-event-list":window.iniForward.showEventList()},e.showMealList=function(){d(),s.checkInIOS()?window.location="yhouse://go-meal-list":window.iniForward.showMealList()},e.showInvitation=function(){d(),_paq.push(["trackEvent","Pay Result","Invitation Click",e.orderResult.productType+"/"+e.orderResult.subscribeId]),window.location="yhouse://go-invitation/"+e.orderResult.productType+"/"+e.orderResult.subscribeId}}]),mainApp.controller("payResultEventController",["$scope","$rootScope","$location","$routeParams","$timeout","utilService","orderService",function(e,t,o,n,a,r,i){function s(){e.enableSubmit=!1,a(function(){e.enableSubmit=!0},500)}i.payResultEvent(n.eventSubscribeId).success(function(n,a,r){"0"===n.code?e.orderResult=n.data:t.inAPP?e.data=n:(t.showDialog(n.message),o.path("/my-order-list"))}),e.enableSubmit=!0,e.showMyOrder=function(){s(),r.checkInIOS()?window.location="yhouse://go-booking-list":window.iniForward.showMyOrder()},e.showEventList=function(){s(),r.checkInIOS()?window.location="yhouse://go-event-list":window.iniForward.showEventList()},e.showMealList=function(){s(),r.checkInIOS()?window.location="yhouse://go-meal-list":window.iniForward.showMealList()},e.showInvitation=function(){s(),_paq.push(["trackEvent","Pay Result","Invitation Click",e.orderResult.productType+"/"+e.orderResult.subscribeId]),window.location="yhouse://go-invitation/"+e.orderResult.productType+"/"+e.orderResult.subscribeId}}]),mainApp.controller("promoController",["$rootScope","$scope","$routeParams","$location","commonService","utilService","infoService",function(e,t,o,n,a,r,i){t.promocode=null,t.mobile="",t.promoData=null,t.enableSubmit=!0,t.hideSuccess=!0,t.loading=!1,t.cityId=null,t.showTopic=!1,t.topicList=null,t.page.showApp=!0,e.page.banner="了解APP",e.openApp=function(){window.location="http://m.yhouse.com/m/mapp.htm"},e.page.pageTitle="50元YHOUSE悦会贵宾券免费送","SHAREUI"===o.promoCode&&e.page.shareUi?a.queryPromoUserId(e.page.shareUi).success(function(o,r,i){o.code&&"0"===o.code?(t.promoData=o.data,t.promocode=o.data.promocode,e.inWX&&a.initWxConfig(n.absUrl(),e.page.pageTitle,"使用贵宾码"+t.promoData.promocodeAlias+"，首次下单满150即获50元减免。精选轻奢美食与活动，来YHOUSE立即享用！",n.absUrl(),"")):(e.showDialog(o.message),t.enableSubmit=!1)}):(t.promocode=o.promoCode,a.queryPromocode27(t.promocode).success(function(o,r,i){o.code&&"0"===o.code?(t.promoData=o.data,e.inWX&&a.initWxConfig(n.absUrl(),e.page.pageTitle,"使用贵宾码"+t.promoData.promocodeAlias+"，首次下单满150即获50元减免。精选轻奢美食与活动，来YHOUSE立即享用！",n.absUrl(),"")):(e.showDialog(o.message),t.enableSubmit=!1)})),t.getpromo=function(){var o=r.checkMobile(t.mobile);return""!==o?(e.showDialog(o),void(t.mobile="")):(document.activeElement&&document.activeElement.blur&&document.activeElement!==document.body?document.activeElement.blur():document.querySelector("input[type='tel']").blur(),t.loading=!0,void a.promo(t.mobile,t.promocode).success(function(o,n,a){t.loading=!1,"0"!==o.code?(t.mobile="",e.showDialog(o.message),"undefined"!=typeof _paq&&_paq.push(["trackEvent","Vip Code Get","get"])):(t.hideSuccess=!1,t.mobile=o.data.mobilePhone)}).error(function(){e.showDialog(data.message)}))},a.getCity().success(function(e,o,n){"0"==e.code&&e.data&&(t.cityId=e.data.cityId,i.promoGetTopic(t.cityId).success(function(e,o,n){"0"==e.code&&e.data?(t.showTopic=!0,t.topicList=e.data.doc):t.showTopic=!1}).error(function(){t.showTopic=!1}))})}]),mainApp.controller("promoNewController",["$rootScope","$scope","$cookies","$window","$location","commonService","utilService",function(e,t,o,n,a,r,i){e.page.title="YHOUSE新人有礼",t.promoNewCode="FKRLJ20",t.show=!0,t.loading=!1,t.promoNew={price:20,titleOne:"#疯狂日料季#优惠券",descOne:"订单满150元即可使用"},t.coupon=null,t.getpromo=function(){t.loading=!0,"undefined"==typeof o.get("UA")?e.inAPP?n.location="yhouse://login":a.path("/register"):r.promo22(t.promoNewCode).success(function(o,n,a){t.loading=!1,"0"!==o.code?(e.showDialog(o.message),"undefined"!=typeof _paq&&_paq.push(["trackEvent","Vip Code Get","get"])):(t.show=!1,t.coupon=o.data,window.scrollTo(0,0))}).error(function(){e.showDialog(data.message)})}}]),mainApp.controller("promoPartnerController",["$rootScope","$scope","$routeParams","$location","commonService","utilService",function(e,t,o,n,a,r){t.promocode=o.promoCode,t.mobile="",t.enableSubmit=!0,t.hideSuccess=!0,t.loading=!1,e.page.pageTitle="50元YHOUSE悦会贵宾券免费送",e.inWX&&a.initWxConfig(n.absUrl(),e.page.pageTitle,"使用贵宾码"+t.promocode+"，首次下单满150即获50元减免。精选轻奢美食与活动，来YHOUSE立即享用！",n.absUrl(),""),t.getpromo=function(){var o=r.checkMobile(t.mobile);return""!==o?(e.showDialog(o),void(t.mobile="")):(document.activeElement&&document.activeElement.blur&&document.activeElement!==document.body?document.activeElement.blur():document.querySelector("input[type='tel']").blur(),t.loading=!0,void a.promoThirdParty(t.mobile,t.promocode).success(function(o,n,a){t.loading=!1,"0"!==o.code?(t.mobile="",e.showDialog(o.message)):(t.hideSuccess=!1,t.mobile=o.data.mobilePhone)}).error(function(){e.showDialog(data.message)}))}}]),mainApp.controller("qaController",["$scope",function(e){e.csUrl="yhouse://my-feedback",e.items=[{title:"注册",questions:[{question:"如何注册YHOUSE会员？",answer:"下载YHOUSE APP后，点击下方右侧“我的”进入登录/注册页面，输入手机号后点击“发送验证码”，输入您收到的验证码点击“登录”后即可快速登录，您也可以使用手机账号输入密码或使用第三方登录。"}]},{title:"订单",questions:[{question:"怎么查看我的订单？",answer:"登录YHOUSE APP后，点击下方右侧“我的”进入个人管理页面，然后在“预定管理”中可以看到我预约过的所有订单。"},{question:"预定美食or活动，找不到预约码怎么办？",answer:"打开APP，点击下方右侧“我的”进入个人管理页面，然后在“预定管理”里找到相应的订单，点击相应订单后即可找到相应的预约码。"},{question:"如何开具发票？",answer:"美食和活动，我司均不提供发票，如有需求，可在现场找餐厅或者主办方开具。"},{question:"如何申请退款？",answer:"打开APP，点击下方右侧“我的”进入个人管理页面，然后在“预定管理”里找到相应的订单，在订单最下方您可以点击申请退款。"},{question:"为什么我没有消费，在订单详情页却找不到退款按钮？",answer:"目前有部分商品不可退款或设置了退款时限，请在商品须知中查看相应的退款信息。"},{question:"APP上的活动我预约后是否可以直接去？",answer:"在您报名或付款后，客服会根据您的信息帮您确认活动名额，确认成功会发送短信通知您，告知参与活动的详细信息。"},{question:"我可以为他人代订么？",answer:"您可以帮他人代订活动或套餐，但是您在预定时，最好填写预定人的真实姓名和联系方式，这样我们可以直接和预订人联系，提供更直接的服务。"}]},{title:"支付",questions:[{question:"一共有几种付款方式？",answer:"目前支持支付宝、微信、银行卡支付三种支付方式。"},{question:"付款不成功，怎么办？",answer:"如您遇到付款页面报错无法完成付款的问题，可以截屏保存，然后添加客服微信号“yhouse112233”，反馈在线客服，我们会及时为您处理。"},{question:"为什么银行已经扣款了，但是订单仍然显示未支付？",answer:'若您的网银已扣款，订单仍旧显示“未支付”，一般是由于网络繁忙，导致数据延迟，您可以联系客服热线<a href="tel:4008-215-270">4008-215-270</a>或者截屏保存，然后添加客服微信号“yhouse112233”，反馈给在线客服，我们会及时为您处理。'},{question:"哪些原因可能会造成支付失败？",answer:"支付宝网页端支付限额10000 元，支付宝客户端限额20000元，微信支付限额8000元，银联在线支付限额2000元，如果超出限额，有可能造成支付不成功。"},{question:"重复多次付款了，怎么办？",answer:'如果您对购买的产品进行支付时银行卡扣款多次，可能是您支付钱款后，系统显示延迟，导致重复支付，可联系客服热线<a href="tel:4008-215-270">4008-215-270</a>，我们会及时为您处理。'}]},{title:"优惠券",questions:[{question:"如何兑换优惠券？",answer:"打开APP，点击“我的”进入“优惠券”页面，输入您的兑换码后便可以成功领取优惠券。"},{question:"如何使用优惠券？",answer:"在下单支付的时候，在支付页面会显示优惠券的数量，点击进入后选择合适的优惠券即可。"},{question:"如何使用邀请有礼？",answer:"打开APP，点击“我的”后进入“邀请有礼”页面，通过相应的渠道分享给好友，等您的好友领取您的礼券并首单成功消费，您即可获得相应的优惠券。"},{question:"已经邀请好友为什么没有拿到优惠券？",answer:"您邀请的好友首单成功消费后方可领取优惠券。"},{question:"下单的时候使用了优惠券，但之后申请了退款，优惠券还能使用吗？",answer:"不可以"},{question:"专题优惠券是什么？",answer:"专题优惠券是指，在相关专题内的美食或活动才可以使用的优惠券"},{question:"为什么我领取的优惠券不能使用？",answer:"可能是专题优惠券、可能是已失效、可能是价格门槛未达到优惠券不能使用的可能原因是：过期、订单未达到相应的价格或者是专题优惠券（专题内的美食或活动才可使用）。"}]},{title:"到店相关",questions:[{question:"在现场无法找到自己的预约码怎么办？",answer:'<p>1. 您可以直接致电客服热线（<a href="tel:4008215270">4008215270</a>），我们可以重新发送短信给您。</p><p>2. 打开APP，点击“我的”进入“订单管理”页面，找到您相应的订单，即可看到自己的预约码。</p>'},{question:"到达活动现场或者餐厅，商家表示未预定或者不知道此活动，怎么办？",answer:'您可以直接致电客服热线<a href="tel:4008-215-270">4008-215-270</a>，我们会为您紧急处理，同时我们保证平台上的所有产品都是有合作的。'},{question:"活动现场或餐厅出示了预约码但是商户无法核销，导致不提供服务或服务之后不让走怎么办？",answer:'您可以可以直接致电客服热线<a href="tel:4008215270">4008215270</a>，我们会为您紧急处理。'}]}],e.toggle=function(t,o){"undefined"==e.items[t].questions[o].current?e.items[t].questions[o].current=!0:e.items[t].questions[o].current=!e.items[t].questions[o].current}}]),mainApp.controller("recruitController",["$scope","$rootScope","specialService",function(e,t,o){e.nickName="",e.wxAccount="",e.email="",e.interestStr="",e.interestArr=[{interest:"美食",checked:!1},{interest:"旅行",checked:!1},{interest:"户外",checked:!1},{interest:"艺术",checked:!1},{interest:"手工",checked:!1},{interest:"烹饪",checked:!1},{interest:"数码测评",checked:!1},{interest:"时尚",checked:!1}],e.checkInterest=function(t){e.interestArr[t].checked=!e.interestArr[t].checked,e.interestArr[t].checked?e.interestStr+=e.interestArr[t].interest+",":e.interestStr=e.interestStr.replace(e.interestArr[t].interest+",","")},e.submit=function(){if(e.email){var n=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(e.email);if(!n)return void t.showDialog("您输入的邮箱不正确")}o.recruit([e.nickName,e.wxAccount,e.email,e.interestStr.substring(0,e.interestStr.length-1)],function(){e.nickName="",e.wxAccount="",e.email="",e.interestStr="",angular.forEach(e.interestArr,function(e){e.checked=!1}),t.showDialog("您已报名成功，稍后有专员与您联系。")})}}]),mainApp.controller("redirectController",["$scope","$rootScope","$location","$window","$routeParams",function(e,t,o,n,a){var r=a.encodedRedirect.replace(/-SLASH-/g,"/");o.path(r)}]),mainApp.controller("registerController",["$scope","$rootScope","$location","$window","loginService",function(e,t,o,n,a){e.mobile="",e.verifyCode="",e.enableSubmit=!0,e.register=function(){e.enableSubmit=!1,a.register(e.mobile,e.verifyCode).success(function(e,a,r){if("0"===e.code){try{n.sessionStorage.setItem("currentUser",JSON.stringify(e.data))}catch(i){}t.showDialog("恭喜您，注册成功！"),o.path(t.loginNextPath)}else t.showDialog(e.message)}).error(function(e,o,n){t.showDialog(e.message)})}}]),mainApp.controller("searchController",["$scope","$rootScope","$window","$location","$routeParams","commonService","utilService",function(e,t,o,n,a,r,i){function s(e){for(var t,o=[],n={},a=0;null!=(t=e[a]);a++)n[t]||(o.push(t),o.reverse(),n[t]=!0);return o}function l(){2==e.filterKeys.catalog?e.filterKeys.a1ClassName="美食":1==e.filterKeys.catalog?e.filterKeys.a1ClassName="玩乐":6==e.filterKeys.catalog&&(e.filterKeys.a1ClassName="生活学院")}var c=n.search(),d=Object.keys(c).length;e.searchKey=void 0!=c.key?c.key:null,e.searchHistory=[],e.searchResult=null,e.recommendData=null,e.showSearchInput=!0,e.loading=!1,e.currentTabId=void 0!=c.bizType?i.clearId(c.bizType):1,e.currentFilterShow=!1,e.currentFilterTab=1,e.cityId=o.localStorage.getItem("cityId")?o.localStorage.getItem("cityId"):2,e.searchHotKey=null,r.searchHotKey(e.cityId).success(function(t,o,n){"0"===t.code&&t.data&&(e.searchHotKey=t.data)}),e.urlParamData=null,r.filterList(e.cityId).success(function(t,o,n){"0"===t.code&&t.data&&(e.urlParamData=t.data)}),0===d?(c.type=2,e.searchInputPage=!0):1===d&&void 0!=c.type?e.searchInputPage=!0:1===d&&void 0!=c.key?(c.type=2,e.searchInputPage=!1,e.searchResultPage=!0):2===d&&void 0!=c.type&&void 0!=c.key?(e.searchInputPage=!1,e.searchResultPage=!0):void 0!=c.bizType&&(e.searchInputPage=!1,e.searchResultPage=!1,e.searchFilterPage=!0,d>1&&void 0!=c.key?e.searchFilterPage=!0:e.showSearchInput=!1),e.clearSearch=function(){e.searchKey=null,e.searchResult=null,e.recommendData=null,e.searchInput=!0,n.search({type:c.type?c.type:c.catalog})},e.cancelSearch=function(){void 0==c.key||void 0==c.type&&void 0==c.bizType?o.history.back(-1):n.search({}).path("/")},e.clearHistory=function(){e.searchHistory=[],o.localStorage.setItem("searchHistory","")},e.clearList=function(t){1===e.searchHistory.length?(e.searchHistory=[],e.recommendData=null,o.localStorage.setItem("searchHistory","")):(e.searchHistory.splice(t,1),o.localStorage.setItem("searchHistory",JSON.stringify(e.searchHistory)))},e.myKeyup=function(t){var o=window.event?t.keyCode:t.which;e.searchKey&&13==o&&(n.search({type:c.catalog,key:e.searchKey}),e.search(e.searchKey))},e.search=function(t){e.searchKey=t,e.loadSearch(e.searchKey),n.search("key",t)},e.$watch("searchKey",function(){e.searchKey||(e.searchResult=null,e.recommendData=null)}),o.localStorage.getItem("searchHistory")&&(e.searchHistory=JSON.parse(o.localStorage.getItem("searchHistory"))),e.searchKey&&(e.searchHistory.push(e.searchKey),e.searchHistory=s(e.searchHistory),e.searchHistory&&e.searchHistory.length>0&&o.localStorage.setItem("searchHistory",JSON.stringify(e.searchHistory))),
e.loadSearch=function(t){r.fullSearch(e.cityId,t,c.type).success(function(t,o,n){"0"===t.code&&t.data&&(t.data.searchData&&(e.searchResult=t.data.searchData),t.data.recommendData&&(e.searchResult=t.data.recommendData,e.recommendData=t.data.recommendData))})},void 0!=c.key&&e.loadSearch(e.searchKey),e.filterKeys={bizType:void 0!=c.bizType?i.clearId(c.bizType):1,catalog:void 0!=c.catalog?i.clearId(c.catalog):2,key:e.searchKey,ct:void 0!=c.ct?c.ct:null,ct1:null,ct2:null,filter:void 0!=c.filter?i.clearId(c.filter):2,ps:void 0!=c.ps?c.ps:0,dt:void 0!=c.dt?c.dt:0,pc:void 0!=c.pc?c.pc:0,bc:void 0!=c.bc?c.bc:0,mc:void 0!=c.mc?c.mc:null,sort:1,cx:void 0!=c.cx?c.cx:0,pos:null,coordType:null,a1ClassName:"美食",a2ClassName:"分类筛选",a3ClassName:"智能排序"},void 0!=c.bizType&&1==c.bizType?l():e.filterKeys.a1ClassName="菜系",e.tabContents=new Array(3);for(var p=1;p<e.tabContents.length;p++)e.tabContents[p]={isEnd:!1,isBusy:!1,page:1,pid:null};e.changeCurrentFilterwindow=function(){e.currentFilterShow=!e.currentFilterShow},e.closeCurrentFilterwindow=function(){e.currentFilterShow=!1},e.switchTab=function(t){e.filterKeys.bizType=e.currentTabId=i.clearId(t),e.currentFilterShow=!1,1==e.filterKeys.bizType?(n.search("bizType",1),l(),e.filterKeys.a2ClassName="分类筛选",e.filterKeys.a3ClassName="智能排序"):2==e.filterKeys.bizType&&(n.search("bizType",2),e.filterKeys.a1ClassName="菜系",e.filterKeys.a2ClassName="分类筛选",e.filterKeys.a3ClassName="智能排序"),e.filterReset(),e.reloadFilter()},e.switchFilterTab=function(t){e.currentFilterTab==t?e.changeCurrentFilterwindow():(e.currentFilterTab=t,e.currentFilterShow=!0)},e.switchCatalog=function(t){e.filterKeys.catalog=t},e.catalogClick=function(t,o,a){"全部"!=o?e.filterKeys.a1ClassName=o:l(),2==e.filterKeys.catalog?(e.filterKeys.cx=a,e.filterKeys.ct=null,e.filterKeys.ct1=null,e.filterKeys.ct2=null):1==e.filterKeys.catalog?(e.filterKeys.cx=null,e.filterKeys.ct=a,e.filterKeys.ct1=a,e.filterKeys.ct2=null):6==e.filterKeys.catalog&&(e.filterKeys.cx=null,e.filterKeys.ct=a,e.filterKeys.ct1=null,e.filterKeys.ct2=a),n.search("catalog",t),e.filterReset(),e.changeCurrentFilterwindow(),e.reloadFilter()},e.filterClick=function(t,o,n,a){"ps"==o&&(e.filterKeys.ps=a),"dt"==o&&(e.filterKeys.dt=a),"pc"==o&&(e.filterKeys.pc=a),"bc"==o&&(e.filterKeys.bc=a),"mc"==o&&(e.filterKeys.mc=a)},e.filterReset=function(){e.filterKeys.ps=0,e.filterKeys.dt=0,e.filterKeys.pc=0,e.filterKeys.bc=0,e.filterKeys.mc=null},e.sortClick=function(t,o){e.filterKeys.a3ClassName=t,e.filterKeys.sort=o,e.changeCurrentFilterwindow(),e.reloadFilter()},e.confirmFilter=function(){e.currentFilterShow=!1,e.reloadFilter()},e.cxClick=function(t,o){"全部"!=t?e.filterKeys.a1ClassName=t:e.filterKeys.a1ClassName="菜系",e.changeCurrentFilterwindow(),e.reloadFilter()},e.loadMoreFilter=function(){e.loadFilter()},e.loadFilter=function(){e.tabContents[e.currentTabId].isBusy||(e.loading=!0,e.tabContents[e.currentTabId].isBusy=!0,r.filterResult(e.filterKeys.bizType,e.filterKeys.catalog,e.cityId,e.filterKeys.filter,e.tabContents[e.currentTabId].page,e.tabContents[e.currentTabId].pid,e.filterKeys.key,e.filterKeys.ag,e.filterKeys.bc,e.filterKeys.ct,e.filterKeys.cx,e.filterKeys.dt,e.filterKeys.mc,e.filterKeys.pc,e.filterKeys.ps,e.filterKeys.sort,e.filterKeys.pos,e.filterKeys.coordType).success(function(t,o,n){if("0"===t.code&&t.data){1===t.data.searchData.isEnd&&(e.tabContents[e.currentTabId].isEnd=!0);var a=t.data.searchData.doc;e.tabContents[e.currentTabId].list?e.tabContents[e.currentTabId].list=e.tabContents[e.currentTabId].list.concat(a):e.tabContents[e.currentTabId].list=a,e.loading=!1,e.tabContents[e.currentTabId].page++,e.tabContents[e.currentTabId].isBusy=!1,e.tabContents[e.currentTabId].pid=t.data.searchData.pid,e.tabContents[e.currentTabId].recommendData=t.data.recommendData,e.tabContents[e.currentTabId].recommendData?e.tabContents[e.currentTabId].filterResult=e.tabContents[e.currentTabId].recommendData:e.tabContents[e.currentTabId].filterResult=e.tabContents[e.currentTabId].list}}))},e.reloadFilter=function(){e.currentTabId;o.scrollTo(0,0),e.tabContents[e.currentTabId].isEnd=!1,e.tabContents[e.currentTabId].page=1,e.tabContents[e.currentTabId].list=[],e.tabContents[e.currentTabId].recommendData=[],e.tabContents[e.currentTabId].filterResult=[],e.loadFilter()},void 0!=c.bizType&&e.loadFilter()}]),mainApp.controller("shareTagController",["$scope","$rootScope","$location","$window","$routeParams","utilService","snsService","$sce","commonService","specialService",function(e,t,o,n,a,r,i,s,l,c){function d(t){if(t)for(var o=0;o<t.length;o++){var n=t[o].data;n.videoUrl&&(e.videoConfig[n.id]={preload:"none",sources:[{src:s.trustAsResourceUrl(n.videoUrl),type:"application/x-mpegURL"}],plugins:{poster:n.smallPicUrl,analytics:{category:"webcast",label:n.id,events:{ready:!0,play:!0,pause:!0,complete:!0}}}})}}function p(t){t&&i.shareTagNew(t,1).success(function(t,n,a){"0"===t.code&&t.data?(e.flagNew=t.data.doc,d(e.flagNew)):o.path("/404")}).error(function(){o.path("/404")})}o.search().id?e.shareId=r.clearId(o.search().id):o.search().key?e.tagName=o.search().key:o.path("/404"),e.shareTagInfo=null,e.picUrls=[],e.flagInfo=null,e.flagHot=null,e.flagNew=null,e.currentTabId=0,e.tabs=r.getShareTagTabName(),e.currentActive=0,e.bigPic=!1,e.videoConfig=[],e.videoAPI=[],e.onPlayerReady=function(t,o){e.videoAPI[o]=t},e.onUpdateState=function(t,o){"play"===t&&Object.keys(e.videoAPI).forEach(function(t){o!=t&&e.videoAPI[t].pause()})},e.openBigPic=function(t,o){e.picUrls=t,e.currentActive=o,e.bigPic=!0},e.closeBigPic=function(){e.bigPic=!1},e.switchTab=function(t){e.currentTabId=t,e.flagHot&&e.flagNew&&(0===e.currentTabId?e.flagInfo=e.flagHot:1===e.currentTabId&&(e.flagInfo=e.flagNew))},e.shareId?i.shareTagById(e.shareId).success(function(n,a,r){"0"===n.code&&n.data?(n.data.title="#"+n.data.title+"#",e.shareTagInfo=n.data,e.flagInfo=e.flagHot=n.data.contentList,t.page.pageTitle=n.data.title,t.inWX&&l.initWxConfig(o.absUrl(),n.data.title,"我正在YHOUSE参与"+n.data.title+"，快来加入我们！",o.absUrl(),n.data.shareImgUrl),t.$emit("pageTitleChanged"),d(e.flagHot),p(n.data.id)):o.path("/404")}).error(function(){o.path("/404")}):e.tagName?i.shareTagByName(e.tagName).success(function(n,a,r){"0"===n.code&&n.data?(e.shareTagInfo=n.data,e.flagInfo=e.flagHot=n.data.contentList,t.page.pageTitle=n.data.title,t.inWX&&l.initWxConfig(o.absUrl(),n.data.title,"我正在YHOUSE参与"+n.data.title+"，快来加入我们！",o.absUrl(),n.data.shareImgUrl),t.$emit("pageTitleChanged"),d(e.flagHot),p(n.data.id)):o.path("/404")}).error(function(){o.path("/404")}):o.path("/404")}]),mainApp.controller("shareTagUploadController",["$scope","$rootScope","$location","$routeParams","snsService","$sce","commonService","$window","$q","utilService","$timeout","infoService",function(e,t,o,n,a,r,i,s,l,c,d,p){function u(e){for(var t="";t.length<e;t+=Math.random().toString(36).substr(2));return t.substr(0,e)}function m(e){var t=new Date,o=""+(t.getMonth()+1),n=""+t.getDate(),a=t.getFullYear();return o.length<2&&(o="0"+o),n.length<2&&(n="0"+n),[e,a,o,n,t.getTime()].join("/")+u(4)+".jpg"}var h,g="http://up.qiniu.com",f=[];e.shareTagUploadPreviews=[],e.isLoading=!0,e.notExceedLimits=!0,e.canSubmit=!1,e.currentActive=0,e.bigPic=!1,e.openBigPic=function(t,o){e.picUrls=t,e.currentActive=o,e.bigPic=!0},e.closeBigPic=function(){e.bigPic=!1},e.shareTagKey=o.search().key,e.hostId=c.clearId(o.search().hostId),e.del=function(t){e.dialog.showConfirm=!0,e.dialog.param=t},t.page.pageTitle="#吃货研究所#颜值餐厅晒照大赛",t.$emit("pageTitleChanged"),e.dialog={showConfirm:!1,theme:"",desc:"确定删除",leftBtn:"取消",rightBtn:"确定",cancel:function(t){e.dialog.showConfirm=!1},confirm:function(t){e.shareTagUploadPreviews.splice(t,1),e.shareTagUploadPreviews.length<9&&(e.notExceedLimits=!0),e.dialog.showConfirm=!1}},e.shareTagSubmit=function(){e.canSubmit&&""!=e.shareTagContent&&e.shareTagUploadPreviews.length>=1&&h&&(e.isLoading=!0,f=[],uploadedIndex=0,angular.forEach(e.shareTagUploadPreviews,function(n,r){var i=canvasResize("dataURLtoBlob",n.src),s=new XMLHttpRequest;s.open("POST",g,!0);var l,c;l=new FormData,l.append("key",m("share_article")),l.append("token",h),l.append("file",i);var p;s.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=(new Date).getTime();p=t-c;var o,a=e.loaded/1024,r=p/1e3,i=a/r;o=i>1024?(i/1024).toFixed(2)+"Mb/s":i.toFixed(2)+"Kb/s";var s=Math.round(100*e.loaded/e.total),l=document.getElementById(n.guid).getElementsByTagName("span");l[0].style.width=s+"%"}},!1),s.onreadystatechange=function(n){if(4==s.readyState&&200==s.status&&""!=s.responseText){var r=JSON.parse(s.responseText);if(console&&console.log(r),f.push(r.fileName),uploadedIndex+=1,e.shareTagUploadPreviews.length==f.length){var i=e.host?"#"+e.host.hostName+"#":"";description=e.shareTagKey+i+e.shareTagContent.replace(/<(?:.|\n)*?>/gm,"");var l=e.host?e.host.longitude:"",c=e.host?e.host.latitude:"";a.saveShareArticle(f.join(","),l,c,description).success(function(n,a,r){"0"===n.code&&n.data?(t.showDialog("发布成功"),e.isLoading=!1,d(function(){o.url(o.search().toUrl)},1500)):t.showDialog("网络错误,请稍候再试")})}}else 200!=s.status&&s.responseText},c=(new Date).getTime(),s.send(l)}))},e.$watchGroup(["shareTagContent","shareTagUploadPreviews.length"],function(t,o){""!=t[0]&&null!=t[0]&&t[1]>=1?e.canSubmit=!0:e.canSubmit=!1},!0),$script("./vendor/shareTagUpload.js",function(){null===s.localStorage.getItem("upToken")||"undefined"==typeof s.localStorage.getItem("upToken")||1e3*JSON.parse(s.localStorage.getItem("upToken")).upTokenExpired<(new Date).getTime()?a.getUpToken(t.currentUser.id).success(function(e,t,o){"0"===e.code&&e.data&&(h=e.data.upToken,s.localStorage.setItem("upToken",JSON.stringify(e.data)))}):h=JSON.parse(s.localStorage.getItem("upToken")).upToken,p.host(e.hostId,e.coordType,e.pos).success(function(t,o,n){"0"===t.code&&t.data&&(e.host=t.data)}),e.isLoading=!1,e.$apply()})}]).directive("shareTagUploader",["$window","$rootScope",function(e,t){return{restrict:"A",scope:{imageData:"=",isLoading:"=",notExceedLimits:"="},controller:["$scope","$element",function(e,t){}],link:function(e,o,n){function a(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}var r=document.getElementById("fileInput");o[0].addEventListener("click",function(e){e.stopPropagation(),r.click()},!1),r.addEventListener("change",function(o){var n=r.files,i=0,s=n.length;return 0!=s?s+e.imageData.length>9?void e.$apply(function(){t.showDialog("最多选中9张照片")}):(e.$apply(function(){e.isLoading=!0}),void angular.forEach(n,function(t,o){canvasResize(t,{width:800,height:300,crop:!1,quality:100,rotate:0,callback:function(t,o,n){i++,i===s&&(e.isLoading=!1),e.$apply(function(){e.imageData.push({src:t,guid:a()}),9==e.imageData.length&&(e.notExceedLimits=!1)})}})})):void 0},!1)}}}]),mainApp.controller("skuPopController",["$scope","$rootScope","$location","$window","$routeParams","mealService","utilService",function(e,t,o,n,a,r,i){var s=a.skuType;e.data=null,e.skuInfo=null,e.content=a.content,"meal"===s?n.localStorage.getItem("mealInfo")&&(e.data=JSON.parse(n.localStorage.getItem("mealInfo")),t.headTitle="套餐详情",e.facilityTitle="餐厅设施"):"event"===s?n.localStorage.getItem("eventInfo")&&(e.data=JSON.parse(n.localStorage.getItem("eventInfo")),t.headTitle=e.data.descriptionTitle,e.facilityTitle="注意事项"):"host"===s&&n.localStorage.getItem("hostInfo")&&(e.data=JSON.parse(n.localStorage.getItem("hostInfo")),e.facilityTitle="餐厅设施"),e.skuInfo=e.data.data,e.skuInfo.highlight=i.handleImage(e.skuInfo.highlight),e.skuInfo.graphicMenu=i.handleImage(e.skuInfo.graphicMenu),e.skuInfo.content=i.handleImage(e.skuInfo.content),t.inAPP&&(document.body.style.backgroundColor="transparent")}]),mainApp.controller("topicController",["$scope","$rootScope","$location","$routeParams","$window","$http","$cookies","$interval","$timeout","utilService","commonService","infoService",function(e,t,o,n,a,r,i,s,l,c,d,p){if(e.topic=null,e.pos=null,e.coordType=null,e.coupon={btnName:"",btnDisabled:!1},null!=n.topicId&&"undefined"!=typeof n.topicId){e.topicId=c.clearId(n.topicId),e.warmman=1180===e.topicId||1181===e.topicId||1225===e.topicId||1217===e.topicId||1215===e.topicId||1219===e.topicId||1218===e.topicId;var u=o.search();void 0!=u.pos&&void 0!=u.coordType&&(e.pos=u.pos,e.coordType=u.coordType),e.getCodeBtn=function(){"undefined"==typeof i.get("UA")?t.inAPP?a.location="yhouse://login":o.path("/register"):d.promo22(e.topic.promoCode).success(function(o,n,a){o.hasOwnProperty("code")&&"0"===o.code?(t.showDialog("领取成功"),e.coupon.btnName="已领取",e.coupon.btnDisabled=!0):"2113"===o.code?(t.showDialog(o.message),e.coupon.btnName="已领取",e.coupon.btnDisabled=!0):"2106"===o.code?(e.coupon.btnName="已过期",e.coupon.btnDisabled=!0):t.showDialog(o.message)})},p.topic(e.topicId,e.pos,e.coordType).success(function(n,r,s){if("0"===n.code&&n.data?(e.topic=n.data,t.page.pageTitle=n.data.topicName,t.$emit("pageTitleChanged"),0==n.data.usable?(e.coupon.btnName="点击领取",e.coupon.btnDisabled=!1):1==n.data.usable?(e.coupon.btnName="已领完",e.coupon.btnDisabled=!0):2==n.data.usable&&(e.coupon.btnName="已过期",e.coupon.btnDisabled=!0),t.inWX&&d.initWxConfig(o.absUrl(),n.data.topicName,n.data.topicDescription.replace(/<br\/>/g,"\n"),o.absUrl(),n.data.sPicUrl)):o.path("/404"),"undefined"!=typeof i.get("UA")&&n.data&&""!=n.data.promoCode&&d.isGetPromo(e.topic.promoCode).success(function(t,o,n){t.data&&(e.coupon.btnName="已领取",e.coupon.btnDisabled=!0)}),t.appGt("3.2")){var l=encodeURIComponent(JSON.stringify({id:e.topic.topicId,sPicUrl:e.topic.sPicUrl,description:e.topic.topicDescription?e.topic.topicDescription.replace(/&nbsp;/gi," ").replace(/<br\/>/gi,"\r\n"):"",title:e.topic.topicName,shareUrl:"http://"+window.location.host+"/topic/"+e.topic.topicId+"?pk_campaign=share&pk_kwd=topic"+("undefined"!=typeof i.get("UI")?"&share_ui="+i.get("UI"):"")}));a.location="yhouse://broker?scheme="+encodeURIComponent("topic/"+e.topic.topicId)+"&use=share&data="+l}}).error(function(){o.path("/404")});var m=s(function(){"undefined"!=typeof i.get("UA")&&e.topic&&""!=e.topic.promoCode&&(s.cancel(m),d.isGetPromo(e.topic.promoCode).success(function(t,o,n){t.data&&(e.coupon.btnName="已领取",e.coupon.btnDisabled=!0)}))},1e3,0)}}]),mainApp.controller("topicLexusController",["$scope","$rootScope","$location","$routeParams","$window","$http","$cookies","$interval","$timeout","utilService","commonService","infoService","$sce",function(e,t,o,n,a,r,i,s,l,c,d,p,u){e.topic=null,e.pos=null,e.coordType=null,e.coupon={btnName:"",btnDisabled:!1},e.topicId=c.clearId(n.topicId),e.warmman=1180===e.topicId||1181===e.topicId||1225===e.topicId||1217===e.topicId||1215===e.topicId||1219===e.topicId||1218===e.topicId;var m=o.search();void 0!=m.pos&&void 0!=m.coordType&&(e.pos=m.pos,e.coordType=m.coordType),p.topic(e.topicId,e.pos,e.coordType).success(function(n,a,r){"0"===n.code&&n.data?(e.topic=n.data,e.topic.topicLexusDescription="真正的驾驭<br>不只决胜赛道<br>更可随时随地纵情绝尘<br>精湛动感，快意非凡<br>更多独具优雅的LEXUS雷克萨斯体验活动<br>诚邀您亲临试驾",t.page.pageTitle=n.data.topicName,t.$emit("pageTitleChanged"),0==n.data.usable?(e.coupon.btnName="点击领取",e.coupon.btnDisabled=!1):1==n.data.usable?(e.coupon.btnName="已领完",e.coupon.btnDisabled=!0):2==n.data.usable&&(e.coupon.btnName="已过期",e.coupon.btnDisabled=!0),t.inWX&&d.initWxConfig(o.absUrl(),n.data.topicName,n.data.topicDescription.replace(/<br\/>/g,"\n"),o.absUrl(),n.data.sPicUrl)):o.path("/404"),"undefined"!=typeof i.get("UA")&&n.data&&""!=n.data.promoCode&&d.isGetPromo(e.topic.promoCode).success(function(t,o,n){t.data&&(e.coupon.btnName="已领取",e.coupon.btnDisabled=!0)})}).error(function(){o.path("/404")});var h=s(function(){"undefined"!=typeof i.get("UA")&&e.topic&&""!=e.topic.promoCode&&(s.cancel(h),d.isGetPromo(e.topic.promoCode).success(function(t,o,n){t.data&&(e.coupon.btnName="已领取",e.coupon.btnDisabled=!0)}))},1e3,0);e.videoHeight={height:.5625*document.body.clientWidth+"px"},e.videoConfig={preload:"none",sources:[{src:u.trustAsResourceUrl("http://p.yhres.com/gg/2016/05/12/LEXUS-60s-0422.mp4"),type:"video/mp4"}],plugins:{poster:"http://p.yhres.com/gg/2016/05/12/LEXUS-60s-0422.mp4?vframe/jpg/offset/37"}},e.cityIndex=0,e.city=null,e.lexusData={key:"2016lexus",name:"",sex:"",tel:"",agency:"",car:"",activeCity:""},e.check=function(){return e.lexusData.name?e.lexusData.sex?/^1[3|4|5|6|7|8][0-9]\d{4,8}$/.test(e.lexusData.tel)&&11==e.lexusData.tel.length?0==e.cityIndex?(t.showDialog("请选择城市"),!1):e.lexusData.agency?e.lexusData.car?e.lexusData.activeCity?!0:(t.showDialog("请选择活动城市"),!1):(t.showDialog("请选择车系"),!1):(t.showDialog("请选择经销商"),!1):(t.showDialog("请输入正确的手机号码"),!1):(t.showDialog("请选择称谓"),!1):(t.showDialog("请输入姓名"),!1)},e.cityChanged=function(t){e.cityIndex=t.id},e.lexus_submit=function(){e.check()&&(e.lexusData.city=e.cityArray[parseInt(e.cityIndex)],p.lincolnAd(e.lexusData).success(function(e){"0"!=e.code?t.showDialog("提交失败，请重试"):alert("提交成功")}).error(function(){t.showDialog("提交失败，请重试")}))},e.cityArray=["请选择城市","北京","保定","邯郸","石家庄","唐山","天津","太原","临汾","郑州","洛阳","济南","济宁","临沂","青岛","潍坊","西安","呼和浩特","包头","鄂尔多斯","乌鲁木齐","西宁","兰州","银川","哈尔滨","大庆","长春","沈阳","鞍山","大连","上海","杭州","湖州","金华","嘉兴","宁波","绍兴","台州","温州","南京","常州","南通","苏州","泰州","无锡","徐州","盐城","镇江","张家港","合肥","南昌","武汉","东莞","佛山","广州","惠州","江门","汕头","深圳","肇庆","中山","珠海","海口","福州","龙岩","泉州","厦门","长沙","成都","绵阳","南宁","昆明","曲靖","贵阳","重庆"],e.agencyArray=[["请选择经销商"],["北京博瑞","北京广通","北京英华","北京花园桥","北京庞大","北京和凌","北京博瑞翔腾"],["保定轩宇"],["邯郸远达"],["石家庄中升","石家庄庞大"],["唐山和凌","唐山庞大"],["天津港华","天津和凌","天津浩涵"],["太原大昌"],["临汾锦华"],["郑州远达","郑州富达"],["洛阳远达"],["济南天泓","济南利华晟"],["济宁天泓"],["临沂和凌"],["青岛世泰","青岛金阳光"],["潍坊博瑞"],["西安钧盛","西安中升","西安元丰"],["内蒙古康泰","呼和浩特惠通嘉华"],["包头信得惠"],["鄂尔多斯康泰"],["新疆华通"],["西宁龙腾"],["兰州美东"],["银川上陵"],["哈尔滨龙晟"],["大庆庞大"],["长春东环","长春辰宇"],["沈阳中晨华通","沈阳金廊"],["鞍山衡业"],["大连中升","大连金川"],["上海和凌","上海东昌","上海英之杰","上海骏佳","上海美跃","上海中升"],["浙江元通","浙江广通","杭州凌通","杭州中升"],["湖州东昌"],["金华凌丰","义乌广通"],["嘉兴常隆","嘉兴丰邦"],["宁波中升","宁波常隆","慈溪骏佳"],["绍兴英之杰"],["台州元丰","台州龙翔"],["温州凌通","温州中升","瑞安元通"],["江苏中佳","南京协众","南京中升"],["常州常隆","常州东昌"],["南通东方嘉宇","南通文峰"],["苏州常隆","苏州凌通","常熟伟杰","昆山中升","吴江庆丰"],["泰州高都"],["无锡常隆","无锡中升","江阴中进"],["徐州汇丰"],["盐城东昌"],["镇江东方美亚"],["张家港伟杰"],["合肥恒信","合肥丰源"],["南昌和凌","南昌中升"],["武汉恒信","武汉康顺","武汉安利捷"],["东莞中升","东莞腾兴","东莞美东"],["佛山骏领","顺德中升","佛山汇恒","佛山美兴"],["广州永佳","广州长悦","广州鸿粤","广州骏佳","广州中升"],["惠州中升"],["江门元泰通"],["汕头合和"],["深圳深业","深圳潮锋","深圳伟兴","深圳观澜中升","深圳中升","深圳大兴"],["肇庆汇恒"],["中山溢华","中山中裕"],["珠海美东"],["海南嘉翔"],["福建宾联","福州中升"],["龙岩美东"],["泉州宾联","泉州中升"],["厦门美东","厦门远达"],["长沙美东","长沙力天","湖南骏佳"],["四川中达","四川辰宇","成都通源","成都中升"],["绵阳启阳"],["南宁广缘"],["云南中凯","云南中升"],["曲靖添福源"],["贵阳通源","贵阳英华"],["重庆和凌","重庆中升"]]}]),mainApp.controller("topicLincolnController",["$scope","$rootScope","$location","$routeParams","$window","$http","$cookies","$interval","$timeout","utilService","commonService","infoService",function(e,t,o,n,a,r,i,s,l,c,d,p){if(e.topic=null,e.pos=null,e.coordType=null,e.coupon={btnName:"",btnDisabled:!1},e.topicId=c.clearId(n.topicId),!t.inAPP&&(1361==e.topicId||1362==e.topicId||1363==e.topicId||1364==e.topicId)){var u="2016lincoln";a.sessionStorage.setItem("channelType",u),r.defaults.headers.common.channelType=u}e.warmman=1180===e.topicId||1181===e.topicId||1225===e.topicId||1217===e.topicId||1215===e.topicId||1219===e.topicId||1218===e.topicId;var m=o.search();void 0!=m.pos&&void 0!=m.coordType&&(e.pos=m.pos,e.coordType=m.coordType),p.topic(e.topicId,e.pos,e.coordType).success(function(n,a,r){"0"===n.code&&n.data?(e.topic=n.data,t.page.pageTitle=n.data.topicName,t.$emit("pageTitleChanged"),0==n.data.usable?(e.coupon.btnName="点击领取",e.coupon.btnDisabled=!1):1==n.data.usable?(e.coupon.btnName="已领完",e.coupon.btnDisabled=!0):2==n.data.usable&&(e.coupon.btnName="已过期",e.coupon.btnDisabled=!0),t.inWX&&d.initWxConfig(o.absUrl(),n.data.topicName,n.data.topicDescription.replace(/<br\/>/g,"\n"),o.absUrl(),n.data.sPicUrl)):o.path("/404"),"undefined"!=typeof i.get("UA")&&n.data&&""!=n.data.promoCode&&d.isGetPromo(e.topic.promoCode).success(function(t,o,n){t.data&&(e.coupon.btnName="已领取",e.coupon.btnDisabled=!0)})}).error(function(){o.path("/404")});var h=s(function(){"undefined"!=typeof i.get("UA")&&e.topic&&""!=e.topic.promoCode&&(s.cancel(h),d.isGetPromo(e.topic.promoCode).success(function(t,o,n){t.data&&(e.coupon.btnName="已领取",e.coupon.btnDisabled=!0)}))},1e3,0);e.lincolnAd=!1,e.cityIndex=0,e.province=null,e.lincolnData={key:"2016lincoln",mr:"",pre_name:"",last_name:"",sex:"",tel:"",email:"",province:"",city:"请选择城市",car:"",budget:"",drive:"1",offline:"1",contact:"1"},e.check=function(){return e.lincolnData.mr?e.lincolnData.pre_name?e.lincolnData.last_name?e.lincolnData.sex?/^1[3|4|5|6|7|8][0-9]\d{4,8}$/.test(e.lincolnData.tel)&&11==e.lincolnData.tel.length?0==e.cityIndex?(t.showDialog("请选择省份"),!1):e.lincolnData.city&&"请选择城市"!=e.lincolnData.city?e.lincolnData.car?e.lincolnData.budget?!0:(t.showDialog("请选择预算"),!1):(t.showDialog("请选择车系"),!1):(t.showDialog("请选择城市"),!1):(t.showDialog("请输入正确的手机号码"),!1):(t.showDialog("请选择性别"),!1):(t.showDialog("请输入名"),!1):(t.showDialog("请输入姓氏"),!1):(t.showDialog("请选择称呼"),!1)},e.hideAd=function(){e.lincolnAd=!1},e.preventHideAd=function(e){e.stopPropagation()},e.provinceChanged=function(t){e.cityIndex=t.id},e.getleads=function(){"undefined"==typeof i.get("UA")?t.inAPP?a.location="yhouse://login":o.path("/register"):e.lincolnAd=!0},e.lincoln_submit=function(){e.check()&&(e.lincolnData.province=e.provinceArray[parseInt(e.cityIndex)],p.lincolnAd(e.lincolnData).success(function(o){"0"!=o.code?t.showDialog("提交失败，请重试"):(e.lincolnAd=!1,d.promo22(e.topic.promoCode).success(function(e,o,n){e.hasOwnProperty("code")&&"0"===e.code?(t.tipDialog.showConfirm=!0,t.tipDialog.desc="恭喜您获得林肯MKZ专属半价优惠，赶快下单吧！"):t.showDialog(e.message)}))}).error(function(){t.showDialog("提交失败，请重试")}))},e.provinceArray=["请选择省份","北京市","天津市","上海市","重庆市","河北省","河南省","云南省","辽宁省","黑龙江省","湖南省","安徽省","山东省","新疆维吾尔自治区","江苏省","浙江省","江西省","湖北省","广西壮族","甘肃省","山西省","内蒙古自治区","陕西省","吉林省","福建省","贵州省","广东省","青海省","西藏","四川省","宁夏回族","海南省","台湾省","香港特别行政区","澳门特别行政区"],e.cityArray=[["请选择城市"],["东城区","西城区","崇文区","宣武区","朝阳区","丰台区","石景山区","海淀区","门头沟区","房山区","通州区","顺义区","昌平区","大兴 区","怀柔区","平谷区","密云县","延庆县"],["和平区","河东区","河西区","南开区","河北区","红桥区","塘沽区","汉沽区","大港区","东丽区","西青区","津南区","北辰区","武清区","宝坻区","宁河县","静海县","蓟县"],["黄浦区","卢湾区","徐汇区","长宁区","静安区","普陀区","闸北区","虹口区","杨浦区","闵行区","宝山区","嘉定区","浦东新区","金山区","松江区","青浦区","南汇区","奉贤区","崇明县"],["万州区","涪陵区","渝中区","大渡口区","江北区","沙坪坝区","九龙坡区","南岸区","北碚区","万盛区","双桥区","渝北区","巴南区","黔江区","长寿区","江津区","合川区","永川区","南川区","綦江县","潼南县","铜梁县","大足县","荣昌县","璧山县","梁平县","城口县","丰都县","垫江县","武隆县","忠县","开县","云阳县","奉节县","巫山县","巫溪县","石柱土家族自治县","秀山土家族苗族自治县","酉阳土家族苗族自治县","彭水苗族土家族自治县"],["石家庄市","唐山市","秦皇岛市","邯郸市","邢台市","保定市","张家口市","承德市","沧州市","廊坊市","衡水市"],["郑州市","开封市","洛阳市","平顶山市","安阳市","鹤壁市","新乡市","焦作市","济源市","濮阳市","许昌市","漯河市","三门峡市","南阳市","商丘市","信阳市","周口市","驻马店市"],["昆明市"," 曲靖市","玉溪市","保山市","昭通市","丽江市","思茅市","临沧市","楚雄彝族自治州","红河哈尼族彝族自治州","文山壮族苗族自治州","西双版纳傣族自治州","大理白族自治州","德宏傣族景颇族自治州","怒江傈僳族自治州","迪庆藏族自治州"],["沈阳市","大连市","鞍山市","抚顺市","本溪市","丹东市","锦州市","营口市","阜新市","辽阳市","盘锦市","铁岭市","朝阳市","葫芦岛市"],["哈尔滨市","齐齐哈尔市","鸡西市","鹤岗市","双鸭山市","大庆市","伊春市","佳木斯市","七台河市","牡丹江市","黑河市","绥化市","大兴安岭地区"],["长沙市","株洲市","湘潭市","衡阳市","邵阳市","岳阳市","常德市","张家界市","益阳市","郴州市","永州市","怀化市","娄底市","湘西土家族苗族自治州"],["合肥市","芜湖市","蚌埠市","淮南市","马鞍山市","淮北市","铜陵市","安庆市","黄山市","滁州市","阜阳市","宿州市","巢湖市","六安市","亳州市","池州","宣城市"],["济南市","青岛市","淄博市","枣庄市","东营市","烟台市","潍坊市","济宁市","泰安市","威海市","日照市","莱芜市","临沂市","德州市","聊城市","滨州市","菏泽市"],["乌鲁木齐市","克拉玛依市","吐鲁番地区","哈密地区","昌吉回族自治州 ","博尔塔拉蒙古自治州 ","巴音郭楞蒙古自治州 ","阿克苏地区","克孜勒苏柯尔克孜自治州 ","喀什地区","和田地区","伊犁哈萨克自治州","塔城地区","阿勒泰地区","石河子市","阿拉尔市","图木舒克市","五家渠市"],["南京市","无锡市","徐州市","常州市","苏州市","南通市","连云港市","淮安市","盐城市","扬州市","镇江市","泰州市","宿迁市"],["杭州市","宁波市","温州市","嘉兴市","湖州市","绍兴市","金华市","衢州市","舟山市","台州市","丽水市"],["南昌市","景德镇市","萍乡市","九江市","新余市","鹰潭市","赣州市","吉安市","宜春市","抚州市","上饶市"],["武汉市","黄石市","十堰市","宜昌市","襄樊市","鄂州市","荆门市","孝感市","荆州市","黄冈市","咸宁市","随州市","恩施土家族苗族自治州","仙桃市","潜江市","天门市","神农架林区"],["南宁市","柳州市","桂林市","梧州市","北海市","防城港市","钦州市","贵港市","玉林市","百色市","贺州市","河池市","来宾市","崇左市"],["兰州市","嘉峪关市","金昌市","白银市","天水市","武威市","张掖市","平凉市","酒泉市","庆阳市","定西市","陇南市","临夏回族自治州","甘南藏族自治州"],["太原市","大同市","阳泉市","长治市","晋城市","朔州市","晋中市","运城市","忻州市","临汾市","吕梁市"],["呼和浩特市","包头市","乌海市","赤峰市","通辽市","鄂尔多斯市","呼伦贝尔市","巴彦淖尔市","乌兰察布市","兴安盟","锡林郭勒盟","阿拉善盟"],["西安市","铜川市","宝鸡市","咸阳市","渭南市","延安市","汉中市","榆林市","安康市","商洛市"],["长春市","吉林市","四平市","辽源市","通化市","白山市","松原市","白城市","延边朝鲜族自治州"],["福州市","厦门市","莆田市","三明市","泉州市","漳州市","南平市","龙岩市","宁德市"],["贵阳市","六盘水市","遵义市","安顺市","铜仁地区","黔西南布依族苗族自治州","毕节地区","黔东南苗族侗族自治州","黔南布依族苗族自治州"],["广州市","韶关市","深圳市","珠海市","汕头市","佛山市","江门市","湛江市","茂名市","肇庆市","惠州市","梅州市","汕尾市","河源市","阳江市","清远市","东莞市","中山市","潮州市","揭阳市","云浮市"],["西宁市","海东地区","海北藏族自治州","黄南藏族自治州","海南藏族自治州","果洛藏族自治州","玉树藏族自治州","海西蒙古族藏族自治州"],["拉萨市","昌都地区","山南地区","日喀则地市","那曲地区","阿里地区","林芝地区"],["成都市","自贡市","攀枝花市","泸州市","德阳市","绵阳市","广元市","遂宁市","内江市","乐山市","南充市","眉山市","宜宾市","广安市","达州市","雅安市","巴中市","资阳市","阿坝藏族羌族自治州","甘孜藏族自治州","凉山彝族自治州"],["银川市","石嘴山市","吴忠市","固原市","中卫市"],["海口市","三亚市","五指山市","琼海市","儋州市","文昌市","万宁市","东方市","定安县","屯昌县","澄迈县","临高县","白沙黎族自治县","昌江黎族自治县","乐东黎族自治县","陵水黎族自治县","保亭黎族苗族自治县","琼中黎族苗族自治县"],["台北市","高雄市","基隆市","台中市","台南市","新竹市","嘉义市"],["中西区","湾仔区","东区","南区","油尖旺区","深水埗区","九龙城区","黄大仙区","观塘区","荃湾区","葵青区","沙田区","西贡区","大埔区","北区","元朗区","屯门区","离岛区"],["澳门"]]}]),mainApp.controller("vipCodeController",["$rootScope","$scope","$timeout","$window","$location","$routeParams","commonService","utilService",function(e,t,o,n,a,r,i,s){var l="";t.ShareDialog=!1,t.closeMask=function(){t.ShareDialog=!1},t.shareUrl={wb:"",wx:"",pyq:"",qq:""},t.iconNum="",t.showIconQQ=e.appGt("2.7")&&"undefined"==typeof a.search().noqq,t.showWX="undefined"==typeof a.search().nowx,t.showIconQQ&&t.showWX?t.iconNum="4":!t.showIconQQ&&t.showWX?t.iconNum="3":t.showIconQQ&&!t.showWX?t.iconNum="2":t.showIconQQ||t.showWX||(t.iconNum="1"),t.level={vipLevel:"1",inviteDesc:"",vipProgress:0},i.queryVipcode27().success(function(o,n,a){o&&"0"===o.code?(t.vipData=o.data,"YHOUSE"!==o.data.promocode.substring(0,6).toUpperCase()?t.inputCode="YHOUSE"+o.data.promocode:t.inputCode=o.data.promocode,l=t.inputCode,t.vipData.inviteCount<3?(t.level.vipLevel="1",t.level.vipProgress=t.vipData.inviteCount/3*100,t.level.inviteDesc="再成功邀请"+(3-t.vipData.inviteCount)+"人消费,立得50元额外礼券"):t.vipData.inviteCount<8?(t.level.vipLevel="2",t.level.vipProgress=t.vipData.inviteCount/8*100,t.level.inviteDesc="再成功邀请"+(8-t.vipData.inviteCount)+"人消费,立得80元额外礼券"):t.vipData.inviteCount<15?(t.level.vipLevel="3",t.level.vipProgress=t.vipData.inviteCount/15*100,t.level.inviteDesc="再成功邀请"+(15-t.vipData.inviteCount)+"人消费,立得200元额外礼券"):t.vipData.inviteCount<35?(t.level.vipLevel="4",t.level.vipProgress=t.vipData.inviteCount/35*100,t.level.inviteDesc="再成功邀请"+(35-t.vipData.inviteCount)+"人消费,立得500元额外礼券"):(t.level.vipLevel="4",t.level.vipProgress=100),s.isEmptyString(t.inputCode)||(t.shareUrl={wb:"yhouse://my-vip-share-weibo?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),wx:"yhouse://my-vip-share-weixin?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),pyq:"yhouse://my-vip-share-pengyouquan?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),qq:"yhouse://my-vip-share-qq?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl)})):e.showDialog(o.message)}),t.$watch("inputCode",function(e,n){e&&e.length>=6&&"YHOUSE"===t.inputCode.substring(0,6).toUpperCase()&&!s.isOnlyNumAlpha(t.inputCode)||o(function(){n&&n.length>=6&&"YHOUSE"===n.substring(0,6).toUpperCase()?t.inputCode=n:t.inputCode=l,s.isEmptyString(t.inputCode)||(t.shareUrl={wb:"yhouse://my-vip-share-weibo?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),wx:"yhouse://my-vip-share-weixin?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),pyq:"yhouse://my-vip-share-pengyouquan?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),qq:"yhouse://my-vip-share-qq?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl)})},100)}),t.viewDetail=function(){t.inputCode===l||"YHOUSE"+t.inputCode===l?(t.inputCode=l,n.location="yhouse://my-vip-prize?promoAlias="+t.inputCode):("undefined"!=typeof _paq&&_paq.push(["trackEvent","Vip Code Change"]),i.modifyVipcode27(t.inputCode).success(function(o,a,r){"0"!==o.code?e.showDialog(o.message):(t.inputCode=o.data,l=o.data,s.isEmptyString(t.inputCode)||(t.shareUrl={wb:"yhouse://my-vip-share-weibo?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),wx:"yhouse://my-vip-share-weixin?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),pyq:"yhouse://my-vip-share-pengyouquan?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),qq:"yhouse://my-vip-share-qq?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl)}),n.location="yhouse://my-vip-prize?promoAlias="+t.inputCode)}))},t.openShareDialog=function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","Vip Code Change","share"]),t.inputCode===l||"YHOUSE"+t.inputCode===l?(t.inputCode=l,e.appGt("2.7")&&(n.location="yhouse://post?promoAlias="+t.inputCode),t.ShareDialog=!t.ShareDialog):("undefined"!=typeof _paq&&_paq.push(["trackEvent","Vip Code Change"]),i.modifyVipcode27(t.inputCode).success(function(o,a,r){"0"!==o.code?e.showDialog(o.message):(t.inputCode=o.data,l=o.data,s.isEmptyString(t.inputCode)||(t.shareUrl={wb:"yhouse://my-vip-share-weibo?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),wx:"yhouse://my-vip-share-weixin?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),pyq:"yhouse://my-vip-share-pengyouquan?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),qq:"yhouse://my-vip-share-qq?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl)}),e.appGt("2.7")&&(n.location="yhouse://post?promoAlias="+t.inputCode),t.ShareDialog=!t.ShareDialog)}))},document.getElementsByClassName("icon_share_wb")[0].addEventListener("touchend",function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","Vip Code Share","weibo"]),t.closeMask()},!0),t.showWX||(document.getElementsByClassName("icon_share_wx").length>0&&document.getElementsByClassName("icon_share_wx")[0].addEventListener("touchend",function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","Vip Code Share","weixin"]),t.closeMask()},!0),document.getElementsByClassName("icon_share_pyq").length>0&&document.getElementsByClassName("icon_share_pyq")[0].addEventListener("touchend",function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","Vip Code Share","pengyouquan"]),t.closeMask()},!0)),t.showIconQQ&&document.getElementsByClassName("icon_share_qq").length>0&&document.getElementsByClassName("icon_share_qq")[0].addEventListener("touchend",function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","Vip Code Share","qq"]),t.closeMask()},!0),t.startUpdateCode=function(){o(function(){n.scrollTo(0,document.body.scrollHeight)},500)},t.updateCode=function(){i.modifyVipcode27(t.inputCode).success(function(o,a,r){"0"!==o.code?e.showDialog(o.message):(t.inputCode=o.data,l=o.data,s.isEmptyString(t.inputCode)||(t.shareUrl={wb:"yhouse://my-vip-share-weibo?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),wx:"yhouse://my-vip-share-weixin?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),pyq:"yhouse://my-vip-share-pengyouquan?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl),qq:"yhouse://my-vip-share-qq?code="+t.inputCode+"&url="+encodeURIComponent(t.vipData.promoGetUrl)}),e.appGt("2.7")&&(n.location="yhouse://post?promoAlias="+t.inputCode))})}}]),mainApp.controller("vipPrizeController",["$rootScope","$scope","$location","$routeParams","commonService",function(e,t,o,n,a){t.showPrizeRule=!1,t.inviteList=[],t.statusStr=["注册","已消费"],t.paging={showHeight:0,inviteCount:"0",invitePrize:"0",showLoadMore:!1,page:1,pageSize:50,prizeLevel:0},t.loadMore=function(){a.queryInviteList(t.paging.page,t.paging.pageSize).success(function(e,o,n){if(e&&"0"===e.code){t.paging.inviteCount=e.data.invitNum,t.paging.invitePrize=e.data.awardTotal,t.paging.inviteCount>=35?(t.paging.prizeLevel="4",
t.paging.showHeight=120):t.paging.inviteCount>15&&t.paging.inviteCount<35?(35===t.paging.inviteCount?t.paging.prizeLevel="4":t.paging.prizeLevel="3",t.paging.showHeight=90+Math.floor((t.paging.inviteCount-15)/35*30)):t.paging.inviteCount>8&&t.paging.inviteCount<=15?(15===t.paging.inviteCount?t.paging.prizeLevel="3":t.paging.prizeLevel="2",t.paging.showHeight=60+Math.floor((t.paging.inviteCount-8)/15*30)):t.paging.inviteCount>3&&t.paging.inviteCount<=8?(8===t.paging.inviteCount?t.paging.prizeLevel="2":t.paging.prizeLevel="1",t.paging.showHeight=30+Math.floor((t.paging.inviteCount-3)/8*30)):t.paging.inviteCount>0&&t.paging.inviteCount<=3?(3===t.paging.inviteCount&&(t.paging.prizeLevel="1"),t.paging.showHeight=Math.floor(t.paging.inviteCount/3*30)):t.paging.showHeight=0;for(var a=0;a<e.data.couponAwardList.doc.length;a++)t.inviteList.push(e.data.couponAwardList.doc[a]);1===e.data.couponAwardList.isEnd?t.paging.showLoadMore=!1:(t.paging.showLoadMore=!0,t.paging.page=e.data.couponAwardList.nextPage)}})},t.loadMore()}]),mainApp.controller("webcastForenoticeListController",["$scope","$rootScope","$cookies","$location","snsService",function(e,t,o,n,a){e.livePreview=null,"undefined"!=typeof o.get("UA")?e.isLogin=!0:e.isLogin=!1,e.forenoticeMask=!1,e.setIcon=function(e){switch(e){case"玩味美食":bgName="icon_live_preview_food@2x.png";break;case"酷炫玩乐":bgName="icon_live_preview_play@2x.png";break;case"新奇好物":bgName="icon_live_preview_good@2x.png";break;case"唯美风尚":bgName="icon_live_preview_fashion@2x.png"}return{"background-image":"url('./img/icons/"+bgName+"?v3.4')","background-size":"0.29rem auto","padding-left":"0.36rem"}},a.webcastForenoticeList().success(function(o,r,i){if("0"===o.code&&o.data&&(e.livePreview=o.data,t.page.pageTitle=e.livePreview.forenotice.title,t.inWX&&commonService.initWxConfig(n.absUrl(),e.livePreview.forenotice.linkTitle,e.livePreview.forenotice.linkContent,n.absUrl(),e.livePreview.forenotice.linkPic),t.$emit("pageTitleChanged"),t.inAPP)){e.broadcastingRemind=function(t,o){o=0===o?1:0,a.forenoticeRemind(t,o).success(function(t,o,n){"0"===t.code&&e.reload()})};var s="http://"+window.location.host+"/webcast-forenotice-list?pk_campaign=share&pk_kwd=webcast-forenotice-list";e.shareUrl={wb:"yhouse://share-weibo?content="+encodeURIComponent(e.livePreview.forenotice.linkContent)+"%20@YHOUSE悦会%20"+encodeURIComponent(s)+"&icon="+encodeURIComponent(e.livePreview.forenotice.linkPic),wx:"yhouse://share-weixin?title="+encodeURIComponent(e.livePreview.forenotice.linkTitle)+"&content="+encodeURIComponent(e.livePreview.forenotice.linkContent)+"&url="+encodeURIComponent(s)+"&icon="+encodeURIComponent(e.livePreview.forenotice.linkPic),pyq:"yhouse://share-pengyouquan?title="+encodeURIComponent(e.livePreview.forenotice.linkTitle)+"&url="+encodeURIComponent(s)+"&icon="+encodeURIComponent(e.livePreview.forenotice.linkPic),qq:"yhouse://share-qq?title="+encodeURIComponent(e.livePreview.forenotice.linkTitle)+"&content="+encodeURIComponent(e.livePreview.forenotice.linkContent)+"&url="+encodeURIComponent(s)+"&icon="+encodeURIComponent(e.livePreview.forenotice.linkPic)},document.getElementsByClassName("icon_share_wb").length>0&&document.getElementsByClassName("icon_share_wb")[0].addEventListener("touchend",function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","webcast forenotice list Share","weibo"]),setTimeout(function(){e.forenoticeMask=!1,e.$apply()},1e3)},!0),document.getElementsByClassName("icon_share_wx").length>0&&document.getElementsByClassName("icon_share_wx")[0].addEventListener("touchend",function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","webcast forenotice list Share","weixin"]),setTimeout(function(){e.forenoticeMask=!1,e.$apply()},1e3)},!0),document.getElementsByClassName("icon_share_pyq").length>0&&document.getElementsByClassName("icon_share_pyq")[0].addEventListener("touchend",function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","webcast forenotice list Share","pengyouquan"]),setTimeout(function(){e.forenoticeMask=!1,e.$apply()},1e3)},!0),document.getElementsByClassName("icon_share_qq").length>0&&document.getElementsByClassName("icon_share_qq")[0].addEventListener("touchend",function(){"undefined"!=typeof _paq&&_paq.push(["trackEvent","webcast forenotice list Share","qq"]),setTimeout(function(){e.forenoticeMask=!1,e.$apply()},1e3)},!0)}}),e.reload=function(){a.webcastForenoticeList().success(function(t,o,n){"0"===t.code&&t.data&&(e.livePreview=t.data)})},e.share=function(){e.forenoticeMask=!e.forenoticeMask};var r=document.createElement("script"),i=document.getElementsByTagName("script")[0];r.type="text/javascript",r.text='function openShare(){var element = angular.element(document.getElementById("mainApp"));var scope = element.scope();scope.$apply(scope.share());};',i.parentNode.insertBefore(r,i)}]),mainApp.controller("webcastLiveController",["$scope","$rootScope","$location","$routeParams","snsService","$sce","commonService","$window","$q",function(e,t,o,n,a,r,i,s,l){e.webcastId=parseInt(n.webcastId),e.showVideo=!1,e.hidetxt="隐藏",e.lnum=0,e.snum=0,e.sync=!1,e.isHideChat=!1,e.isplay=!1,e.hidechat=function(){e.hidetxt="隐藏"==e.hidetxt?"显示":"隐藏",e.isHideChat=!e.isHideChat},e.customvideoStyle={width:"100%",height:"414px"},e.showpopup=function(){e.showpop=!0},e.lookLastVideo=function(){for(var t,n=0;n<e.relatedRecommendList.length;n++)if(2==e.relatedRecommendList[n].shareType){t=e.relatedRecommendList[n].id;break}o.path("/webcast-video/"+t)},e.videoAPI=null,e.onPlayerReady=function(t){e.videoAPI=t},e.$watch("videoAPI.currentState",function(o,n){"play"==o&&(e.customvideoStyle={width:"100%",height:document.documentElement.clientHeight+"px"},t.page.showApp=!1)}),e.videoConfig={preload:"none",plugins:{analytics:{category:"webcast",label:e.webcastId,events:{ready:!0,play:!0,pause:!0,complete:!0}}}};var c=0,d=!0;$script("//cdn.ronghub.com/RongIMLib-2.1.3.min.js",function(){"m.yhouse.com"==o.host()?RongIMClient.init("kj7swf8o7tmk2"):RongIMClient.init("k51hidwq1ywfb"),RongIMClient.RegisterMessage.UnknownMessage=function(e){this.messageName="UnknownMessage",this.message=e,this.encode=function(){return JSON.stringify(e)},this.decode=function(e){return e}},RongIMClient.registerMessageType("UnknownMessage","yhouse:livePraise",new RongIMLib.MessageTag(!0,!0),new RongIMClient.RegisterMessage.UnknownMessage),e.setMargin=function(e){},e.rock=function(){c+=1,e.lnum+=1,d&&(d=!1,setTimeout(function(){var t={};t.content={count:c.toString(),duration:"2"},t.objectName="yhouse:livePraise";var o=new RongIMClient.RegisterMessage.UnknownMessage(t),n=e.liveInfo.chatId;c=0,d=!0,RongIMClient.getInstance().sendMessage(4,n,o,{onSuccess:function(e){},onError:function(e){}})},2e3))},a.attendShareWebcast(e.webcastId).success(function(t,o,n){"0"===t.code&&t.data&&(e.attendInfo=t.data,e.$emit("timer-start"))}),a.webcastLive(e.webcastId).success(function(n,s,l){"0"===n.code&&n.data?(e.showVideo=!0,e.liveInfo=n.data,e.notchangeLiveInfo=n.data,e.hotRecommendList=n.data.hotRecommendList,e.relatedRecommendList=n.data.relatedRecommendList,e.videoConfig.sources=[{src:r.trustAsResourceUrl(e.liveInfo.hlsUrl),type:"application/x-mpegURL"}],e.videoConfig.plugins.poster=e.liveInfo.picUrl,t.page.pageTitle=e.liveInfo.userName+"正在YHOUSE直播",t.inWX&&i.initWxConfig(o.absUrl(),"明明可以靠脸直播，偏偏要靠才华",n.data.userName+"在YHOUSE直播，快来看看吧🙈",o.absUrl(),n.data.shareImgUrl),t.$emit("pageTitleChanged"),n.data.webcastTime||a.webcastGetToken().success(function(t,o,n){"0"===t.code&&t.data&&(e.token=t.data,e.initChat())}).error(function(){})):o.path("/404")}).error(function(){o.path("/404")}),RongIMClient.setConnectionStatusListener({onChanged:function(e){switch(e){case RongIMLib.ConnectionStatus.CONNECTED:break;case RongIMLib.ConnectionStatus.CONNECTING:break;case RongIMLib.ConnectionStatus.DISCONNECTED:break;case RongIMLib.ConnectionStatus.KICKED_OFFLINE_BY_OTHER_CLIENT:break;case RongIMLib.ConnectionStatus.NETWORK_UNAVAILABLE:}}}),tempTimeStamp="",RongIMClient.setOnReceiveMessageListener({onReceived:function(o){switch(o.messageType){case RongIMClient.MessageType.TextMessage:if(tempTimeStamp==o.sentTime||"yhouse_sys"==o.senderUserId||"UnknownMessage"==o.messageType)return;tempTimeStamp=o.sentTime,e.chatList.push({user_img:o.content.user.icon,user_name:o.content.user.name,text:o.content.content,type:1}),e.$apply();break;case RongIMClient.MessageType.VoiceMessage:RongIMLib.RongIMVoice.preLoaded(o.content.content);break;case RongIMClient.MessageType.ImageMessage:break;case RongIMClient.MessageType.DiscussionNotificationMessage:break;case RongIMClient.MessageType.LocationMessage:break;case RongIMClient.MessageType.RichContentMessage:break;case RongIMClient.MessageType.DiscussionNotificationMessage:break;case RongIMClient.MessageType.InformationNotificationMessage:break;case RongIMClient.MessageType.ContactNotificationMessage:break;case RongIMClient.MessageType.ProfileNotificationMessage:break;case RongIMClient.MessageType.CommandNotificationMessage:break;case RongIMClient.MessageType.CommandMessage:break;case RongIMClient.MessageType.UnknownMessage:"yhouse:liveRoom"==o.objectName&&"END"==o.content.message.content.type&&(stat=JSON.parse(o.content.message.content.stat),e.liveInfo=stat,e.liveInfo.completeStatus=!0,e.liveInfo.webcastTime=stat.webcastTime,e.liveInfo.likeNum=stat.likeNum,e.liveInfo.highViewerNum=stat.highViewerNum,e.liveInfo.averageViewerNum=stat.averageViewerNum,e.$emit("timer-stop"),e.isplay=!1,e.videoAPI.stop(),e.videoAPI.currentState="stop",t.page.showApp=!0,e.customvideoStyle={width:"100%",height:"414px"},e.$apply()),"yhouse:livePraise"==o.objectName&&(e.lnum+=parseInt(o.content.message.count),e.$apply()),"yhouse:liveSync"==o.objectName&&(e.sync=!0,console.log(o.content.message),e.snum=o.content.message.content.viewerNum,e.lnum=o.content.message.content.likeNum,e.subscriber=o.content.message.content.viewerList.slice(0,9),e.$apply())}}}),e.initChat=function(){RongIMClient.connect(e.token,{onSuccess:function(t){e.userid=t;var o=e.liveInfo.chatId,n=0,a=RongIMLib.GetChatRoomType.REVERSE;RongIMClient.getInstance().joinChatRoom(o,n,{onSuccess:function(){},onError:function(e){}}),RongIMClient.getInstance().getChatRoomInfo(o,n,a,{onSuccess:function(e){},onError:function(e){}})},onTokenIncorrect:function(e){console.log("token无效")},onError:function(e){var t="";switch(e){case RongIMLib.ErrorCode.TIMEOUT:t="超时";break;case RongIMLib.ErrorCode.UNKNOWN_ERROR:t="未知错误";break;case RongIMLib.ErrorCode.UNACCEPTABLE_PaROTOCOL_VERSION:t="不可接受的协议版本";break;case RongIMLib.ErrorCode.IDENTIFIER_REJECTED:t="appkey不正确";break;case RongIMLib.ErrorCode.SERVER_UNAVAILABLE:t="服务器不可用"}console.log(e)}})},s.sessionStorage.getItem("currentUser")&&(e.currentUser=JSON.parse(s.sessionStorage.getItem("currentUser"))),e.chatList=[],e.chat=[],e.sendMsg=function(){if(e.chat.message){var t=new RongIMLib.TextMessage({content:e.chat.message,user:{name:e.currentUser.name,icon:e.currentUser.showPicUrl}});ConversationType=RongIMLib.ConversationType.CHATROOM;var o=ConversationType,n=e.liveInfo.chatId;RongIMClient.getInstance().sendMessage(o,n,t,{onSuccess:function(e){},onError:function(e,t){var o="";switch(e){case RongIMLib.ErrorCode.TIMEOUT:o="超时";break;case RongIMLib.ErrorCode.UNKNOWN_ERROR:o="未知错误";break;case RongIMLib.ErrorCode.REJECTED_BY_BLACKLIST:o="在黑名单中，无法向对方发送消息";break;case RongIMLib.ErrorCode.NOT_IN_DISCUSSION:o="不在讨论组中";break;case RongIMLib.ErrorCode.NOT_IN_GROUP:o="不在群组中";break;case RongIMLib.ErrorCode.NOT_IN_CHATROOM:o="不在聊天室中";break;default:o="x"}console.log("发送失败:"+o)}}),e.chatList.push({user_img:e.currentUser.showPicUrl,user_name:e.currentUser.name,text:e.chat.message,type:1}),e.chat.message=""}}})}]).directive("updateScroll",["$window","$timeout",function(e,t){return{restrict:"A",link:function(e,o,n){scrolled=!1,e.$watchCollection("chatList",function(e,n){document.querySelector(".chat_list").offsetHeight>200&&(document.querySelector(".chat_list").style.bottom="auto",document.querySelector(".chat_list").style.top="0"),scrolled||t(function(){o[0].scrollTop=o[0].scrollHeight},100)})}}}]).directive("yhouseLikeAnimation",["$window",function(e){return{link:function(e,t,o){var n=document.body||document.documentElement,n=n.style,a="",r="";""==n.WebkitAnimation&&(a="-webkit-"),""==n.MozAnimation&&(a="-moz-"),""==n.OAnimation&&(a="-o-"),""==n.WebkitTransition&&(r="-webkit-"),""==n.MozTransition&&(r="-moz-"),""==n.OTransition&&(r="-o-");var s=document.querySelector(".bubble-con");e.$watch("lnum",function(e,t){if(0!=t){var o=0>e-t?0:e-t;for(i=0;i<o;i++)setTimeout(function(){var e=Math.floor(10*Math.random()+6),t=document.createElement("div");s.appendChild(t),t.setAttribute("style","background:url(img/icons/like-s8fa649e295.png) 0 "+-135*e+"px; position:absolute;bottom:60px;right:-10px;z-index:400;width:135px;height:135px");var o=parseInt(3*Math.random()+1,10);t.classList.add("rockanimation"+o),t.onCSSAnimationEnd=function(e){var t=function(o){e(),o.target.removeEventListener(o.type,t)};return this.addEventListener("webkitAnimationEnd",t),this.addEventListener("mozAnimationEnd",t),this.addEventListener("oAnimationEnd",t),this.addEventListener("oanimationend",t),this.addEventListener("animationend",t),(""!=a||"animation"in n)&&"0s"!=getComputedStyle(this)[a+"animation-duration"]||e(),this},t.onCSSAnimationEnd(function(){t.parentNode.removeChild(t)})},500*i)}})}}}]).directive("errSrc",function(){return{link:function(e,t,o){t.bind("error",function(){o.src!=o.errSrc&&o.$set("src",o.errSrc)})}}}),mainApp.controller("webcastPreviewController",["$scope","$rootScope","$location","$routeParams","snsService","commonService",function(e,t,o,n,a,r){e.chatId=o.search().chatId,e.pushUserId=o.search().pushUserId,e.liveInfo={status:0},a.webcastPreview(e.chatId,e.pushUserId).success(function(n,a,i){"0"===n.code&&n.data?(e.liveInfo=n.data,e.hotRecommendList=n.data.hotRecommendList,e.relatedRecommendList=n.data.relatedRecommendList,2!=e.liveInfo.status&&o.path("/webcast-live/"+parseInt(e.liveInfo.id)),t.page.pageTitle="明明可以靠脸直播，偏偏要靠才华",t.inWX&&r.initWxConfig(o.absUrl(),"明明可以靠脸直播，偏偏要靠才华",n.data.userName+"在YHOUSE直播，快来看看吧🙈",o.absUrl(),n.data.shareImgUrl),t.$emit("pageTitleChanged")):o.path("/404")}).error(function(){o.path("/404")})}]),mainApp.controller("webcastStatController",["$scope","$rootScope","$location","$routeParams","snsService","commonService",function(e,t,o,n,a,r){e.webcastId=parseInt(n.webcastId),a.webcastStat(e.webcastId).success(function(n,a,i){"0"===n.code&&n.data?(e.statInfo=n.data,e.hotRecommendList=e.statInfo.hotRecommendList,e.relatedRecommendList=e.statInfo.relatedRecommendList,t.page.pageTitle="明明可以靠脸直播，偏偏要靠才华",t.inWX&&r.initWxConfig(o.absUrl(),"明明可以靠脸直播，偏偏要靠才华",n.data.userName+"在YHOUSE上直播，共有"+n.data.viewerNum+"人观看，快来围观！",o.absUrl(),n.data.shareImgUrl),t.$emit("pageTitleChanged")):o.path("/404")}).error(function(){o.path("/404")})}]),mainApp.controller("webcastVideoController",["$scope","$rootScope","$location","$routeParams","snsService","$sce","commonService",function(e,t,o,n,a,r,i){e.videoId=parseInt(n.videoId),e.videoAPI=null,e.onPlayerReady=function(t){e.videoAPI=t},e.videoConfig={preload:"none",plugins:{analytics:{category:"webcast",label:e.videoId,events:{ready:!0,play:!0,pause:!0,complete:!0}}}},a.webcastVideo(e.videoId).success(function(n,a,s){"0"===n.code&&n.data?(e.videoInfo=n.data,e.hotRecommendList=n.data.hotRecommendList,e.relatedRecommendList=n.data.relatedRecommendList,e.videoConfig.sources=[{src:r.trustAsResourceUrl(e.videoInfo.videoUrl),type:"application/x-mpegURL"}],e.videoConfig.plugins.poster=e.videoInfo.smallPicUrl,t.page.pageTitle="明明可以靠脸直播，偏偏要靠才华",t.inWX&&i.initWxConfig(o.absUrl(),"明明可以靠脸直播，偏偏要靠才华",n.data.userName+"在YHOUSE直播，快来看看吧🙈",o.absUrl(),n.data.shareImgUrl),t.$emit("pageTitleChanged")):o.path("/404")}).error(function(){o.path("/404")})}]);